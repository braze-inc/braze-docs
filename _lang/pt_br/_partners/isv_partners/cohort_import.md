---
nav_title: Integração da importação de coortes
alias: /cohort_import/
hidden: true
---

# Integração com a importação de coortes de parceiros

> O recurso de integração com parceiros de importação de coortes permite que nossos parceiros se integrem ao Braze para enviar coortes de usuários que foram gerados no aplicativo do parceiro.

## URLs do cluster

A Braze hospeda nosso aplicativo em vários clusters nos EUA e na UE. A URL dos pontos de extremidade de importação será diferente, dependendo do cluster em que a instância da empresa do cliente estiver hospedada:

| INSTÂNCIA | ENDPOINT REST |
| ----- | ------------------------------- |
| US-01 | `https://rest.iad-01.braze.com` |
| US-02 | `https://rest.iad-02.braze.com` |
| US-03 | `https://rest.iad-03.braze.com` |
| US-04 | `https://rest.iad-04.braze.com` |
| US-05 | `https://rest.iad-05.braze.com` |
| US-06 | `https://rest.iad-06.braze.com` |
| US-07 | `https://rest.iad-07.braze.com` |
| US-08 | `https://rest.iad-08.braze.com` |
| EU-01 | `https://rest.fra-01.braze.eu`  |
| EU-02 | `https://rest.fra-02.braze.eu`  |
{: .reset-td-br-1 .reset-td-br-2 role="presentation" }

## URLs dos endpoints

Além de os URLs de nível superior serem específicos do cluster, cada endpoint também é específico do parceiro. Por exemplo, ao importar para nosso cluster US01, o URL teria o formato `https://rest.iad-01.braze.com/partners/[partner_name]/…`, em que `[partner_name]` é normalmente o nome da empresa do parceiro. As especificações de cada endpoint estão descritas nas seções a seguir.

## Autenticação

Para importar dados de coorte para a Braze, são necessárias duas chaves de autenticação.

### Chave de API do parceiro

A chave de API do parceiro identifica o parceiro de integração e autentica a solicitação como sendo válida para importação. A chave deve ser incluída no corpo da solicitação no campo `partner_api_key`.

Ao configurar a integração no aplicativo do parceiro, o cliente deve ser solicitado a especificar seu cluster Braze para que a integração saiba qual URL do cluster e chave de API do parceiro usar ao importar dados.

A Braze fornecerá a(s) chave(s) de API do parceiro ao parceiro antes de ele iniciar o desenvolvimento da integração. Em geral, forneceremos uma única chave que é válida para todos os clusters dos EUA e outra chave que é válida para o nosso cluster da UE.

### Chave de importação de dados do cliente

A chave de importação de dados do cliente identifica o espaço de trabalho do cliente para o qual o coorte deve ser importado. A chave deve ser incluída no corpo da solicitação no campo `client_secret`.

Essa chave é gerada no dashboard do cliente nas configurações de integração com o parceiro. Ao configurar a integração no aplicativo do parceiro, o cliente deve ser solicitado a especificar sua chave de importação de dados para que a integração saiba para qual cliente e espaço de trabalho enviar os dados.

## Especificações do ponto de extremidade da API

### Endpoint do nome da coorte

O endpoint do nome da coorte pode ser usado para especificar o nome de uma coorte com base em seu ID. Esse endpoint deve ser chamado sempre que uma coorte for inicialmente exportada para o Braze ou quando o nome de uma coorte já conhecida pelo Braze for alterado.

| Campo | Tipo | Obrigatória | Notas |
| ----- | ---- | -------- | ----- |
| `partner_api_key` | String | Sim | Chave de API específica do parceiro, usada em todas as solicitações do parceiro para o Braze. Essa chave será específica do cluster (consulte [Chave de API do parceiro](#partner-api-key)), portanto, o parceiro precisará conhecer o cluster no qual os coortes serão gravados. |
| `client_secret` | String | Sim | Chave de importação de dados para o cliente a cuja coorte o parâmetro pertence. |
| `cohort_id` | String | Sim | Identificador do coorte. Esse identificador deve ser exclusivo para o cliente especificado. |
| `name` | String | Sim | Nome especificado pelo cliente para o coorte |
| `created_at` | String | Sim | Carimbo de data/hora no formato ISO-8601 |
{: .reset-td-br-1 .reset-td-br-2 .reset-td-br-3  .reset-td-br-4 role="presentation" }

#### Exemplo de solicitação:

`POST: https://rest.iad-01.braze.com/partners/[partner_name]/cohorts`
```
{
	"partner_api_key" : "123456-1234-1234-12345678",
	"client_secret" : "234567-2345-2345-23456789",
	"cohort_id" : "[some unique identifier generated by the partner]",
	"name" : "Name of the cohort that will appear in the Braze dashboard",
	"created_at" : "2021-01-21T19:20:30+05:00"
}
```

### Ponto de extremidade de coorte de usuários

O ponto de extremidade Coorte de usuários permite especificar quais usuários foram adicionados ou removidos de um determinado coorte. Esse ponto de extremidade deve ser chamado quando um coorte é atualizado. Somente os usuários que entraram recentemente no coorte ou que saíram do coorte desde a última atualização devem ser enviados ao Braze.

| Campo | Tipo | Obrigatória | Notas |
| ----- | ---- | -------- | ----- |
| `partner_api_key` | String | Sim | Chave de API específica do parceiro, usada em todas as solicitações do parceiro para o Braze. Essa chave será específica do cluster (consulte [Chave de API do parceiro](#partner-api-key)), portanto, a integração precisará conhecer o cluster no qual os coortes serão gravados. |
| `client_secret` | String | Sim | Chave de importação de dados para o cliente a cuja coorte o parâmetro pertence. |
| `cohort_id` | String | Sim | Identificador do coorte. O identificador deve ser exclusivo para o cliente especificado. |
| `cohort_changes` | Vetor de objetos | Sim | Os objetos podem ter dois campos. Um deles, `user_ids`, é obrigatório e pode ser uma matriz de `external_ids`, `device_ids` e `aliases`. Cada elemento é um ID para um usuário cujo status na coorte foi alterado. O segundo campo, `should_remove`, é um booleano opcional que indica se os usuários desse objeto devem ser removidos do coorte em vez de adicionados. O padrão é false. O comprimento máximo combinado dos IDs de usuário em uma única solicitação é de 1.000.<br/><br/>Usuários identificados podem ser correspondidos pelo seu `external_id` ou `alias`. Usuários anônimos podem ser correspondidos pelo seu `device_id`. Se você passar um ID de dispositivo para um usuário identificado, Braze não adicionará nem removerá esse usuário. Você deve usar IDs externos ou aliases para usuários identificados. |
{: .reset-td-br-1 .reset-td-br-2 .reset-td-br-3  .reset-td-br-4 role="presentation" }

#### Exemplo de solicitação:

`POST: https://rest.iad-01.braze.com/partners/[partner_name]/cohorts/users`
```
{
	"partner_api_key" : "123456-1234-1234-12345678",
	"client_secret" : "234567-2345-2345-23456789",
	"cohort_id" : "[some unique identifier generated by the partner]",
	"cohort_changes" : "[
	   {"user_ids": ["test_user_1", "test_user_2"]}
	]"
}
```

## Limite de taxa

Além do máximo de 1.000 IDs de usuário por solicitação no endpoint da coorte de usuários, essas solicitações de endpoint têm um limite de taxa de 250.000 solicitações por hora.

## Filtro de coorte

O Braze adicionará um filtro que permite que um usuário do dashboard inclua ou exclua usuários de um público direcionado se eles estiverem em um coorte de parceiros. O filtro fornecerá uma lista suspensa com os nomes de todos os coortes conhecidos pelo Braze para esse cliente. Esse filtro só será visível para os clientes com os quais o parceiro e a Braze concordaram em fazer parceria nessa integração.

## Solução de problemas

Consulte a tabela a seguir para ver os códigos de erro específicos dos pontos de extremidade de importação de coorte e como solucioná-los.

| Código de erro | Descrição |
| ----- | ---- |
| `400` | `cohort_id` deve ser uma string válida |
|  | `cohort_changes` deve ser um vetor de objetos, cada um com a chave `user_ids` e/ou `device_ids` mapeando para um vetor de strings, ou um objeto `aliases` |
|  | Somente 1.000 `user_ids`, `device_ids` e `aliases` são permitidos por solicitação |
|  | `name` deve ser uma string não vazia |
|  | `created_at` deve ser uma hora válida como uma string [ISO-8601](https://en.wikipedia.org/wiki/ISO_8601) |
| `401` | Chave de API de parceiro inválida |
|  | Segredo de cliente inválido |
|  | Parceiro não ativado para cliente com segredo de cliente: **<secreto de cliente>** |
|  | Acesso não autorizado |
| `423` | Recurso bloqueado |
{: .reset-td-br-1 .reset-td-br-2 role="presentation" }

Para obter mais soluções de problemas, consulte [Erros e respostas]({{site.baseurl}}/api/errors/), que aborda os vários erros e respostas do servidor que podem ocorrer ao usar a API do Braze.
