---
article_title: キャンバスのアプリ内メッセージ
permalink: /canvas_triggered_in-app_messages/
page_type: reference
description: "この参考記事では、リッチなメッセージングを表示するためにキャンバスに追加できる、アプリ内メッセージ特有の機能とニュアンスについて説明する。"
---

# キャンバスのアプリ内メッセージ

> アプリ内メッセージをキャンバスジャーニーの一部として追加して、顧客がアプリを利用したときにリッチメッセージングを表示できます。この記事では、キャンバスのアプリ内メッセージに固有の機能とニュアンスについて説明します。

次のセクションに進む前に、[キャンバスを作成]({{site.baseurl}}/user_guide/engagement_tools/canvas/create_a_canvas/create_a_canvas/)し、遅延とオーディエンスのオプションを設定しておく必要があります。

キャンバスビルダーで、[メッセージ]({{site.baseurl}}/user_guide/engagement_tools/canvas/canvas_components/message_step/)ステップを追加し、**メッセージングチャネルとして** **アプリ内メッセージを**選択する。[メッセージがいつ期限切れになるか](#in-app-message-expiration)、どのような[昇進動作](#advancement-behavior)を行うかをカスタマイズできます。

## アプリ内トリガーメッセージ

{% alert important %}
アプリ内メッセージのトリガーアクションは現在早期アクセス中である。早期アクセスへの参加に興味がある場合は、アカウントマネージャーにお問い合わせください。<br><br>以前はトリガーを選択するオプションがなかったため、アプリ内メッセージは常にセッション開始時にトリガーされていた。トリガーを選択するオプションが追加され、アプリ内メッセージをセッション開始時やカスタムイベント、購入時にトリガーできるようになった。この機能の前に作成されたアプリ内メッセージは、セッション開始がトリガーとなる。
{% endalert %}

遅延が過ぎ、オーディエンスオプションがチェックされた後、ユーザーがメッセージステップに到達すると、アプリ内メッセージはライブに設定される。ユーザーがセッションを開始し、アプリ内メッセージのトリガーイベントを実行した場合、ユーザーにはアプリ内メッセージが表示される。 

アクションによってエントリがトリガーされるキャンバスステップの場合、ユーザーがセッションの途中でキャンバスに入る可能性があります。アプリ内メッセージはセッションが開始されるまでライブに設定されないため、ユーザーがセッションの途中でメッセージステップに到達した場合、別のセッションを開始し、関連するトリガーを実行するまでアプリ内メッセージを受信することはない。

## アプリ内メッセージの有効期限

アプリ内メッセージ作成画面でアプリ内メッセージの有効期限を選択できます。この間、アプリ内メッセージは有効期限が切れるまで表示されるのを待機します。アプリ内メッセージは送信後に一度だけ表示できます。

![]({% image_buster /assets/img_archive/canvas_expiration2.png %}){: style="max-width:85%"}

| オプション | 説明 | 例 |
|---|---|---|
| **ステップが使用可能になってからの期間** | アプリ内メッセージの有効期限を、ステップがユーザーにとって利用可能になるタイミングに相対的に設定する。 | 2日間有効のアプリ内メッセージは、ステップのディレイが経過し、オーディエンス・オプションがチェックされた後に利用可能になる。その後、2 日間(48 時間) 利用可能になり、その2 日間、ユーザー s がアプリを開封するとアプリ内メッセージが表示される場合があります。 |
| **特定の日時に** | アプリ内メッセージが利用できなくなる日時を指定する。 | 2024年11月30日に終了するセールがある場合、このオプションを選択し、セール終了時に関連するアプリ内メッセージがユーザーに表示されないようにする。 |
{: .reset-td-br-1 .reset-td-br-2 .reset-td-br-3 role="presentation" }

### ユースケース

ここでは、この機能をどのような場合に使用すべきかを説明します。Braze では、プロモーションキャンバスやオンボーディングキャンバスにこの機能を使用することを強くお勧めします。

{% tabs %}
  {% tab プロモーション %}

プロモーション、クーポン、セールには、多くの場合、ハードな有効期限があります。次のキャンバスは、購入を促すために、ユーザーに利用可能なプロモーションがあることを最も適切なタイミングで通知するよう設定されています。このプロモーションの有効期限は2019年2月28日午前11時15分（貴社時間帯）である。

<style type="text/css">
.tg td{word-break:normal;}
.tg th{word-break:normal;}
</style>

<table class="tg">
<thead>
  <tr>
    <th>キャンバスステップ</th>
    <th>遅延</th>
    <th>オーディエンス</th>
    <th>チャネル</th>
    <th>有効期限</th>
    <th>ユーザー昇進</th>
    <th>詳細</th>
  </tr>
</thead>
<tbody>
  <tr>
    <td>1 日目: 50% 割引</td>
    <td>なし</td>
    <td>エントリ全員</td>
    <td>プッシュ</td>
    <td>N/A</td>
    <td>延期期間後にオーディエンスを昇進させる</td>
    <td>プロモーションについてユーザーに警告する最初のプッシュ通知。この目的は、プロモーションを利用するようにユーザーをアプリに誘導することです。</td>
  </tr>
  <tr>
    <td>アプリ内: 50% 割引</td>
    <td>なし</td>
    <td>エントリ全員</td>
    <td>アプリ内メッセージ</td>
    <td><b>有効期限:</b>2019 年 2 月 28 日午前 11 時 15 分 (会社時刻)</td>
    <td>アプリ内メッセージの表示</td>
    <td>ユーザーがアプリを開いたので、以前にプッシュメッセージがあったかどうかにかかわらず、このメッセージが表示されます。</td>
  </tr>
  <tr>
    <td>50% 割引リマインダー</td>
    <td>ユーザーが前のステップを受け取ってから 1 日後</td>
    <td>エントリ全員 <br><br><b>フィルター:</b>最終購入日が 1 週間以上前</td>
    <td>アプリ内メッセージ</td>
    <td><b>有効期限:</b>2019 年 2 月 28 日午前 11 時 15 分 (会社時刻)</td>
    <td>なし (キャンバスの最後のメッセージ)</td>
    <td>ユーザーは前のステップでアプリ内メッセージを受信しましたが、アプリを開いたにもかかわらず購入していません。<br><br>このメッセージは、プロモーションを利用して購入するユーザーをさらに引き付けることが目的です。</td>
  </tr>
</tbody>
</table>

ご覧のように、メッセージングとカスタマーエクスペリエンスの間に相違が生じないように、アプリ内メッセージはプロモーションの有効期限が切れると期限切れになります。

  {% endtab %}
  {% tab ユーザーオンボーディング %}

ユーザーの第一印象は、おそらく最も重要なインプレッションです。これによって今後アプリにアクセスするかどうかが決まります。ユーザーとの初期のコミュニケーションは適切なタイミングで行い、アプリに頻繁にアクセスするよう働きかけてアプリの使用を促進する必要があります。

<table class="tg">
<thead>
  <tr>
    <th>キャンバスステップ</th>
    <th>遅延</th>
    <th>オーディエンス</th>
    <th>チャネル</th>
    <th>有効期限</th>
    <th>ユーザー昇進</th>
    <th>詳細</th>
  </tr>
</thead>
<tbody>
  <tr>
    <td>ウェルカムメール</td>
    <td>なし</td>
    <td>エントリ全員</td>
    <td>メール</td>
    <td>N/A</td>
    <td>延期期間後にオーディエンスを昇進させる</td>
    <td>プロジェクト、メンバーシップ、またはその他のオンボーディングプログラムにユーザーを歓迎する最初のメール。<br><br>これは、ユーザーをアプリに誘導してオンボーディングを開始してもらうことが目的です。</td>
  </tr>
  <tr>
    <td>3 ～ 6 日目のアプリ内メッセージ</td>
    <td>ユーザーが前のステップを受け取ってから 3 日後</td>
    <td>エントリ全員</td>
    <td>アプリ内メッセージ</td>
    <td><b>有効期限:</b>ステップが利用可能になってから 3 日後</td>
    <td>アプリ内メッセージが有効</td>
    <td>ユーザーがメールに基づいて行動しアプリにたどり着いた場合、ユーザーは希望するアプリ内メッセージを受け取り、オンボーディングとそれに関連する要件を続行またはリマインドします。</td>
  </tr>
  <tr>
    <td>5 日目のプッシュ通知 </td>
    <td>ユーザーが前のステップを受け取ってから 2 日後</td>
    <td>エントリ全員</td>
    <td>プッシュ</td>
    <td>N/A</td>
    <td>メッセージの送信</td>
    <td>ユーザーはアプリ内メッセージを受信した後、オンボーディングを続けるためのフォローアッププッシュ通知を受け取ります。</td>
  </tr>
</tbody>
</table>

これらのプッシュメッセージは、ユーザーがアプリを訪問し、オンボーディングを開始したことを確認するために、アプリ内メッセージの周りに間隔をあけて表示される。これにより、ユーザーがアプリにアクセスするのを躊躇させるようなスパムや秩序を乱したメッセージングを防ぎ、代わりにアプリでの最初の体験に流れるような、理にかなった順序を作り出すことができる。

  {% endtab %}
{% endtabs %}


## アプリ内メッセージの優先順位

ユーザーはキャンバス内で同時に2つのアプリ内メッセージをトリガーすることができる。この場合、表示されるアプリ内メッセージが Braze により以下の優先順位に従って決定されます。 

**正確な優先度を設定**を選択し、異なるキャンバスのステップをドラッグしてキャンバスの優先順位を並べ替える。デフォルトでは、キャンバスバリアントの前のステップから順に表示されます。ステップの優先順位が決まったら、「**並べ替えを適用**」を選択する。

![]({% image_buster /assets/img_archive/canvas_priority2.png %}){: style="max-width:85%"}

### 現役キャンバスの下書きに変更を加える

アクティブなキャンバスの下書きの**送信**設定でアプリ内メッセージの優先度を変更すると、優先度ソーターを閉じたときに、その変更がアクティブなキャンバスに直接適用される。しかし、メッセージステップでは、キャンバスステップの設定がステップレベルで適用されるため、下書きが開始されると優先順位ソーターが更新される。 

## 昇進動作

メッセージング・コンポーネントは、ステップに入ったすべてのユーザーを自動的に進める。アプリ内メッセージのトリガーや表示を待たないことに注意。メッセージの昇進動作を指定する必要はなく、全体的なステップの設定がより簡単になります。

ユーザーがアプリ内メッセージのステップに入ると、有効期限まで保留されるのではなく、すぐにそのステップから進む。この場合、ユーザー・ジャーニーにDelayステップを設けることが有効だ。

**Advance when message sent**オプションを実装したい場合、前のステップを受信しなかったユーザーをフィルターするために、別の[オーディエンスパスを]({{site.baseurl}}/user_guide/engagement_tools/canvas/canvas_components/audience_paths/)追加する。

{% details オリジナルのキャンバスエディター %}

{% alert important %}
2023 年 2 月 28 日以降、元のエディターを使用したキャンバスの作成や複製はできなくなりました。このセクションは、アプリ内メッセージを使ったステップの昇進動作の仕組みを理解するための参考にしてください。
{% endalert %}

元のエディターで作成されたキャンバスには、昇進動作、つまりキャンバスコンポーネントを段階的に進めるための基準を指定する必要があります。[アプリ内メッセージのみのステップには](#steps-iam-only)、[複数のメッセージタイプ](#steps-multiple-channels)（プッシュやメールなど[）を持つステップとは](#steps-multiple-channels)異なる進級オプションがある。キャンバスフローワークフローのアプリ内メッセージの場合、このオプションは常にオーディエンスをすぐに昇進させるように設定されています。

アクションベースの配信は、アプリ内メッセージのあるキャンバスステップでは使用できません。アプリ内メッセージのあるキャンバスステップは、スケジュールする必要があります。代わりに、キャンバスコンポーネントでスケジュールされたメッセージがユーザーに送信された後、ユーザーが (開始セッションによってトリガーされて) 初めてアプリを開いたときに、キャンバスのアプリ内メッセージが表示されます。

1 つのキャンバス内に複数のアプリ内メッセージがある場合、ユーザーはそれらの個別のメッセージをそれぞれ受信するために複数のセッションを開始する必要があります。

![]({% image_buster /assets/img/iam-advancement-behavior.png %})

{% alert important %}
[**アプリ内メッセージが有効なときにユーザーを昇進させる**] を選択すると、ユーザーが後続のステップに移動した後も、アプリ内メッセージは有効期限が切れるまで利用可能になります。キャンバスの次のステップが配信されたときにアプリ内メッセージを有効にしたくない場合は、有効期限を後続のステップの遅延よりも短く設定してください。
{% endalert %}

#### 複数のチャネルを含むステップ {#steps-multiple-channels}

アプリ内メッセージと別のチャネルを含むステップには、以下の高度なオプションがあります。

| オプション | 説明 |
|---|---|---|
| メッセージ送信時のアドバンス | ユーザは、メール、Webhook、またはプッシュ通知を送信するか、アプリ内メッセージを表示して、キャンバス内の後続のステップに進む必要があります。 <br> <br>  アプリ内メッセージの有効期限が切れても、ユーザーにメール、Webhook、プッシュ通知が送信されていないか、アプリ内メッセージが表示されていない場合、ユーザーはキャンバスを退出し、次のステップに進みません。 |
| すぐにオーディエンスを次に進める | 延期期間が経過すると、メッセージを表示したかどうかにかかわらず、そのステップのオーディエンス全員が次のステップに進みます。<br> <br> 次回のステップに進むには、ステップのSegment基準とフィルター基準を満たす必要があります。 |
{: .reset-td-br-1 .reset-td-br-2 role="presentation" }

![]({% image_buster /assets/img/push-advancement-behavior.png %})

{% alert important %}
**Entire Audience**を選択した場合、ユーザーが次のステップsに移動した場合でも、有効期限が切れるまでアプリ内メッセージが使用可能になります。キャンバスの次のステップが配信されるときにこのアプリ内メッセージを有効にしない場合は、有効期限が後続のステップの延期期間よりも短いことを確認してください。
{% endalert %}

{% enddetails %}

## トリガーアクション

ユーザーをターゲットにするトリガーアクションを以下の中から選ぶことができる：

- **購入する：**あらゆる購入、または特定の購入をしたユーザーをターゲットにする。
- **セッションを開始する：**任意のアプリまたは特定のアプリでセッションを開始したユーザーを対象とする
- **カスタムイベントを実行:**選択したカスタムイベントを実行したユーザーを対象とする。

ユーザーはキャンバスステップに入り、セッションを開始し、アプリ内メッセージを受け取るトリガーを実行しなければならない。つまり、セッション途中での更新はサポートされていない。例えば、トリガーがセッション開始の場合、ユーザーはキャンバスステップに入り、セッションを開始するだけで、アプリ内メッセージを受け取ることができる。トリガーがセッションを開始するものでない場合、ユーザーはキャンバスステップに入り、セッションを開始し、アプリ内メッセージを受け取るためにトリガーを実行しなければならない。

![トリガーアクションとして選択された "特定の購入"]({% image_buster /assets/img_archive/canvas_trigger_actions.png %}){: style="max-width:85%"}

以下のキャンバス機能はアプリ内メッセージでは利用できないため、オンにしていてもアプリ内メッセージには適用されない。

- インテリジェントタイミング
- レート制限
- フリークエンシーキャップ
- 終了条件
- サイレント時間

## キャンバスのカスタムイベントプロパティ

キャンバス用アプリ内メッセージのカスタムイベントプロパティがサポートされた。ただし、これらのプロパティは、アプリ内メッセージのトリガーとなるカスタムイベントや購入のものであり、直前のアクションパスではなく、メッセージステップにある。
