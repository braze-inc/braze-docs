---
nav_title: AIステップ
article_title: AIステップ
permalink: /ai_step/
description: "この参考記事では、キャンバス AI ステップについて説明します。"
Tool:
  - Canvas
hidden: true
---

# AIステップ

> キャンバス内の AI ステップは ChatGPT を利用して、ユーザーが生成したインプット (アンケートのフィードバックなど) を解釈し、適切な回答を決定し、メッセージをトリガーすることで、パーソナライズされたマーケティングを自動化します。ChatGPT はサードパーティの OpenAI によって運用されています。

{% alert note %}
AIステップは現在ベータ機能として提供されている。このベータトライアルへの参加に興味がある場合は、カスタマーサクセスマネージャーにお問い合わせください。
{% endalert %}

## AI ステップの作成 {#create-ai-step}
 
1. キャンバスに新しいステップを追加し、[**AI ステップ**] を選択します。<br><br>![キャンバスビルダーの AI ステップ][1]{: style="max-width: 30%;"}<br><br>
2. ユーザーのさまざまなアクションにどのように反応するかをAIに指示するプロンプトを作成する。応答としては、カスタム属性の更新やメッセージの送信などがあります。このプロンプトは、Liquid を使用して、異なるユーザー属性や入力に基づいて異なる応答出力を割り当てることができます。<br><br>同じキャンバス内で将来のメッセージをパーソナライズするために使用できる出力を割り当てるには、特定の名前 (たとえば、「メッセージ」と「センチメントスコア」) を持つ変数を保存するプロンプトを作成します。<br><br> ![生成されたセンチメントスコアに基づいてパーソナライズされたメッセージを送信するために AI ステップ設定で使用される AI プロンプトの例。この例は「顧客センチメント応答」セクションの下に記載されています。][2]<br><br>
3. **プレビュー・**タブを使って、特定のユーザーに対してAIがどのような出力をするかをテストする。<br><br> ![AIステップ設定のプレビュータブに、AIが生成したパーソナライズされたメッセージが表示されている。3つのパラメーター：キャメロンというファーストネーム、シューズという商品名、そして "comfy but my shoe lace already broke "というテキスト。][3]

## Liquidを使ってAIの出力を参照する
Liquid ロジック `{% raw %}{{ai_step_output.${key_name}}}{% endraw %}` を挿入することで、後のステップで AI 出力を参照します。AI ステップのプロンプト内に `key_name` を設定できます。

たとえば、変数「message」と「sentiment score」を使用する場合、`{% raw %}{{ai_step_output.${message}}}{% endraw %}` を使用して同じキャンバスで後続のメッセージをパーソナライズできます。

また、AI ステップの出力を読み取るユーザー更新キャンバスステップを使用して、AI ステップの出力をカスタム属性としてログに記録することもできます (例えば、`{% raw %}{{ai_step_output.${sentiment_score}}}{% endraw %}`)。出力がカスタム属性として保存されていない場合、同じキャンバスの後続ステップ以外の場所では使用できない。

## AIステップの統計

AIステップは以下のステップレベルのステータスを持つ：

- **次のステップに進む：**キャンバスの次のステップに進んだユーザー数
- **終了済みのキャンバス:**AI ステップが最後のステップであったため、キャンバスを終了したユーザーの数
- **出力に成功：**AIステップが正常に出力を生成したユーザー数
- **出力に失敗：**AIステップが出力に失敗したユーザーの数。この場合でも、ユーザーは後続のステップに進む。

### AIステップのアウトプットを理解する

BrazeがAIステップの出力を破棄し、顧客を次のステップに送るシナリオがいくつかある：
- 出力が1,024文字を超える場合
- 出力がJSONでない場合
- 不適切なユーザー作成コンテンツにフラグを立てるOpenAIの[モデレーション](https://platform.openai.com/docs/guides/moderation/overview)要件に、プロンプトが不合格になった場合

## AIステップの使用例

### 顧客センチメント応答

「[AI ステップの作成](#create-ai-step)」の例で示したように、顧客フィードバックから生成されたセンチメントスコアに基づいて、AI にフォローアップメッセージを送信させることができます。
- ポジティブなセンチメントスコア - ユーザーにレビューを残すよう求めるプッシュ通知をトリガーする
- 中程度のセンチメントスコア - 追加のヘルプが必要かをユーザーに尋ねるメールをトリガーする。
- センチメントスコアが低い - ユーザーのヘルプデスクに通知する Webhook をトリガーして、サポート担当者が絶妙なフォローアップを作成できるようにします。

#### AIプロンプトの例

この例は、「[AI ステップの作成](#create-ai-step)」で使用しました。

ある顧客が"`{% raw %}{{canvas_entry_properties.${product_name}}}{% endraw %}`"を購入し、"`{% raw %}{{canvas_entry_properties.${text}}}{% endraw %}`"という商品感想を述べた。センチメントスコアを0～100の整数値で作成する。そして、パーソナライズされたメッセージを作成します。これは、「message」と 「sentiment score」という2つの変数を返すはずです。

### 調査のフォローアップ

アプリ内またはブラウザ内で自由回答欄を設けたアンケートを実施する場合、AIステップを使って自由回答を分析し、適切なフォローアップを行うことができる。 

例えば、化粧品販売店が「今年のビューティー・アワードにノミネートしたい製品は何ですか」というアンケートを実施する場合、ユーザーの好きな製品タイプやブランドを特定して属性を割り当てるプロンプトを使用し、このデータに基づいて今後のコンテンツをパーソナライズすることができる。

#### AIプロンプトの例

ユーザーの応答からユーザーが好きなブランドを特定する。次に、アンケートに答えてくれたユーザーに感謝し、ビューティーエキスパートも彼らのお気に入りのブランドが好きであることを伝えるメッセージを作成します。これは2つの変数、"message "と "favorite brand "を返すはずだ。

![AI ステップ設定のプレビュータブには、アンケートの回答パラメーター「Estee Lauder フェイスクリームが好きです」に対して AI が生成したパーソナライズされたメッセージが表示されます。これは、ユーザーがアンケートに記入したことに感謝し、フェイスクリームをお勧めするものです。][4]

### 行動主導の提言

顧客は AI に、ユーザーの行動を分析してレコメンデーションメッセージを送信するように指示できます。 

たとえば、ユーザーが最近購入した50件を分析し、最もよく購入されるカテゴリーを新しいカスタム属性として設定するプロンプトを作成できます。次に、各ユーザーのお気に入りのカテゴリに対してパーソナライズされたおすすめメールを送信できます。

#### AIプロンプトの例

ある顧客が次の商品を購入した： "`{% raw %}{{custom_attribute.${Products Purchased}}}{% endraw %}`".ユーザーが最も購入した商品カテゴリーを特定します。これにより、「最も購入されたカテゴリー」の新しい変数が返されます。

![AIステップ設定のプレビュータブに、最も購入されたカテゴリのパラメータとしてAIが生成した変数「本」が表示されている。][5]

## レート制限

1社につき毎分10リクエスト (RPM) の制限があります。つまり、どのAIステップでも、1分間に最大10人のユーザーがそのステップを受けることができ、10人を超えたユーザーは自動的に次のステップに進む。次の分が始まると、ユーザーは再び AI ステップを受信できますが、レート制限をトリガーした以前のユーザーは再試行されません。

## AIステップの制限

- この機能はGPT-3.5を活用している。
- この機能は、Braze OpenAI APIキーを使用する。自身の OpenAI API キーは使えません。
- ワークスペースごとに1分あたり5要求 (RPM)、会社ごとに10 RPM という制限があります。
- この機能は HIPAA に準拠していないため、顧客は個人を特定できる情報 (PII) や保護されるべき医療情報 (PHI) を送信してはいけません。

## データはどのように使用されて、OpenAI に送信されるのですか?

メッセージ内容を分析して作成するために、BrazeはOpenAIのAPI Platformにプロンプトを送信する。Braze から OpenAI に送信されるすべてのクエリは匿名化されます。つまり、提供するメッセージコンテンツに一意に識別できる情報を含めない限り、OpenAI はクエリの送信元を特定できません。[OpenAI の API プラットフォームコミットメント](https://openai.com/policies/api-data-usage-policies)に詳述されているように、Braze 経由で OpenAI の API に送信されたデータは、モデルのトレーニングや改善には使用されず、30日後に削除されます。[使用ポリシー](https://openai.com/policies/usage-policies)など、お客様に関連する OpenAI のポリシーを必ず順守してください。Braze は AI が生成したコンテンツに関していかなる種類の保証も行いません。 

[1]: {% image_buster /assets/img/ai_step1.png %}
[2]: {% image_buster /assets/img/ai_step2.png %}
[3]: {% image_buster /assets/img/ai_step3.png %}
[4]: {% image_buster /assets/img/ai_step4.png %}
[5]: {% image_buster /assets/img/ai_step5.png %} 