---
nav_title: ユーザープロファイルデータの取得
article_title: コネクテッドコンテンツ呼び出しへのユーザープロファイルデータの取得
page_order: 5
description: "この記事では、コネクテッドコンテンツ呼び出しにユーザープロファイルを取得する方法、および Liquid のテンプレート作成に関するベストプラクティスを説明します。"

---

# ユーザープロファイル情報の取得

> このページでは、コネクテッドコンテンツ呼び出しにユーザープロファイルを取得する方法、および Liquid のテンプレート作成に関するベストプラクティスを説明します。 

コネクテッドコンテンツの応答にユーザープロファイルフィールド (Liquid パーソナライゼーションタグ内) が含まれている場合は、Liquid から返された内容を適切にレンダリングするために、事前に Liquid を使用してこれらの値をメッセージ内でコネクテッドコンテンツ呼び出しの前に定義する必要があります。同様に、`:rerender` フラグもリクエストに含める必要があります。`:rerender` フラグは、1 レベルの深さしかないことに注意してください。つまり、ネストされたコネクテッドコンテンツタグには適用されません。

パーソナライゼーションの場合、Braze は、ユーザープロファイルフィールドを取得した後でそのフィールドを Liquid に渡します。そのため、コネクテッドコンテンツからの応答にユーザープロファイルフィールドがある場合は、事前に定義する必要があります。 

たとえば、これがコネクテッドコンテンツ呼び出しの場合は、次のようになります。
{% raw %}
```liquid
Hi ${first_name},
{% connected_content https://examplewebsite.com :rerender %}
```
{% endraw %}
そしてConnected Contentのレスポンスは{% raw %}`Your language is ${language}`{% endraw %}で、このシナリオで表示される内容は`Hi Jon, your language is`になります。言語自体はテンプレート化されません。これは、Braze が、コネクテッドコンテンツ呼び出しを行う前に、ユーザーからどのフィールドを取得するかを知っている必要があるためです。

リキッドパスバックを適切にレンダリングするには、次のコードスニペットに示すように、{% raw %}`${language}`{%endraw%} タグをリクエストの任意の場所に配置する必要があります。リキッドプリプロセッサは、"language"属性をユーザーから取得して、レスポンスをテンプレート化する準備を整えることができます。
{%raw%}
```liquid
"Hi ${first_name}, {% connected_content https://examplewebsite.com?language=${language} :rerender %}
```
{% endraw %}
{% alert important %}
`:rerender` フラグは 1 レベルの深さしかないことに注意してください。コネクテッドコンテンツの応答自体にこれより多くのコネクテッドコンテンツタグまたはカタログタグがある場合、Braze はこれらの追加タグを再レンダリングしません。
{% endalert %}

## ベストプラクティス

### JSON 形式を壊す可能性がある Liquid タグで`json_escape`を使用してください

`:rerender` を使う場合、JSON フォーマットを壊す可能性のある Liquid タグには`json_escape` フィルターを加えます。もし、LiquidタグがJSONフォーマットを破る文字を含む場合、コネクテッドコンテンツのレスポンス全体がテキストとして解釈され、メッセージにテンプレート化され、変数は保存されない。

例えば、以下の例の`message` イベントプロパティに、JSONフォーマットを壊す可能性のある文字が含まれている場合、この例のように`json_escape` フィルターを追加する：

{% raw %}
```liquid
[{
"message":"{{event_properties.${message} | json_escape}}"
}]
```
{% endraw %}