---
nav_title: 再入荷通知
article_title: 再入荷通知の設定
page_order: 2
description: "カタログとカスタムイベントを使用して再入荷通知を設定する方法を説明します。このように設定することで、商品を再入荷したときに通知を受け取るように、顧客を自動的に購読登録できます。"
---

# 再入荷通知

> カタログとカスタムイベントを使用して再入荷通知を設定する方法を説明します。このように設定することで、商品を再入荷したときに通知を受け取るように、顧客を自動的に購読登録できます。これは、すでに通知をオプトインしているユーザーのみを対象としています。

## CDI の仕組み

`product_clicked` イベントなど、購読イベントとして使用するカスタムイベントを設定できます。このイベントには、アイテム ID (カタログアイテム ID) のプロパティが含まれている必要があります。カタログ名を入れることをお勧めするが、これは必須ではない。また、インベントリ数量フィールドの名前を指定する必要があります。これは数値データ型でなければなりません。 

ユーザーが特定のカタログアイテムの購読を登録できるようにするには、カタログアイテムの在庫がゼロでなければならない点に注意してください。あるアイテムの在庫数がゼロよりも大きくなると、Brazeはそのアイテムを購読しているすべてのユーザーを検索し、キャンペーンやキャンバスのトリガーとして使用できるカスタムイベントを送信します。

イベントプロパティはユーザーと一緒に送信されるため、アイテムの詳細を送信するキャンペーンまたはキャンバスにテンプレートで挿入できます。

## 再入荷通知の設定

次の手順に従って、特定のカタログで再入荷通知を設定します。

1. カタログにアクセスし、**「設定」**タブを選択する。
2. [**再入荷**] トグルを選択します。
3. グローバルな再入荷設定が構成されていない場合、再入荷通知をトリガーするために使用されるカスタムイベントとプロパティを設定するように求められます。
    <br> ![カタログ設定ドロワー。]({% image_buster /assets/img/catalog_settings_drawer.png %}){: style="max-width:70%;"}
    - **フォールバックカタログ** これは、カスタムイベントに `catalog_name` プロパティが存在しない場合に、再入荷購読に使用されるカタログです。
    - **サブスクリプションのカスタムイベント**は、在庫復活通知のためにユーザーをサブスクライブするために使用されるBrazeのカスタムイベントです。このイベントが発生すると、イベントを実行したユーザーが購読されます。
    - **配信停止のためのカスタムイベント**は、在庫復活通知の配信を停止するために使用されるBrazeのカスタムイベントです。このイベントはオプションです。もしユーザーがこのイベントを行わなかった場合、90日後、もしくは再入荷イベントがトリガーされた時、どちらか早く発生した時点で配信停止となります。
    - **アイテム ID イベントプロパティ**は、前述のカスタムイベントのプロパティで、再入荷の購読または購読解除を行うアイテムを決定するために使用されます。カスタムイベントのこのプロパティには、カタログにあるアイテム ID (`id`) を含める必要があります。アイテム ID は、ターゲットカタログに格納されている `id` データ型と一致するように、文字列として送信される必要があります。カスタムイベントには、このアイテムがどのカタログにあるかを指定するための`catalog_name`プロパティも含める必要があります。
    
    - カスタムイベントのサンプルは次のようになる。
    ```json
    {
        "events": [
            {
                "external_id": "<external_id>",
                "name": "subscription",
                "time": "2024-04-15T19:22:28Z",
                "properties": {
                    "id": "shirt-xl",
                    "catalog_name": "on_sale_products",
                    "type": ["back_in_stock"]
                }
            }
        ]
    }
    ```
{% alert note %}
再入荷トリガーと値下げトリガーは、同じイベントを使用してユーザーを通知にサブスクライブするため、同じイベントで値下げと再入荷通知の両方を設定するために `type` プロパティを使用できます。`type` プロパティは配列でなければなりません。
{% endalert %}

{: start="4"}
4. [**保存**] を選択し、カタログの [**設定**] ページに進みます。
5. 通知ルールを設定する。2 つのオプションがあります。
    \- [**サブスクリプション登録済みのすべてのユーザーに通知**] は、商品が再入荷すると、再入荷を待っているすべての顧客に通知します。
    - **Set notification limits** は、設定した通知期間ごとに、指定した数の顧客に通知します。Brazeは、通知する顧客がいなくなるか、アイテムが在庫切れになるまで、指定された数の顧客に段階的に通知します。通知速度は 1 分あたり 10,000 ユーザーを超えることはできません。
6. カタログの**インベントリフィールド**を設定します。このカタログフィールドは、アイテムが在庫切れかどうかを判断するために使用されます。フィールドは数値型である必要があります。
7. [**設定を保存**] を選択します。

![カタログ設定で、再入荷機能がオンになっていることを示します。通知ルールは、10 分ごとに 1,000 人のユーザーに通知することです。]({% image_buster /assets/img/back_in_stock_settings.png %})

{% alert important %}
これらの設定にある通知ルールは、キャンバスの通知設定（静粛時間など）を置き換えるものではない。
{% endalert %}

## キャンバスでの再入荷通知の使用

カタログで再入荷機能を設定した後、キャンバスで使用するには、次の手順に従ってください。

1. アクションベースのキャンバスを設定する。
2. **在庫あり**をトリガーとして選択します。
3. 再入荷通知があるカタログの名前を選択します。
4. キャンバスの[セットアップを]({{site.baseurl}}/user_guide/engagement_tools/canvas/create_a_canvas/create_a_canvas/)通常通り続ける。

今、商品が再入荷した際にお客様に通知することができます。

### Liquid の使用

再入荷したカタログアイテムの詳細をテンプレート化するには、 `canvas_entry_properties` Liquid タグでアクセス `item_id`。 

{%raw%}``{{canvas_entry_properties.${catalog_update}.item_id}}``{%endraw%} を使用すると、再入荷したアイテムの ID が返されます。{%raw%}``{{canvas_entry_properties.${catalog_update}.previous_value}}``{%endraw%} は更新前のアイテムの在庫データを返し、{%raw%}``{{canvas_entry_properties.${catalog_update}.new_value}}``{%endraw%} は更新後の新しい在庫データを返します。

この Liquid タグ {%raw%}``{% catalog_items <name_of_your_catalog> {{canvas_entry_properties.${catalog_update}.item_id}} %}``{%endraw%} をメッセージの冒頭で使い、{%raw%}``{{ items[0].<field_name> }}``{%endraw%} をメッセージ全体で使用してそのアイテムに関するデータにアクセスします。

## 考慮事項

- ユーザーの購読期間は 90 日間です。アイテムが 90 日以内に再入荷されない場合、ユーザーは購読解除されます。
- **通知すべての購読者** 通知ルールを使用する場合、Brazeは10分間で100,000人に通知します。
- Braze は 1 分あたり最大 10 件のアイテム更新を処理します。1 分間に 11 件のアイテムを更新した場合、最初の 10 アイテムのみが再入荷通知をトリガーできます。

