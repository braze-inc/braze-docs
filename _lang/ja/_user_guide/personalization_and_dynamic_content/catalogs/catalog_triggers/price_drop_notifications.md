---
nav_title: 値下げ通知
article_title: 値下げ通知
page_order: 3
alias: "/price_drop_notifications/"
description: "この参考記事では、Brazeカタログで値下げ通知を作成する方法について説明する。"
---

# 値下げ通知

> Brazeカタログによる値下げ通知とCanvasを組み合わせることで、商品の価格が下がったことを顧客に通知することができる。選択されたカスタムイベントを実行した顧客が、商品の価格が下がった時に通知を受け取れるよう自動的に配信登録できます。

ユーザーがアイテムのカスタムイベントをトリガーすると、そのアイテムの価格低下通知を受信できるよう自動的に購読登録されます。商品の価格が在庫ルール (50% 以上の値下げなど) を満たすと、すべての購読者はキャンペーンやキャンバスを通じて通知を受けることができます。ただし、通知を受け取ることができるのは、通知にオプトインしたユーザーのみです。 

## 値下げ通知の仕組み

`product_clicked` イベントなど、購読イベントとして使用するカスタムイベントを設定します。このイベントには、アイテム ID (カタログアイテム ID) のプロパティが含まれている必要があります。カタログ名を入れることをお勧めするが、これは必須ではない。価格フィールドの名前も指定するが、これは数値データ型でなければならない。 

選択されたカスタムイベントがユーザーによって実行され、`price_drop` を含む `type` プロパティを持つ場合、ユーザーとそれが発生したカタログアイテムのための価格低下の購読を作成するためにこのイベントを使用できます。また、この `type` 配列を使用して、同じイベントでprice-drop 通知とback-in-stock 通知の両方を設定することもできます。

アイテムに価格ルールを満たす価格変更がある場合、そのアイテムを購読しているすべてのユーザー (サブスクリプションイベントを行ったユーザー) を検索し、キャンペーンまたはキャンバスのトリガーに使用できる Braze カスタムイベントを送信します。

イベントプロパティはユーザーと一緒に送信されるため、アイテムの詳細を送信するキャンペーンまたはキャンバスにテンプレートで挿入できます。

## 値下げ通知を設定する

以下の手順に従って、特定のカタログで値下げ通知を設定する。

1. カタログにアクセスし、**「設定」**タブを選択する。<br>
2. **値下げ**トグルを選択する。<br>
3. グローバル・カタログ設定が構成されていない場合、通知のトリガーに使用されるカスタム・イベントとプロパティをセットアップするよう促される：
    <br> ![カタログ設定の引き出し。][2]{: style="max-width:70%;"}
    - **フォールバックカタログ: **カスタムイベントに`catalog_name` プロパティがない場合、サブスクリプションに使用されるカタログ。
    - **購読のカスタムイベント: **カタログ通知をユーザーに購読させるために使用されるBrazeカスタムイベント。このイベントが発生すると、そのイベントを実行したユーザーがサブスクライブされる。
    - **配信停止のカスタムイベント: **ユーザーを通知から購読解除するために使用される Braze カスタムイベント。
    - **アイテム ID イベントプロパティ: **サブスクリプションまたはアンサブスクリプションのアイテムを決定するために使用される、上記のカスタムイベントのプロパティ。カスタムイベントのこのプロパティは、カタログに存在するアイテムIDを含むべきである。カスタムイベントは、このアイテムがどのカタログにあるかを指定するために、`catalog_name` プロパティを含んでいる必要があります。
   
    - カスタムイベントのサンプルは次のようになる。
    ```json
    {
        "events": [
            {
                "external_id": "<external_id>",
                "name": "subscription",
                "time": "2024-04-15T19:22:28Z",
                "properties": {
                    "id": "shirt-xl",
                    "catalog_name": "on_sale_products",
                    "type": ["price_drop", "back_in_stock"]
                }
            }
        ]
    }
    ```

{: start="4"}
4. [**保存**] を選択し、カタログの [**設定**] ページに進みます。
5. 通知ルールを設定する。2 つのオプションがあります。
    \- [**サブスクリプション登録済みのすべてのユーザーに通知**] は、商品の価格が下がったときに、値下げを待っているすべての顧客に通知します。
    - **Set notification limits** は、設定した通知期間ごとに、指定した数の顧客に通知します。Braze は、通知する顧客がいなくなるまで、または商品の価格が再び上がるまで、指定された数の顧客に段階的に通知します。通知速度は 1 分あたり 10,000 ユーザーを超えることはできません。
6. **カタログの価格フィールド**を設定します。これは、商品の価格を決定するために使用されるカタログフィールドである。数値型でなければなりません。<br>
7. **値下げルール**を設定します。これは、通知が送信されるべきかどうかを決定するために使用されるロジックである。価格の低下は、価格の変化率、価格フィールドがどれだけ変化したかによって設定できます。<br>
8. [**設定を保存**] を選択します。

![値下げ機能がオンになっていることを示すカタログ設定。値下げルールは、元の価格に対して3％の変更である。][1]{:style="max-width:60%;"}

{% alert important %}
これらの設定にある通知ルールは、キャンバスの通知設定（静粛時間など）を置き換えるものではない。
{% endalert %}

## キャンバスで値下げ通知を使う

カタログで値下がり通知を設定した後、これらの通知をキャンバスで使用するには以下の手順に従う。

1. アクションベースのキャンバスを設定する。
2. トリガーとして [**値下げイベントを実行**] を選択します。
3. 価格下落通知のあるカタログ名を選択する。
4. キャンバスの[セットアップを]({{site.baseurl}}/user_guide/engagement_tools/canvas/create_a_canvas/create_a_canvas/)通常通り続ける。

これで、商品の価格が下がったときに顧客に通知される。

### Liquid の使用

値下がりしたカタログアイテムの詳細をテンプレートで挿入するには、`canvas_entry_properties` リキッドタグを使用して、`item_id` にアクセスします。 

{%raw%}``{{canvas_entry_properties.${catalog_update}.item_id}}``{%endraw%} を使用すると、価格が下がったアイテムの ID が返されます。{%raw%}``{{canvas_entry_properties.${catalog_update}.previous_value}}``{%endraw%} は更新前のアイテムの価格を返し、{%raw%}``{{canvas_entry_properties.${catalog_update}.new_value}}``{%endraw%} は更新後の新しい価格を返します。 

この Liquid タグ {%raw%}``{% catalog_items <name_of_your_catalog> {{canvas_entry_properties.${catalog_update}.item_id}} %}}``{%endraw%} をメッセージの冒頭で使い、{%raw%}`{{items[0].<field_name>}}`{%endraw%} をメッセージ全体で使用してそのアイテムに関するデータにアクセスします。

## 考慮事項

- ユーザーの購読期間は 90 日間です。アイテムが90日経っても値下がりしない場合、ユーザーはサブスクリプションから外される。
- **Notify all subscribed users**通知ルールを使用する場合、Brazeは10分間で10万人のユーザーに通知する。
- Braze は、1 分あたり最大 10 のアイテム更新を処理します。つまり、1分間に11のアイテムを更新した場合、最初の10アイテムだけが値下げ通知のトリガーとなる。

[1]: {% image_buster /assets/img/price_drop_notifications.png %}
[2]: {% image_buster /assets/img/catalog_settings_drawer.png %}
