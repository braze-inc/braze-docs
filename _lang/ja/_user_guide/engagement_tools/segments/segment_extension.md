---
nav_title: セグメントエクステンション
article_title: セグメントエクステンション
page_order: 3.1
page_type: reference
description: "この操作方法に関する記事では、セグメントエクステンションをセットアップして使用し、セグメンテーション機能を強化する方法について説明します。"
tool: Segments
---

# セグメントエクステンション

> セグメントエクステンションを使えば、ユーザーの履歴を長期間にわたって非常に正確にセグメントすることができる。例えば、セグメントエクステンションを使えば、過去16ヶ月の間に特定の製品を購入したユーザーや、あなたのサービスで一定の金額を利用したユーザーをターゲットにすることができます。イベントプロパティを使ってこのオーディエンスを絞り込み、ターゲティングをさらに細かくする。

Brazeのセグメンテーションにより、カスタムイベントや購買行動に基づいてユーザーをターゲットにすることができる。セグメントエクステンションはこの能力を強化し、ユーザープロファイルに保存された履歴データを活用できるようにする。セグメントエクステンションを使用すると、過去2年間 (730日間) に何度でもカスタムイベントや購入イベントを完了したユーザーを識別し、リーチすることができます。 

## セグメントエクステンションを使う理由

Brazeセグメントは、ダイナミックなユーザーグループを作成する強力なターゲティングツールを提供する。ほとんどのユースケースでは、オーディエンスに効果的にリーチするにはこれで十分です。セグメントエクステンションは、最大2年前の行動を分析したり、複雑なロジックを適用したりする必要がある高度なユースケース向けに設計されており、データのリテンションやシステムパフォーマンスを損なうことはない。[SQL]({{site.baseurl}}/user_guide/engagement_tools/segments/sql_segments) クエリや自社の[データウェアハウスの]({{site.baseurl}}/user_guide/engagement_tools/segments/segment_extension/cdi_segments)データを使って、さらにオーディエンスを絞り込むことができます。

例えば、Brazeのデフォルトセグメンテーションは、最近製品を購入したユーザーを識別するなど、あなたが定義した特定の基準に適合するユーザーを見つける。セグメントエクステンションを使用すると、特定の製品の特定の色を18から24か月前に少なくとも2回購入したユーザーを特定するなど、より詳細に分析できます。セグメントエクステンションは拡張機能であり、必要条件ではない。より高度なフィルターが必要な場合や、より長いルックバック・ウィンドウが必要な場合は、データ使用量を最適化しながら手助けしてくれる素晴らしいツールだ。

{% alert note %}
デフォルトでは、特定の時間に1つのワークスペースにつき25個のアクティブなセグメントエクステンションが割り当てられます。この制限を増やす必要がある場合は、Brazeカスタマーサクセスマネージャーに連絡して、ユースケースについて話し合ってください。
{% endalert %}

## セグメントエクステンションを作成する

セグメントエクステンションを作成するには、カスタムイベントプロパティに基づいてユーザーのセグメントを絞り込むフィルターを作成します。セグメントエクステンションを作成する際、セグメントを静的なものにするか、設定した間隔でダイナミックなリフレッシュを行うかを選択する。

### ステップ 1: セグメントエクステンションに移動する

[**オーディエンス**] > [**セグメントエクステンション**] に移動します。

[セグメントエクステンション] テーブルから、[**エクステンションを新規作成**] をクリックし、セグメントエクステンションの作成方法を選択します。

- **シンプルなエクステンション:**ガイド付きフォームを使用して、単一のイベントに焦点を当てたセグメントエクステンションを作成します。
SQL を使用しない場合に最適です。
- **テンプレートを使用して始める:**Snowflake データを使用して、カスタマイズ可能なテンプレートで SQL セグメントを作成します。
- **増分更新:**過去2日間のデータを自動的に更新するか、必要に応じて手動で更新する Snowflake SQL セグメントを作成します。精度とコスト効率のバランスをとるのに最適です。
- **完全更新:**手動更新時にオーディエンス全体を再計算する Snowflake SQL セグメントを作成します。オーディエンスに関する完全な最新のビューが必要な場合に最適です。

![さまざまなセグメントエクステンションの作成経験を選択できるテーブル。][20]{: style="max-width:50%"}

SQL を使用するエクスペリエンスを選択した場合の詳細は、[SQL セグメントエクステンション]({{site.baseurl}}/user_guide/engagement_tools/segments/sql_segments/)を参照してください。

「**簡易拡張**」を選択した場合は、以下のステップに進んでください。

### ステップ 2: セグメントエクステンションに名前を付ける

フィルタリングするユーザーのタイプを記述して、セグメントエクステンションに名前を付けます。これにより、このエクステンションをフィルターとしてセグメントに適用するときに、このエクステンションを簡単かつ正確に検出できます。

![「オンラインショッパーエクステンション - 90日」という名前のセグメントエクステンション。「エクステンションを毎日再生成」チェックボックスが選択されています。][2]

### ステップ 3: 条件を選択する

ターゲティングの条件として、購入、メッセージエンゲージメント、カスタムイベントのいずれかを選択します。希望のイベントタイプ条件を選択したら、ユーザーリストでターゲットにする購入アイテム、メッセージインタラクション、または特定のカスタムイベントを選択します。次に、ユーザーがイベントを完了する必要がある回数 (より大きい、より小さい、または等しい) と期間を選択します。特にセグメントエクステンションの場合は、過去730日間 (2年間) までさかのぼることができます。

730日を超えるイベントデータに基づくセグメンテーションは、**セグメント**にある他のフィルターを使用して実行できます。期間を選択するときは、相対的な日付範囲 (過去 X 日間など)、開始日、終了日、または正確な日付範囲 (日付 A ～ B) を指定できます。

![2023年8月1日から2023年8月10日までの期間に、カスタムイベント「# of aaa」を0回以上実行したユーザーのセグメンテーション基準。][3]

#### イベントプロパティのセグメンテーション

ターゲティングの精度を上げるには、[**プロパティフィルターを追加**] チェックボックスを選択します。これにより、購入またはカスタムイベントの特定のプロパティに基づいて掘り下げることができます。文字列、数値、ブール値、および時間オブジェクトに基づくイベントプロパティのセグメンテーションをサポートしています。

文字列プロパティの場合、複数の値を一度に入力できます。以下の例では、このフィルターは、ゴールド、シルバー、ブロンズのいずれかのステータスのユーザーを検索します。

![文字列のプロパティに基づいてセグメント化します。][13.5]

![数値プロパティに基づくセグメンテーション。][13]

![ブール値プロパティに基づくセグメンテーション。][14]

![日時オブジェクトに基づくセグメント化。][15]

[階層化イベントプロパティ]({{site.baseurl}}/user_guide/data/custom_data/custom_events/nested_objects/)に基づくセグメンテーションもサポートしています。

![ネストされたイベントプロパティに基づいてセグメント化します。][18]

セグメントエクステンションはイベントプロパティの長期保存に依存しており、タイムスタンプ付きのプロパティ保存制限はありません。過去2年間に追跡されたイベントプロパティを振り返ることができます。セグメントエクステンション内でイベントプロパティを使用しても、データポイント使用量には影響しません。

{% alert note %}
セグメントでイベントプロパティや階層化されたカスタム属性を使用するには、セグメントエクステンションは必要ない。セグメントエクステンションは、セグメントを作成するためのヒストリカルウインドウを拡張するだけである。過去30日間のイベント・プロパティを使用するか、階層化されたカスタム属性を使用するリアルタイム・[セグメントを]({{site.baseurl}}/user_guide/engagement_tools/segments/)作成することができる。同様に、セグメントエクステンションは必要なく、イベントプロパティに基づいてリアルタイムでトリガーされるように[メッセージをスケジュールする]({{site.baseurl}}/user_guide/engagement_tools/campaigns/building_campaigns/delivery_types/triggered_delivery/)ことができる。
{% endalert %}

### ステップ 4:リフレッシュ設定を指定する（オプション）

エクステンションを定期的に更新する必要がない場合は、更新設定を使用せずにエクステンションを保存できます。この場合 Braze は、デフォルトでその時点のユーザーメンバーシップに基づいてセグメントエクステンションを生成します。オーディエンスを一度だけ生成し、単発のキャンペーンでターゲットにしたい場合は、デフォルトの動作を使用する。

セグメントは常に最初の保存後に処理を開始します。セグメンテーションが更新されるたびに、Brazeはセグメンテーションを再実行し、更新時のセグメント内のユーザーを反映するようにセグメントメンバーシップを更新する。これにより、定期的なキャンペーンが最も関連性の高いユーザーに届くようになる。

#### 定期的なリフレッシュの設定

定期的なスケジュールを設定するには、特定のエクステンションの右上にある「**設定の更新**」を選択する。更新設定を指定するオプションは、すべてのタイプのセグメントエクステンション (SQL セグメント、CDIセグメント、シンプルなフォームベースのセグメントエクステンションなど) で利用できます。

{% alert important %}
データ管理を最適化するため、使用していないセグメントエクステンションのリフレッシュ設定は自動的にオフになる。セグメントエクステンションは、次の場合未使用とみなされます。

- アクティブまたは非アクティブ（下書き、停止、アーカイブ）キャンペーン、キャンバス、セグメンテーションで使用されていない。
- 7日以上変更されていない

この設定をオフにすると、Braze は会社の連絡先とエクステンションの作成者に通知します。エクステンションを毎日再生成するオプションはいつでも有効にできます。
{% endalert %}

#### リフレッシュ設定を選択する

![更新間隔は週単位、開始時刻は午前10時、曜日は月曜日を選択した設定。][21]{: style="max-width:60%;"}

**リフレッシュ設定**パネルで、セグメントエクステンションがリフレッシュされる頻度を選択できる：1時間ごと、毎日、毎週、毎月。また、リフレッシュが行われる特定の時間（あなたの会社のタイムゾーン内）を、次のように選択する必要がある：

- 毎週月曜日の午前11時（会社時間）に配信されるメールキャンペーンで、配信直前にセグメンテーションを確実に更新したい場合は、毎週月曜日の午前10時に更新するスケジュールを選択する。
- セグメンテーションを毎日更新したい場合は、毎日の更新頻度を選択し、更新する時間帯を選択する。

{% alert note %}
フォームベースのセグメントエクステンションでは、1時間ごとの更新スケジュールを設定することはできない（ただし、毎日、毎週、毎月のスケジュールは設定できる）。
{% endalert %}

#### クレジット消費量と追加のコスト

更新によりセグメントのクエリが再実行されるので、SQL セグメントを更新するたびに、SQL セグメントクレジットが消費され、CDI セグメントを更新するたびに、サードパーティデータウェアハウス内でコストが発生します。

{% alert note %}
データ処理時間のために、セグメントの更新には最大60分かかることがあります。現在更新処理中のセグメントには、セグメントエクステンションリストで「処理中」ステータスが表示されます。これはいくつかの影響を伴います。

- 特定の時刻よりも前にセグメントの処理を終了するには、60分未満の更新時間を選択します。 
- 特定のセグメントエクステンションの更新は一度に1回だけ実行できます。既存の更新の処理がすでに開始されている場合に新しい更新が開始される競合的な状況では、Braze は新しい更新リクエストをキャンセルして、進行中の処理を続行します。
{% endalert %}

#### 古くなった拡張機能を自動的に無効にする基準

セグメントエクステンションが古くなると、スケジュールされたリフレッシュは自動的に無効になる。セグメントエクステンションは、以下の条件を満たす場合、古くなる：

- アクティブなキャンペーンまたはキャンバスでは使用されていない
- アクティブなキャンペーンまたはキャンバス内のセグメントでは使用されていない
- [分析トラッキングを]({{site.baseurl}}/user_guide/analytics/tracking/segment_analytics_tracking#segment-analytics-tracking)オンにしているセグメンテーションでは使用しない。
- 7日以上変更されていない
- キャンペーン、キャンバス（下書きを含む）、セグメンテーションに7日以上追加されていない。

セグメントエクステンションでスケジュールされたリフレッシュが無効になっている場合、そのエクステンションにはその旨の通知が表示される。

![このエクステンションは、アクティブなキャンペーン、キャンバス、セグメントで使用されていないため、スケジュールされたリフレッシュはオフになっています。セグメントエクステンションは2025年2月23日午前12時に無効となった。"][1]

古くなったセグメントエクステンションを使用する準備ができたら、[リフレッシュ設定を確認](#step-4-designate-refresh-settings-optional)し、ユースケースに合ったリフレッシュスケジュールを選択し、変更を保存する。

### ステップ 5: セグメントエクステンションを保存する

[**保存**] を選択すると、エクステンションの処理が開始されます。エクステンションの生成にかかる時間は、ユーザーの数、キャプチャするカスタムイベントまたは購入イベントの数、履歴を振り返る日数によって異なります。

エクステンションが処理されている間、エクステンションの名前の横に小さなアニメーションが表示され、エクステンションリストの [**最終処理日**] 列に 「処理中」 という単語が表示されます。処理中はエクステンションを編集できないことに注意してください。

!["セグメントエクステンション "ページには、2つのアクティブなエクステンションがある。][5]

### ステップ 6:エクステンションをセグメントで使用する

エクステンションを作成したら、セグメントを作成したり、キャンペーンやキャンバスのオーディエンスを定義したりする際のフィルターとして使用できます。まず、[**ユーザー属性**] セクションのフィルターリストから [**Braze セグメントエクステンション**] を選択します。

!["フィルター "セクションに "Brazeセグメントエクステンション "のドロップダウンフィルターが追加された。][6]

Braze セグメントエクステンションフィルターリストから、このセグメントに含める、または除外したいエクステンションを選択します。

![セグメント「Online Shoppers Ext...」を含む「Brazeセグメントエクステンション」フィルター。][7]

エクステンションの基準を表示するには、**「エクステンションの詳細を表示**」を選択し、詳細をモーダルポップで表示する。

![オンライン・ショッパーズ・エクステンション - 90日間」のエクステンション詳細。][8]{: style="max-width:70%;"}

これで、通常どおりに [セグメントを作成][11] できます。

## よくある質問

### 複数のカスタムイベントを使用するセグメント・エクステンションを作成できるか？

はい。[SQLセグメントエクステンションを]({{site.baseurl}}/user_guide/engagement_tools/segments/sql_segments/)使用する場合、複数のイベントを追加したり、複数のSnowflakeテーブルを参照したりすることができる。 

**シンプルエクステンションセグメントエクステンションを**使用する場合、カスタムイベントを1つ、購入イベントを1つ、またはチャネルインタラクションを1つ選択できる。ただし、セグメントを作成するときに、複数のセグメントエクステンションをANDまたはORで組み合わせることができる。

### アクティブなキャンペーンにセグメントエクステンションが存在する場合、アーカイブすることは可能か？

セグメントエクステンションをアーカイブする前に、そのセグメントエクステンションをすべてのアクティブなメッセージングから削除する必要がある。

[1]: {% image_buster /assets/img/segment/segment_extension_disabled.png %}
[2]: {% image_buster /assets/img/segment/segment_extension2.png %}
[3]: {% image_buster /assets/img/segment/segment_extension1.png %}
[5]: {% image_buster /assets/img/segment/segment_extension5.png %}
[6]: {% image_buster /assets/img/segment/segment_extension7.png %}
[7]: {% image_buster /assets/img/segment/segment_extension6.png %}
[8]: {% image_buster /assets/img/segment/segment_extension8.png %}
[10]: {{site.baseurl}}/user_guide/engagement_tools/segments/segmentation_filters/
[11]: {{site.baseurl}}/user_guide/engagement_tools/segments/creating_a_segment/
[12]: {% image_buster /assets/img/segment/property1.png %}
[13]: {% image_buster /assets/img/segment/property2.png %}
[13.5]: {% image_buster /assets/img/segment/property5.png %}
[14]: {% image_buster /assets/img/segment/property3.png %}
[15]: {% image_buster /assets/img/segment/property4.png %}
[16]: {% image_buster /assets/img/Shopify/arrow.jpeg %}
[17]: {% image_buster /assets/img/segment/segment_extension9.png %}
[18]: {% image_buster /assets/img/segment/nested_segment_extensions.png %}
[20]: {% image_buster /assets/img/segment/segment_extension_modal.png %}
[21]: {% image_buster /assets/img/segment/segment_interval_settings.png %}
