---
nav_title: ジオフェンスの作成
article_title: ジオフェンスの作成
page_order: 1
page_type: reference
description: "この参考記事では、ジオフェンスとは何か、ジオフェンスイベントを作成および構成する方法について説明します。"
tool: 
  - Location
search_rank: 9
---

# ジオフェンス

> Braze のリアルタイム位置情報サービスの中核となるのが、ジオフェンスの概念です。ジオフェンスは、緯度と経度を半径と組み合わせて表し、地球上の特定の位置の周りを円で囲んだ仮想的な地理的領域です。ジオフェンスは、建物の大きさから都市全体の大きさまでさまざまです。

Braze ダッシュボードでジオフェンスを定義し、それを使用して、ユーザーが境界を出入りするときにリアルタイムでキャンペーンをトリガーしたり、数時間または数日後にフォローアップキャンペーンを送信したりできます。ジオフェンスに出入りするユーザーは、セグメンテーションや再ターゲティングに使用できる新しいユーザーデータレイヤーを追加します。

## 概要

ジオフェンスは、[**オーディエンス**] > [**位置情報**] で管理します。

{% alert note %}
[古いナビゲーション]({{site.baseurl}}/navigation)を使用している場合は、[**エンゲージメント**] の下に [**位置情報**] が表示されます。
{% endalert %}

ジオフェンスは、ジオフェンスセットに編成されます。ジオフェンスセットは、プラットフォーム全体でユーザーをセグメント化したりエンゲージしたりするために使用できるジオフェンスのグループです。各ジオフェンスセットには、最大 10,000 個のジオフェンスを格納できます。

ダッシュボードでは無制限の数のジオフェンスを作成またはアップロードできるため、マーケティングチームはジオフェンスの数を計算せずに、ジオフェンスセットやキャンペーンを設定できます。Braze は、ユーザーにとって最も関連性の高いジオフェンスが常に利用できるよう、各ユーザーに対して追跡するジオフェンスを動的に再同期します。

- Android アプリは一度に最大 100 か所のジオフェンスをローカルに保存できます。Braze は、アプリごとに最大 20 か所のジオフェンスをローカルに保存するように構成されています。
- iOS デバイスは、アプリごとに一度に最大 20 か所のジオフェンスを監視できます。スペースに余裕があれば、Braze は最大 20 か所を監視します。 
- ユーザーが 20 か所以上のジオフェンスを受信する資格がある場合、Braze はセッション開始/サイレントプッシュ更新の時点でユーザーとの距離に基づいて最大数の場所をダウンロードします。
- ジオフェンスが正しく機能するには、アプリが利用可能なジオフェンスのすべてのスポットを使用していないことを確認する必要があります。

## ジオフェンスセットを作成する

### セットを手動で作成する

[**位置情報**] ページで、[**+ジオフェンスセットを作成**] をクリックします。

![ユーザーがハンブルク空港の地図上に半径 2,000 メートルの円を描画したドイツの空港のジオフェンスセット。][1]

ジオフェンスセットを作成したら、地図上にジオフェンスを描画することで手動でジオフェンスを追加できます。最適な機能するために、半径 200 メートル以上のジオフェンスを作成することをお勧めします。設定可能なオプションの詳細については、 [ジオフェンスの設定]({{site.baseurl}}/user_guide/engagement_tools/locations_and_geofences/geofence_configuration/)を参照してください。

### 一括アップロードによるセットの作成 {#creating-geofence-sets-via-bulk-upload}

ジオフェンスは、`FeatureCollection` タイプの GeoJSON オブジェクトとして一括アップロードできます。それぞれのジオフェンスはフィーチャ コレクション内の `Point` タイプのジオメトリです。各機能のプロパティには、`"radius"` キーと、各ジオフェンスのオプションの `"name"` キーが必要です。GeoJSON をアップロードするには、[**\+ ジオフェンスセットを作成**] をクリックし、[**GeoJSON をアップロード**] をクリックします。

次のサンプルは、2 つのジオフェンスを指定するための正しい GeoJSON を表しています。1 つはニューヨーク市の Braze 本社用、もう 1 つはマンハッタン南部の自由の女神像用です。最適な機能を得るには、半径 100 メートル以上のジオフェンスをアップロードすることをお勧めします。

```
{
  "type": "FeatureCollection",
  "features": [
    {
      "type": "Feature",
      "geometry": {
        "type": "Point",
        "coordinates": [-73.992473, 40.755669]
      },
      "properties": {
        "radius": 200,
        "name": "Braze HQ"
      }
    },
    {
      "type": "Feature",
      "geometry": {
        "type": "Point",
        "coordinates": [-74.044468, 40.689225]
       },
      "properties": {
        "radius": 100,
        "name": "Statue of Liberty"
      }
    }
  ]
}
```

ジオフェンスを作成するときは、次の点に注意してください。

- GeoJSON の `coordinates` 値は [経度, 緯度] の形式になります。
- アップロードできるジオフェンスの最大半径は 10,0000 メートル (約 100 キロメートルまたは 62 マイル) です。

## ジオフェンスセットの更新

アクティブユーザーの場合、Braze SDK はセッション開始時に 1 日に 1 回だけジオフェンスを要求します。つまり、セッション開始後にジオフェンスセットに変更が加えられた場合、更新されたセットを受け取るには、セットが最初にプルダウンされてから  24  時間待つ必要があります。

非アクティブユーザーの場合、ユーザーがバックグラウンドプッシュを有効にすると、Braze は 24  時間ごとにサイレントプッシュを送信して、最新の位置情報をデバイスに取り込みます。

{% alert note %}
ジオフェンスがデバイスにローカルに読み込まれていない場合、ユーザーは領域に入ってもジオフェンスをトリガーできません。
{% endalert %}

### 個々のユーザーの更新

個々のユーザーのジオフェンスを更新すると、テスト時に役立つ場合があります。ジオフェンスセットを更新するには、[**位置情報**] ページの下部に移動し、[**ジオフェンスを再同期**] をクリックします。更新するユーザーの`external_id` または`email` の入力が求められます。

## ジオフェンスイベントの使用

ジオフェンスを構成すると、それを使用してユーザーとのコミュニケーションを強化し、充実させることができます。

### トリガー

キャンペーンおよびキャンバス トリガーの一部としてジオフェンスデータを使用するには、配信方法として**アクションベースの配信**を選択します。次に、`Trigger a Geofence` のトリガーアクションを追加します。最後に、メッセージのジオフェンスセットとジオフェンス移行イベントのタイプを選択します。また、ジオフェンスイベントを使用して、キャンバス経由でユーザーを昇格させることもできます。

![][2]

### パーソナライゼーション

ジオフェンスデータを使用してメッセージをパーソナライズするには、次の Liquid パーソナライズ構文を使用できます。

{% raw %}
* `{{event_properties.${geofence_name}}}`
* `{{event_properties.${geofence_set_name}}}`
{% endraw %}

## よくある質問

ジオフェンスに関するよくある質問への回答については、[ジオフェンス FAQ][3]をご覧ください。


[1]: {% image_buster /assets/img_archive/locations_main_screen.png %}
[2]: {% image_buster /assets/img_archive/action_based_geofence_trigger.png %}
[3]: {{site.baseurl}}/user_guide/engagement_tools/locations_and_geofences/faqs/#geofences
