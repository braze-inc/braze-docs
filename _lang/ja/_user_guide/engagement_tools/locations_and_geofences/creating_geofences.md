---
nav_title: ジオフェンスの作成
article_title: ジオフェンスの作成
page_order: 1
page_type: reference
toc_headers: h2
description: "この参考記事では、ジオフェンスとは何か、ジオフェンスイベントを作成および構成する方法について説明します。"
tool: 
  - Location
search_rank: 9
---

# ジオフェンス

> Braze のリアルタイム位置情報サービスの中核となるのが、ジオフェンスの概念です。ジオフェンスは、緯度と経度を半径と組み合わせて表し、地球上の特定の位置の周りを円で囲んだ仮想的な地理的領域です。ジオフェンスは、建物の大きさから都市全体の大きさまでさまざまです。

## CDI の仕組み

ジオフェンスをを使用して、ユーザーが境界を出入りするときにリアルタイムでキャンペーンをトリガーしたり、数時間または数日後にフォローアップキャンペーンを送信したりできます。ジオフェンスに出入りするユーザーは、セグメンテーションや再ターゲティングに使用できる新しいユーザーデータレイヤーを追加します。

ジオフェンスは、ジオフェンスセットに編成されます。ジオフェンスセットは、プラットフォーム全体でユーザーをセグメント化したりエンゲージしたりするために使用できるジオフェンスのグループです。各ジオフェンスセットには、最大 10,000 個のジオフェンスを格納できます。

作成またはアップロードできるジオフェンスの数に制限はありません。

- Android アプリは一度に最大 100 か所のジオフェンスをローカルに保存できます。Braze は、アプリごとに最大 20 か所のジオフェンスをローカルに保存するように構成されています。
- iOS デバイスは、アプリごとに一度に最大 20 か所のジオフェンスを監視できます。スペースに余裕があれば、Braze は最大 20 か所を監視します。 
- ユーザーが20以上のジオフェンスを受け取る資格がある場合、Brazeはセッション開始時点におけるユーザーとの近接性に基づいて、最大量のロケーションをダウンロードする。
- ジオフェンスが正しく機能するには、アプリが利用可能なジオフェンスのすべてのスポットを使用していないことを確認する必要があります。

ジオフェンスの用語とその説明については、次の表を参照してください。

| 用語 | 説明 |
|---|---|
| 緯度と経度 | ジオフェンスの地理的中心。 |
| 半径 | 地理的中心から計測されたジオフェンスの半径 (メートル単位)。すべてのジオフェンスで最小半径を100～150 メートルに設定することをお勧めします。 |
| クールダウン | ユーザーは、個々のジオフェンスで出入りを移行した後、ジオフェンスからトリガーされる通知を受け取ります。移行が発生した後、そのユーザーが個々のジオフェンスで同じ移行を繰り返さない期間があらかじめ定義されています。この期間は「クールダウン」と呼ばれ、Braze によりあらかじめ定義されており、その主な目的は、不要なネットワーク要求を防ぐことです。 |
{: .reset-td-br-1 .reset-td-br-2 role="presentation" }

## ジオフェンスを手動で作成する

### ステップ 1: ジオフェンスセットを作成する

ジオフェンスを作成するには、まずジオフェンスセットを作成する必要がある。

1. Braze ダッシュボードの [**オーディエンス**] > [**ロケーション**] に移動します。
2. [**ジオフェンスセットを作成**] を選択します。
3. [**名前を設定**] に、ジオフェンスセットの名前を入力します。
4. (オプション）タグを追加して、セットをフィルターする。

### ステップ2: ジオフェンスを追加する

次に、ジオフェンスをジオフェンスセットに追加できます。

1. [**ジオフェンスを描画**] を選択し、地図上の円をクリックしてドラッグします。この操作を繰り返して、必要な数のジオフェンスをセットに追加します。
2. (任意) [**編集**] を選択し、ジオフェンスの説明を名前に置き換えることができます。
3. 保存するため [**ジオフェンスセットを保存**] を選択します。

{% alert tip %}
最適な機能するために、半径 200 メートル以上のジオフェンスを作成することをお勧めします。設定可能なオプションの詳細については、[モバイル統合](#mobile-integrations)を参照してください。
{% endalert %}

![「EastCoastGreaterNY」と「WesternRegion」の 2 つのジオフェンスが地図上に 2 つの円で描画されたジオフェンスセット。]({% image_buster /assets/img/geofence_example.png %})

## ジオフェンスの一括アップロード {#creating-geofence-sets-via-bulk-upload}

ジオフェンスは、`FeatureCollection` タイプの GeoJSON オブジェクトとして一括アップロードできます。各ジオフェンスはフィーチャ コレクション内の `Point` タイプのジオメトリです。各機能のプロパティには、`radius` キーと、各ジオフェンスのオプションの `name` キーが必要です。 

GeoJSON をアップロードするには、[**その他**] > ]**GeoJSON をアップロード**] を選択します。

ジオフェンスを作成する際には、以下の詳細を考慮すること：

- GeoJSON の `coordinates` 値は `[Longitude, Latitude]` の形式になります。
- アップロードできるジオフェンスの最大半径は 10,000 メートル (約 100 キロメートルまたは 62 マイル) です。

### 例

次の例は、2 つのジオフェンスを指定するための正しい GeoJSON を示しています。1 つはニューヨーク市の Braze 本社用、もう 1 つはマンハッタン南部の自由の女神像用です。

```
{
  "type": "FeatureCollection",
  "features": [
    {
      "type": "Feature",
      "geometry": {
        "type": "Point",
        "coordinates": [-73.992473, 40.755669]
      },
      "properties": {
        "radius": 200,
        "name": "Braze HQ"
      }
    },
    {
      "type": "Feature",
      "geometry": {
        "type": "Point",
        "coordinates": [-74.044468, 40.689225]
       },
      "properties": {
        "radius": 100,
        "name": "Statue of Liberty"
      }
    }
  ]
}
```

## ジオフェンスイベントの使用

ジオフェンスを設定したら、それを使ってユーザーとのコミュニケーションを強化し、充実させることができる。

### キャンペーンとキャンバスのトリガー

キャンペーンおよびキャンバス トリガーの一部としてジオフェンスデータを使用するには、配信方法として**アクションベースの配信**を選択します。次に、`Trigger a Geofence` のトリガーアクションを追加します。最後に、メッセージのジオフェンスセットとジオフェンス移行イベントのタイプを選択します。また、ジオフェンスイベントを使用して、キャンバス経由でユーザーを昇格させることもできます。

![ジオフェンスによるアクションベースのキャンペーンで、ユーザーがドイツの空港に入国したときにトリガーされる。]({% image_buster /assets/img_archive/action_based_geofence_trigger.png %})

### メッセージのパーソナライズ

ジオフェンスデータを使用してメッセージをパーソナライズするには、次の Liquid パーソナライズ構文を使用できます。

{% raw %}
* `{{event_properties.${geofence_name}}}`
* `{{event_properties.${geofence_set_name}}}`
{% endraw %}

## ジオフェンスセットの更新

アクティブユーザーの場合、Braze SDK はセッション開始時に 1 日に 1 回だけジオフェンスを要求します。つまり、セッション開始後にジオフェンスセットに変更が加えられた場合、更新されたセットを受け取るには、セットが最初にプルダウンされてから  24  時間待つ必要があります。

{% alert note %}
ジオフェンスがデバイスにローカルに読み込まれていない場合、ユーザーは領域に入ってもジオフェンスをトリガーできません。
{% endalert %}

## モバイル統合 {#mobile-integrations}

### クロスプラットフォームの要件

ジオフェンスをトリガーとするキャンペーンは、iOS と Android で利用できます。ジオフェンスをサポートするには、次が必要です。

1. 統合は、バックグラウンドプッシュ通知をサポートしている必要があります。
2. Braze のジオフェンスまたは位置情報の収集機能が有効になっている必要があります。
3. iOS バージョン 11 以降のデバイスの場合、ジオフェンスを機能させるには、ユーザーが位置情報へのアクセスを常に許可する必要があります。

{% alert important %}
Braze SDK バージョン 3.6.0 以降、Braze の位置情報の収集はデフォルトで無効になっています。Android で位置情報の収集が有効になっていることを確認するには、`com_braze_enable_location_collection` を `true` に設定していることを確認してください。`braze.xml`
{% endalert %}

プラットフォームに応じた詳しいガイダンスについては、[Android](https://developer.android.com/develop/sensors-and-location/location/geofencing#choose-the-optimal-radius-for-your-geofence)または[iOSの](https://developer.apple.com/library/archive/documentation/UserExperience/Conceptual/LocationAwarenessPG/RegionMonitoring/RegionMonitoring.html#//apple_ref/doc/uid/TP40009497-CH9-SW5)ドキュメントを参照のこと。

{% alert tip %}
また、[Radar]({{site.baseurl}}/partners/message_personalization/location/radar/) や [Foursquare]({{site.baseurl}}/partners/message_personalization/location/foursquare/) などのテクノロジーパートナーとジオフェンスを活用することもできます。
{% endalert %}

## よくある質問

### ジオフェンスと位置情報の追跡の違いは？

Braze では、ジオフェンスは位置情報の追跡とは概念が異なります。ジオフェンスは特定のアクションのトリガーとして使用されます。ジオフェンスは、地理的位置の周囲に設定された仮想境界です。ユーザーがこの境界に出入りすると、メッセージの送信など特定のアクションをトリガーできます。

位置追跡は、ユーザーの最新の位置データを収集して保存するために使用されます。このデータを使用して、フィルターに基づいて `Most Recent Location` ユーザーをセグメント化できます。例えば、`Most Recent Location` フィルターを使用して、ニューヨークにいるユーザーにメッセージを送信するなど、オーディエンスの特定の地域をターゲットにすることができます。

### Braze のジオフェンスはどのくらい正確ですか?

Braze のジオフェンスは、デバイスで使用可能な位置情報のすべてのプロバイダーの組み合わせを使用して、ユーザーの位置を三角測量で割り出します。これには、WiFi、GPS、携帯電話の電波塔などが含まれます。

標準精度は 20～50m の範囲で、ベストケースの精度は 5～10m の範囲です。地方では、精度が大幅に低下し、数キロメートルに達する可能性があります。Braze は、地方では半径の大きいジオフェンスを作成することを推奨しています。

ジオフェンスの精度に関する詳細については、[Android](https://developer.android.com/develop/sensors-and-location/location/geofencing)および[iOS](https://developer.apple.com/library/archive/documentation/UserExperience/Conceptual/LocationAwarenessPG/RegionMonitoring/RegionMonitoring.html#//apple_ref/doc/uid/TP40009497-CH9-SW1)のドキュメントを参照してください。

### ジオフェンスはバッテリーの駆動時間にどのように影響しますか? 

当社のジオフェンシングソリューションは、iOS と Android のネイティブジオフェンスシステムサービスを使用し、精度と電力をインテリジェントにトレードオフするよう調整されており、基盤となるサービスの向上に伴い、クラスバッテリー駆動時間を節約してパフォーマンスを向上しています。

### ジオフェンスはいつアクティブになりますか?

Braze のジオフェンスは、アプリを閉じていても 1 日中いつでも機能します。これらは、定義され、Brazeダッシュボードにアップロードされるとすぐにアクティブになります。ただし、ユーザーが位置の追跡を無効にしている場合、ジオフェンスは機能しません。

ジオフェンスを機能させるには、ユーザーのデバイスで位置情報サービスを有効にし、位置情報にアクセスする権限をアプリに付与する必要があります。ユーザーが位置追跡を無効にしている場合、アプリはユーザーがジオフェンスに出入りするタイミングを検出できません。

### ジオフェンスデータはユーザープロファイルに保存されますか? 

いいえ、Braze はジオフェンスデータをユーザープロファイルに保存しません。ジオフェンスは Apple と Google の位置情報サービスによって監視されており、Braze はユーザーがジオフェンスをトリガーした場合にのみ通知を受け取ります。その時点で、関連するトリガーキャンペーンが処理されます。

### ジオフェンス内にジオフェンスを設定できますか?

ベストプラクティスとして、ジオフェンスを相互に設定することは避けてください。通知のトリガーで問題が発生する可能性があります。

