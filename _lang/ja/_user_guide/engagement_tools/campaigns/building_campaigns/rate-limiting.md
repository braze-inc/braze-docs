---
nav_title: レート制限とフリークエンシーキャップ
article_title: レート制限とフリークエンシーキャップ
page_order: 6
tool: Campaigns
page_type: reference
description: "この参考記事では、キャンペーンにおけるレート制限とフリークエンシーキャップの概念と、マーケティングのプレッシャーを管理してユーザーエクスペリエンスを向上させる方法について説明します。"

---

# レート制限とフリークエンシーキャップ

> レート制限とフリークエンシーキャップを組み合わせて使用することで、ユーザーは必要なメッセージを受け取り、不要なメッセージは受け取らないようにすることができます。

## レート制限

Braze では、キャンペーンをレート制限し、プラットフォームからの送信トラフィック量を制限することで、マーケティングのプレッシャーを抑えることができます。キャンペーンには 2 種類のレート制限を実装できます。1 つ目はユーザーに最高のエクスペリエンスを提供することに重点を置き、2 つ目はサーバーの帯域幅を考慮します。

### ユーザー中心のレート制限

セグメントをさらに作成すると、それらのセグメントのメンバーシップが重複する場合があります。これらのセグメントにキャンペーンを送信する場合は、ユーザーに頻繁にメッセージを送らないようにする必要があります。ユーザーが短期間に大量のメッセージを受信すると、メッセージが多すぎると感じ、プッシュ通知をオフにするか、アプリをアンインストールしてしまいます。

#### 関連セグメントフィルター

Braze では、ユーザーがメッセージを受信する頻度を制限できるように、以下のフィルターを用意しています。

- 最後にエンゲージしたメッセージ
- 最後に受信したメッセージ
- 最後に受信したプッシュ通知キャンペーン
- 最後に受信したメールキャンペーン
- 最後に受信した SMS
- 最後に閲覧したニュースフィード

#### フィルターの実装

たとえば、「フィルターショーケースのリターゲティング」という名前のセグメントを作成し、「これらのアプリを最後に使用したのは 7 日以上前」というフィルターを付けて、ユーザーをターゲットするとします。これは標準的な再エンゲージメントセグメントです。

最近通知を受け取る、よりターゲットを絞ったセグメントが他にもある場合は、そのセグメントを対象としたより一般的なキャンペーンでユーザーにターゲット設定したくない場合があります。このセグメントに「最後に受信したプッシュ通知キャンペーン」フィルターを追加することで、ユーザーは過去 24 時間以内に別の通知を受け取った場合、次の 24 時間はこのセグメントから除外されるようになります。24 時間経ってもセグメントの他の条件を満たしていて、それ以上通知を受け取っていない場合は、セグメントにスライドして戻ります。

![][1]

このフィルターをキャンペーンの対象となるすべてのセグメントに追加すると、ユーザーは最大 24 時間に 1 回のプッシュ通知を受け取ることができます。次に、最も重要なメッセージが重要度の低いメッセージの前に配信されるようにすることで、メッセージングの優先順位を付けることができます。

#### 最大ユーザー数の設定

さらに、キャンペーン構成の**ターゲットユーザー**ステップでは、メッセージを受信するユーザーの総数を制限できます。この機能はキャンペーンフィルターとは独立したチェック機能なので、過剰なスパムの心配をせずにユーザーを自由にセグメント化できます。

![][2]

最大ユーザー制限を選択すると、ユーザーが通知を受け取る頻度を、チャネルごと、またはすべてのメッセージタイプでグローバルに制限できます。

##### 最適化による最大ユーザー上限

勝者バリアントやパーソナライズバリアントなどの最適化を使用している場合、キャンペーンは最初のテストと最後の送信の 2 つの送信で構成されます。 

このシナリオでユーザー数の上限を設定するには、\[**このキャンペーンを受け取る人数を制限する**]　を選択し、次に \[**このキャンペーンで送信する合計**] を選択して、オーディエンスの上限を入力します。オーディエンスの上限は、A/B テストパネルに表示されるパーセンテージで分割されます。 

\[**キャンペーンが予定されるたびに**] を選択すると、これら 2 つのフェーズは個別に設定された数に制限されます。これは通常は望ましくありません。

#### 最大インプレッション数の上限を設定する

アプリ内メッセージとコンテンツカードでは、ユーザーベースに表示されるインプレッションの最大数を設定することでマーケティングのプレッシャーを抑えることができます。上限を超えると、Braze はユーザーにこれ以上メッセージを送信しなくなります。ただし、この上限は正確ではないことに注意することが重要です。新しいコンテンツカードとアプリ内メッセージルールは、セッション開始時にアプリに送信されます。つまり、Braze は上限に達する前にユーザーにメッセージを送信できますが、ユーザーがメッセージをトリガーする頃には上限に達しています。この場合でも、デバイスはメッセージを表示します。

たとえば、ユーザーがレベルをクリアするとトリガーされるアプリ内メッセージを含むゲームがあり、インプレッションの上限を 100 回に設定したとします。これまでに 99 件のインプレッションがありました。アリスとボブは両方ともゲームを開き、Braze はレベルをクリアするとメッセージを受け取る資格があることをデバイスに伝えます。アリスは最初にレベルをクリアし、メッセージを受け取ります。ボブは次にレベルをクリアしますが、セッションが開始されてからデバイスが Braze サーバーと通信していないため、デバイスはメッセージが上限に達したことを認識せず、メッセージも受信します。ただし、インプレッションの上限に達すると、次回いずれかのデバイスが対象となるアプリ内メッセージのリストをリクエストしても、そのメッセージは送信されず、そのデバイスから削除されます。

### レート制限とキャンバスコンポーネント

レート制限は、キャンバスを介したすべてのメッセージ送信に適用される。CanvasまたはCanvasステップで複数のチャンネルが使用されている場合、レート制限はチャンネル間で共有される。 

### レート制限とA/Bテスト

A/Bテストでレート制限を使用する場合、レート制限はテストグループと同じようにコントロールグループには適用されない。このバイアスを避けるために、適切な変換ウィンドウを使用する。

### 配送速度のレート制限

大規模なキャンペーンでユーザーアクティビティが急増し、サーバーに過負荷がかかることが予想される場合は、メッセージ送信の分単位のレート制限を指定できる。キャンペーン作成中にユーザーをターゲットにする場合、**詳細オプションに**移動してレート制限を選択することができる（最低50から最高500,000メッセージ/分まで様々な単位で）。レート制限のないキャンペーンは、これらの配信制限を超える場合があることに注意してください。ただし、低レート制限のために72時間以上遅れた場合、メッセージは中断されるので注意しよう。キャンペーンを作成したユーザーは、レート制限が低すぎる場合、ダッシュボードとメールでアラートを受け取ります。

![][3]

たとえば、75,000通のメッセージを1分あたり10,000通のレートで配信しようとすると、配信は8分間に分散される。キャンペーンでは、最初の7分間は1万人、最後の1分間は5千人を超えないようにする。レート・リミットを使用して送信されたメッセージは、レート・リミット設定（1分あたり10,000など）が60秒にわたって均等に送信されないことに注意。その代わり、Brazeは1分間に10,000通を超えるメッセージが送信されないようにする（これは、10,000通のメッセージのうち、最初の30分以内に送信されるものと、最後の30分以内に送信されるものの割合が高いことを意味する）。このようなレート制限を行うと、時間に敏感なメッセージを遅らせることになるので注意が必要だ。セグメントのユーザー数が3,000万人であるにもかかわらず、レート制限を毎分10,000に設定した場合、ユーザーベースの大部分は翌日までメッセージを受け取らないことになる。

{% alert important %}
速度制限のあるマルチチャネルキャンペーンを送信する場合、各チャネルは他のチャネルとは独立して送信されます。その結果、ユーザーは異なる時間に異なるチャンネルを受信する可能性があり、どのチャンネルが最初に受信されるかは予測できません。たとえば、メールとプッシュ通知を含むキャンペーンを送信した場合、有効なプッシュトークンを持つユーザーは 10,000 人ですが、有効なメールアドレスを持つユーザーは 50,000 人になります。1 分あたり 100 通のメッセージを送信するようにキャンペーンを設定すると (キャンペーン規模としては緩やかなレート制限)、ユーザーは約 9 時間後に最初の送信バッチでプッシュ通知を受け取り、最後の送信バッチでメールを受信できます。
{% endalert %}

#### レート制限とコネクテッドコンテンツの再試行

接続コンテンツ再試行][19] ]機能が有効な場合、Brazeは、各再送に設定したレート制限を尊重しながら、通話の失敗を再試行する。1 分あたり 10,000 件のレート制限がある 75,000 件のメッセージについてもう一度考えてみましょう。最初の 1 分間は、通話が失敗するか遅くなり、4,000 通のメッセージしか送信されません。

遅延を補って残り 4,000 通のメッセージを 2 分以内に送信したり、すでに送信するように設定されている 10,000 通のメッセージに追加したりする代わりに、Braze は失敗した 6,000 通のメッセージを「キューの後ろ」に移動し、必要に応じてメッセージの送信にかかる合計分数にさらに 1 分を追加します。

|分|失敗は許されない|6,000 分1の故障|
|---|---|---|
|1|10,000|4,000|
|2|10,000|10,000|
|3|10,000|10,000|
|4|10,000|10,000|
|5|10,000|10,000|
|6|10,000|10,000|
|7|10,000|10,000|
|8|5,000|10,000|
|9|0|6,000|
{: .reset-td-br-1 .reset-td-br-2 .reset-td-br-3}

#### マルチチャネルのキャンペーン

1 分あたりのレート制限はキャンペーンごとに調整されることに注意してください。キャンペーン内で複数のチャネルが使用されている場合、レート制限はそれぞれのチャネルに適用されます。キャンペーンでメールとアプリ内バナーを 1 分あたり 10,000 件のレート制限で使用している場合、1 分あたり合計 20,000 件のメッセージが送信されます (10,000 件のメールと 10,000 件のプッシュ通知)。

#### マルチプラットフォームプッシュ通知キャンペーン

複数のプラットフォームで配信されるプッシュ通知キャンペーンの場合、選択されたレート制限はプラットフォーム間で均等に分配されます。1 分あたり 10,000 件のレート制限がある Android と iOS を活用したプッシュ通知キャンペーンでは、10,000 件のメッセージが 2 つのプラットフォームに均等に配信されます。

## フリークエンシーキャップ

ユーザーベースが拡大し続け、ライフサイクルキャンペーン、トリガーキャンペーン、トランザクションキャンペーン、コンバージョンキャンペーンを含むようにメッセージングが拡大するにつれて、通知が「スパム」のように見えたり、混乱を招いたりしないようにすることが重要です。フリークエンシーキャップを使用すると、ユーザーエクスペリエンスをより細かく制御できるため、オーディエンスを圧倒することなく、希望するキャンペーンを作成できます。

### 機能概要 {#freq-cap-feat-over}

フリークエンシーキャップはキャンペーンまたはキャンバスコンポーネントの送信レベルで適用され、\[**設定**] > \[**フリークエンシーキャップルール**] から各ワークスペースに設定できます。

{% alert note %}
[古いナビゲーション]({{site.baseurl}}/navigation)を使用している場合、このページは「**グローバルメッセージ設定**」と呼ばれ、\[**エンゲージメント**] の下にあります。
{% endalert %}

初期設定では、新しいキャンペーンが作成されるとフリークエンシーキャップがオンになっています。ここから、以下を選択できます。

- 次のどのメッセージングチャネルを制限したいか: プッシュ通知、メール、SMS、Webhook、WhatsApp、またはこれら5つのうちのいずれか。
- 特定の期間内に、チャンネルから各ユーザーがキャンペーンまたはキャンバスコンポーネント送信を受信する回数。
- 特定の期間内に、各ユーザーが[タグ](#frequency-capping-by-tag)で送信されたキャンペーンまたはキャンバスコンポーネントを受信すべき何回。

この時間枠は、分、日、週 (7日間)、または月単位で測定でき、最大期間は 30 日です。

フリークエンシーキャップの各行は `AND` 演算子を使用して接続され、ワークスペースごとに最大 10 個のルールを追加できます。さらに、同じメッセージタイプに複数のキャップを含めることができます。たとえば、ユーザーに対するプッシュ通知を、1 日に 1 件以下、1 週間に最大 3 件までに制限できます。

![][14]

### 配信ルール

トランザクションベースのメッセージのように、すでにフリークエンシーキャップに達していても、常にユーザーに届けたいキャンペーンがあるかもしれません。たとえば、配信アプリでは、ユーザーが受信したキャンペーンの数に関係なく、アイテムが配信されたときにメールまたはプッシュを送信したい場合があります。

特定のキャンペーンでフリークエンシーキャップルールを無効にしたい場合は、**フリークエンシーキャップ**を**オフ**に切り替えて、そのキャンペーンの配信をスケジュールするときに Braze ダッシュボードで設定できます。 

この後、このキャンペーンを引き続きフリークエンシーキャップにカウントするかどうかを尋ねられます。フリークエンシーキャップの対象となるメッセージは、インテリジェントチャネルフィルターの計算に含まれます。多くの場合トランザクションであるAPIキャンペーン][15] を送信する際、`override_messaging_limits` を`true` に設定することで、キャンペーンが回数制限ルールを無視するよう指定することができる（APIリクエスト][16] 内）。

デフォルトでは、フリークエンシーキャップに従わない新しいキャンペーンやキャンバスもカウントされません。これはキャンペーンとキャンバスごとに設定できます。

{% alert note %}
この動作により、キャンペーンまたはキャンバスのフリークエンシーキャップをオフにしたときのデフォルトの動作が変更されます。変更は下位互換性があり、現在公開されているメッセージには影響しません。
{% endalert %}

![][18]

マルチチャネルキャンペーン内のさまざまなチャンネルが個別にフリークエンシーキャップをカウントします。たとえば、プッシュ通知とメールの両方でマルチチャネルキャンペーンを作成し、両方のチャネルにフリークエンシーキャップを設定した場合、プッシュ通知は 1 つのプッシュ通知キャンペーンにカウントされ、メールメッセージは 1 つのメールメッセージキャンペーンにカウントされます。また、このキャンペーンは「あらゆるタイプのキャンペーン」の 1 つとしてカウントされます。ユーザーが 1 日に 1 つのプッシュ通知キャンペーンと 1 つのメールキャンペーンに制限されている中、このマルチチャネルキャンペーンを受け取った場合、その日の残りの時間はプッシュ通知キャンペーンやメールキャンペーンの対象ではなくなります (キャンペーンがフリークエンシーキャップルールを無視しない限り)。

アプリ内メッセージとコンテンツカードは、いかなる種類のキャンペーンやキャンバスコンポーネントの上限にもカウントされません。

{% alert important %}
グローバルフリークエンシーキャップはユーザーのタイムゾーンに基づいてスケジュールされ、24 時間単位ではなく暦日単位で計算されます。たとえば、1 日に 1 つのキャンペーンしか送信しないというフリークエンシーキャップルールを設定した場合、ユーザーはローカルタイムゾーンの午後 11 時にメッセージを受信し、1 時間後に別のメッセージを受信できるようになります。
{% endalert %}

#### ユースケース

{% tabs %}
{% tab 使用例1 %}

たとえば、すべてのキャンペーンまたはキャンバスコンポーネントからユーザーが受け取るプッシュ通知キャンペーンまたは Canvas コンポーネントは、1 週間あたり 3 回までに制限するフリークエンシーキャップルールを設定したとします。

ユーザーが今週 3 件のプッシュ通知、2 件のアプリ内メッセージ、1 件のコンテンツカードを受け取る予定の場合、それらのメッセージはすべて受信することになります。

{% endtab %}
{% tab 使用例2 %}

このシナリオでは、以下の周波数上限ルールを使用する：

**次のシナリオが発生した場合:**

- あるユーザーが 1 週間に 3 回、同じキャンペーン `Campaign ABC` をトリガーする。
- このユーザーは、月曜日に 1 回、水曜日に 1 回、木曜日に 1 回、 `Campaign ABC` をトリガーする。

![]({% image_buster /assets/img/standard_rules_fnfn.png %})

**次に、予想される動作は次のとおりです。**

- このユーザーは、月曜日と水曜日にトリガーされたキャンペーン送信を受け取る。
- このユーザーは、その週にすでに 2 回のプッシュキャンペーン送信を受信しているため、木曜日に 3 回目のキャンペーン送信は受信しない。

{% endtab %}
{% endtabs %}

### タグによるフリークエンシーキャップ

[フリークエンシーキャップルール](#delivery-rules)は、キャンペーンやキャンバスに適用した特定のタグを使用してワークスペースに適用できるため、基本的にカスタム名のグループに基づいてフリークエンシーキャップを設定できます。

タグによるフリークエンシーキャップでは、メインタグとネストされたタグにルールを設定できるため、Braze はすべてのタグを考慮に入れます。たとえば、メインタグ A をフリークエンシーキャップに使用することを選択した場合、制限を決定する際に、入れ子になっているすべてのタグ (タグ B と C など) にも情報が含まれます。

通常のフリークエンシーキャップとタグによるフリークエンシーキャップを組み合わせることもできます。次のルールを考慮します。

1. すべてのキャンペーンとキャンバスステップからのプッシュ通知キャンペーンまたはキャンバスコンポーネントは、1 週間あたり 3 回までです。<br>**および**
2. `promotional` タグが付いたプッシュ通知キャンペーンまたはキャンバスコンポーネントは、1 週に 2 つまでです。

![][12]

その結果、すべてのキャンペーンとキャンバスステップでユーザーが受け取るキャンペーン送信数は 1 週間あたり 3 回まで、`promotional` タグが付いたプッシュ通知キャンペーンまたはキャンバスコンポーネントは 2 回までとなります。

{% alert important %}
キャンバスは、コンポーネントごとにタグ付けするのではなく、キャンバスレベルでタグ付けされます。そのため、各キャンバスコンポーネントはキャンバスレベルのタグをすべて継承します。
{% endalert %}

#### 矛盾するルール

ルールが矛盾する場合、最も制限の厳しい適用可能なフリークエンシーキャップルールがユーザーに適用されます。たとえば、次のようなルールがあるとします。

1. すべてのキャンペーンとキャンバスコンポーネントからのプッシュ通知キャンペーンまたはキャンバスコンポーネントは、週に 1 つだけです。<br>**および**
2. `promotional` タグが付いたプッシュ通知キャンペーンまたはキャンバスコンポーネントは、1 週間に 3 つまでです。

![][11]

この例では、ユーザーはすべてのキャンペーンとキャンバスコンポーネントから複数のプッシュ通知キャンペーンまたはキャンバスコンポーネントを受け取らないように指定しているため、1 週間に複数のプッシュ通知キャンペーンまたはキャンバスコンポーネントを受け取ることはありません。つまり、最も制限の厳しい適用頻度ルールは、特定のユーザーに適用されるルールです。

#### タグ数

タグルールによるフリークエンシーキャップは、メッセージの送信時に計算されます。つまり、タグによるフリークエンシーキャップでは、ユーザーが過去に受け取ったキャンペーンまたはキャンバスに現在含まれているタグのみがカウントされます。送信時にキャンペーンまたはキャンバスに存在していたが、その後削除されたタグはカウントされません。ユーザーが過去に受信したメッセージに、タグが付いた最新のメッセージが送信される前にタグが追加されたかどうかがカウントされます。

##### ユースケース

次のキャンペーンとタグルールによるフリークエンシーキャップを検討してください。

**キャンペーン**:

- **キャンペーン A** は、`promotional`とタグ付けされたプッシュキャンペーンです。月曜日の午前9時に送信される予定です。
- **キャンペーン B** は、`promotional`とタグ付けされたプッシュキャンペーンです。水曜日の午前9時に送信される予定です。

**タグルールによるフリークエンシーキャップ:**

- この `promotional` タグが付いたプッシュ通知キャンペーンは、1 週に 1 回までしかユーザーに届かないようにします。<br><br>

| アクション (Action) | 結果: |
|---|---|
| `promotional`タグは、ユーザーがメッセージを受信した後、**キャンペーンA**から削除されますが、**キャンペーンBが送信される前に**削除されます。 | ユーザーには**キャンペーンBが**送られる。|
| ユーザーがメッセージを受信した後、誤って**キャンペーンAから** `promotional` タグが削除された。<br> このタグは、**キャンペーンBが**送られる前の火曜日に、**キャンペーン**Aに追加される。 | あなたのユーザーは**キャンペーンBを**受け取らない。 |
{: .reset-td-br-1 .reset-td-br-2}

#### 大規模送信 {#sending-at-large-scales}

タグルールによるフリークエンシーキャップは、キャンペーンやキャンバスコンポーネントからチャネルあたり 100 通のメッセージなど、大規模な場合は正しく適用されない場合があります。

たとえば、タグによるフリークエンシーキャップのルールが次のようになっているとします。

> 1 人のユーザーに `Promotional` タグを含むメールキャンペーンまたはキャンバスコンポーネントを 1 週に 2 回以上送信しない。

また、1 週間の間にフリークエンシーキャップをオンにしたキャンペーンやキャンバスステップから 100 通を超えるメールをユーザーに送信すると、2 通を超えるメールがユーザーに送信されることがあります。

チャネルあたり 100 通のメッセージは、ほとんどのブランドがユーザーに送信するメッセージよりも多いため、この制限の影響を受けることはほとんどありません。この制限を回避するには、1 週間にユーザーに受信させたいメールの最大数に上限を設定できます。

たとえば、次のようなルールを設定できます。

> キャンペーンとキャンバスのすべてのステップからのメールキャンペーンまたはキャンバスコンポーネントを 1 週間に 3 回以下にする。

このルールでは、フリークエンシーキャップがオンになっているキャンペーンやキャンバスコンポーネントから 1 週間に最大 3 通のメールを受信することになるため、1 週間に 100 件を超えるメールを受信するユーザーはいません。

[11]: {% image_buster /assets/img/global_rules.png %} 「グローバルルール」
[12]: {% image_buster /assets/img/tag_rule_fnfn.png %} 「ルール」
[13]: {% image_buster /assets/img/standard_rules_fnfn.png %} 「ルール標準」
[1]: {% image_buster /assets/img_archive/rate_limit_daily.png %}
[2]: {% image_buster /assets/img_archive/total_limit.png %}
[3]: {% image_buster /assets/img_archive/per_minute_rate_limit.png %}
[14]: {% image_buster /assets/img_archive/rate_limiting_overview_2.png %}
[15]: {{site.baseurl}}/developer_guide/rest_api/messaging/#messaging
[16]: {{site.baseurl}}/developer_guide/rest_api/api_campaigns/#api-campaigns
[18]: {% image_buster /assets/img_archive/frequencycappingupdate.png %}
[19]: {{site.baseurl}}/user_guide/personalization_and_dynamic_content/connected_content/connected_content_retries/
