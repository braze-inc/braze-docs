---
nav_title: レート制限とフリークエンシーキャップ
article_title: レート制限とフリークエンシーキャップ
page_order: 6
tool: Campaigns
page_type: reference
description: "この参考記事では、キャンペーンにおけるレート制限とフリークエンシーキャップの概念と、マーケティングのプレッシャーを管理してユーザーエクスペリエンスを向上させる方法について説明します。"

---

# レート制限とフリークエンシーキャップ

> レート制限とフリークエンシーキャップを併用することで、ユーザーが必要なメッセージを確実に受け取ることができる。

## レートリミットについて

Braze では、キャンペーンをレート制限し、プラットフォームからの送信トラフィック量を制限することで、マーケティングのプレッシャーを抑えることができます。キャンペーンには2種類のレート制限を実装できます。 

1. [**ユーザー中心のレート制限:**](#user-centric-rate-limiting)ユーザーに最高の体験を提供することに重点を置く。
2. [**配送速度のレート制限::**](#delivery-speed-rate-limiting)サーバの帯域幅を考慮します。

Braze はメッセージ送信を1分間にわたって均等に分散しようとしますが、これを保証することはできません。たとえば、レート制限が 1 分あたり 5000 メッセージのキャンペーンがある場合、1 分あたり 5000 件のリクエストを均等に (1 秒あたり約 84 件のメッセージ) 配信しようとしますが、1 秒あたりのレートには多少のばらつきがあります。

### ユーザー中心のレート制限

セグメントをさらに作成すると、それらのセグメントのメンバーシップが重複する場合があります。これらのセグメントにキャンペーンを送信する場合は、ユーザーに頻繁にメッセージを送らないようにする必要があります。ユーザーが短期間に大量のメッセージを受信すると、メッセージが多すぎると感じ、プッシュ通知をオフにするか、アプリをアンインストールしてしまいます。

#### 関連セグメントフィルター

Braze では、ユーザーがメッセージを受信する頻度を制限できるように、以下のフィルターを用意しています。

- 最後にエンゲージしたメッセージ
- 最後に受信したメッセージ
- 最後に受信したプッシュ
- 最後に受信したメール
- 最後に受信した SMS

#### フィルターの実装

例えば、"リターゲティングフィルターショーケース "というセグメントを作成し、"最後にアプリを使ったのが7日以上前 "というフィルターでユーザーをターゲティングしたとしよう。これは標準的な再エンゲージメントセグメントです。

最近通知を受け取る、よりターゲットを絞ったセグメントが他にもある場合は、そのセグメントを対象としたより一般的なキャンペーンでユーザーにターゲット設定したくない場合があります。このセグメンテーションに "Last Received Push "フィルターを追加することで、ユーザーは過去24時間以内に別の通知を受信した場合、今後24時間はこのセグメンテーションからスライドアウトすることを確実にした。24 時間経ってもセグメントの他の条件を満たしていて、それ以上通知を受け取っていない場合は、セグメントにスライドして戻ります。

![リターゲティングフィルターショーケース」という名前のセグメンテーションで、フィルターグループは「Last used app more than 7 days ago」とする。]({% image_buster /assets/img_archive/rate_limit_daily.png %}){: style="max-width:80%;"} 

このフィルターをキャンペーンの対象となるすべてのセグメントに追加すると、ユーザーは最大 24 時間に 1 回のプッシュ通知を受け取ることができます。次に、最も重要なメッセージが重要度の低いメッセージの前に配信されるようにすることで、メッセージングの優先順位を付けることができます。

#### 最大ユーザー数の設定

キャンペーンコンポーザーの**Target Audiences**ステップで、メッセージを受信するユーザーの総数を制限することもできます。これはキャンペーンフィルターとは独立系のチェックとなる。

![キャンペーンを受け取る人数を制限するためのチェックボックスが選択されたオーディエンスサマリー。]({% image_buster /assets/img_archive/total_limit.png %}){: style="max-width:50%;"} 

最大ユーザー数を選択することで、チャネルごとに、またはすべてのメッセージタイプにわたってグローバルに、メッセージ送信量を制限することができる。

##### 最適化による最大ユーザー上限

Winning Variant やPersonalized Variant などの最適化を使用している場合、キャンペーンは2 つの送信(初期実験と最終送信) で構成されます。 

このシナリオでユーザー数の上限を設定するには、[**このキャンペーンを受け取る人数を制限する**]　を選択し、次に [**このキャンペーンで送信する合計**] を選択して、オーディエンスの上限を入力します。視聴者の制限は、**A/B Testing**パネルに表示されるパーセンテージで分割されます。 

[**キャンペーンが予定されるたびに**] を選択すると、これら 2 つのフェーズは個別に設定された数に制限されます。これは通常は望ましくありません。

#### キャンペーンのインプレッション上限を設定する

アプリ内メッセージでは、ユーザー群に表示されるインプレッションの最大数を設定することで、マーケティングの圧力をコントロールすることができる。ただし、この上限は正確ではないことに注意することが重要です。 

アプリ内メッセージルールはセッション開始時にアプリに送信されるため、Brazeはキャップに達する前にユーザーにメッセージを送ることができるが、ユーザーがメッセージをトリガーする頃にはキャップに達している。この場合でも、デバイスはメッセージを表示します。

たとえば、ユーザーがレベルをクリアするとトリガーされるアプリ内メッセージを含むゲームがあり、インプレッションの上限を 100 回に設定したとします。これまでに 99 件のインプレッションがありました。アリスとボブは両方ともゲームを開き、Braze はレベルをクリアするとメッセージを受け取る資格があることをデバイスに伝えます。アリスは最初にレベルをクリアし、メッセージを受け取ります。ボブは次にレベルをクリアしますが、セッションが開始されてからデバイスが Braze サーバーと通信していないため、デバイスはメッセージが上限に達したことを認識せず、メッセージも受信します。ただし、インプレッションの上限に達すると、次回いずれかのデバイスが対象となるアプリ内メッセージのリストをリクエストしても、そのメッセージは送信されず、そのデバイスから削除されます。

### レート制限とA/Bテスト

AB テストでレート制限を使用する場合、コントロールグループには、テストグループにレート制限を適用するものと同様な方法は適用されません。これは、時間バイアスの潜在的な原因です。このバイアスを回避するには、適切な変換ウィンドウを使用します。

### 配送速度のレート制限

大規模なキャンペーンでユーザーのアクティビティが急増し、サーバーが過負荷になると予想される場合は、1秒あたりのメッセージ送信のレート制限を指定できます。つまり、Braze は1分以内にレート制限の設定を超えて送信しません。

キャンペーン作成中にユーザーをターゲットに設定する場合、[**ターゲットオーディエンス**] (キャンペーンの場合)または [**送信設定**] (キャンバスの場合) に移動して、(1分あたり最低10件のメッセージから最大50万件のメッセージまでさまざまな段階で) レート制限を選択できます。

レート制限のないキャンペーンは、これらの配信制限を超える場合があることに注意してください。ただし、メッセージが低レート制限のために72時間以上遅延した場合は、メッセージが中止されることに注意してください。レート制限が低すぎる場合、キャンペーンの作成者はダッシュボードおよびメールでアラートを受信します。

#### 例

1分あたり10,000通のレート制限で75,000通のメッセージを送ろうとすると、配信は8分間に分散される。キャンペーンで配信されるメッセージの数は、最初の7分間で毎分10,000件、最後の1分間で5,000件を超えることはありません。

#### 送信回数

レート制限されたメッセージは、1分間において均等に送信されないことがあります。1分あたり10,000件のレート制限の例の場合、Braze は1分あたり10,000件を超えるメッセージを送信しないことを意味します。これは、10,000件のうち、前半30秒間に送信されるメッセージの割合が、後半30秒間に送信されるメッセージの割合よりも高いことを意味します。

レート制限はメッセージ送信の開始時に適用される。送信が完了するまでの時間にばらつきがある場合、完了した送信の数が数分でレート制限をわずかに超えることがあります。時間の経過とともに、1分あたりの送信数は、平均してレート制限を超えないようになります。

{% alert important %}
セグメント内のユーザーの総数に関連して、この形式のレート制限によって時間依存メッセージが遅延することに注意してください。たとえば、セグメントに3000万 人のユーザーが含まれているが、レート制限を1 分あたり10,000 に設定した場合、ユーザーベースの大部分は翌日までメッセージを受信しません。
{% endalert %}

#### マルチチャネルのキャンペーン

速度制限付きのマルチチャネルキャンペーンを送信する場合、各チャネルは他のチャネルとは独立して送信されます。その結果、以下が発生する可能性があります。

- 1 分あたりに送信されるメッセージの合計数がレート制限を超える場合があります。 
    - たとえば、キャンペーンのレート制限が1 分あたり10,000 で、メールとSMS を使用している場合、Braze は1 分あたり最大20,000 件のメッセージを送信できます(10,000 メールと10,000 SMS)。
- ユーザーは異なる時間に異なるチャネルを受信する可能性があり、どのチャネルが最初に受信されるかは予測できません。 
    - たとえば、メールとSMSを含むキャンペーンを送信する場合、有効な電話番号を持つ10,000 人のユーザと、有効なメールアドレスを持つ50,000 人のユーザがいる可能性があります。キャンペーンで1 分あたり100 件のメッセージを送信するように設定した場合(キャンペーンサイズのレート制限が遅い場合)、ユーザは、送信の最初のバッチでSMS を受信し、送信の最後のバッチでE メールを受信することができます(ほぼ9 時間後)。

#### キャンバス配信速度のレート制限 {#canvas-delivery-speed}

速度レート制限のあるキャンバスを送信する場合、このレート制限はチャネル間で共有されます。つまり、キャンバスから1 分あたりに送信されるメッセージの合計数は、レート制限を超えません。たとえば、キャンバスのレート制限が1 分あたり10,000 で、メールとSMS を使用している場合、Braze はメールとSMS を介して1 分あたり合計10,000 のメッセージを送信します。

#### レート制限とコネクテッドコンテンツの再試行

[[コネクテッドコンテンツの再試行]({{site.baseurl}}/user_guide/personalization_and_dynamic_content/connected_content/connected_content_retries/)] がオンになっている場合、再送信ごとに設定したレート制限に従い、Braze はコールの失敗を再試行します。速度制限が10,000/分の75,000メッセージを送信するシナリオを考えてみましょう。最初の1分間で、コールが失敗するか、または遅く、4000メッセージのみを送信すると仮定します。

遅延を補って残り6,000件のメッセージを2分以内に送信したり、すでに送信するように設定されている10,000件のメッセージに追加したりする代わりに、Braze は失敗した6,000件のメッセージを「キューの後ろ」に移動し、必要に応じてメッセージの送信にかかる合計分数にさらに1分を追加します。

| 分 | 失敗なし | 最初の 1 分で 6,000 件失敗 |
|--------|------------|---------------------------|
| 1      | 10,000     | 4,000                     |
| 2      | 10,000     | 10,000                    |
| 3      | 10,000     | 10,000                    |
| 4      | 10,000     | 10,000                    |
| 5      | 10,000     | 10,000                    |
| 6      | 10,000     | 10,000                    |
| 7      | 10,000     | 10,000                    |
| 8      | 5,000      | 10,000                    |
| 9      | 0          | 6,000                     |
{: .reset-td-br-1 .reset-td-br-2 .reset-td-br-3 role="presentation" }

接続されたコンテンツリクエストは個別にレート制限されず、Webhook レート制限に従います。つまり、Webhook ごとに一意のエンドポイントへの Connected Content 呼び出しが 1 つある場合、1 分あたり5,000 個の Webhook と5,000 回の Connected Content 呼び出しが予想されます。キャッシュがこれに影響し、Connected Content 呼び出しの数が減る可能性があることに注意してください。さらに、再試行により Connected Content 呼び出しが増加する場合があるため、ここでは、Connected Content エンドポイントがある程度の変動に対処できることを確認しておくことをお勧めします。

## フリークエンシーキャッピングについて

ユーザーベースが拡大し続け、ライフサイクルキャンペーン、トリガーキャンペーン、トランザクションキャンペーン、コンバージョンキャンペーンを含むようにメッセージングが拡大するにつれて、通知が「スパム」のように見えたり、混乱を招いたりしないようにすることが重要です。フリークエンシーキャップを使用すると、ユーザーエクスペリエンスをより細かく制御できるため、オーディエンスを圧倒することなく、希望するキャンペーンを作成できます。

### 機能概要 {#freq-cap-feat-over}

フリークエンシーキャップはキャンペーンまたはキャンバスコンポーネントの送信レベルで適用され、[**設定**] > [**フリークエンシーキャップルール**] から各ワークスペースに設定できます。

初期設定では、新しいキャンペーンが作成されるとフリークエンシーキャップがオンになっています。ここから、以下を選択できます。

- どのメッセージングチャネルをキャップしたいか：プッシュ、メール、SMS、Webhook、WhatsApp、LINE、またはこれらのチャネルのいずれか。
- 特定の期間内に、チャンネルから各ユーザーがキャンペーンまたはキャンバスコンポーネント送信を受信する回数。
- 特定の期間内に、各ユーザーが[タグ](#frequency-capping-by-tag)で送信されたキャンペーンまたはキャンバスコンポーネントを受信すべき何回。

この時間枠は、分、日、または週(7 日) で測定でき、最大期間は30 日です。

フリークエンシーキャップの各行は `AND` 演算子を使用して接続され、ワークスペースごとに最大 10 個のルールを追加できます。さらに、同じメッセージタイプに複数のキャップを含めることができます。たとえば、ユーザーに対するプッシュ通知を、1 日に 1 件以下、1 週間に最大 3 件までに制限できます。

![フリークエンシーキャップセクションには、ルールが適用されるキャンペーンと適用されないキャンバスのリストがある。]({% image_buster /assets/img_archive/rate_limiting_overview_2.png %}){: style="max-width:90%;"} 

#### ユーザがキャンバスステップで周波数に上限が設定されている場合の動作

グローバル周波数上限設定のためにキャンバスユーザが周波数上限に設定されている場合、ユーザはすぐに次のキャンバスステップに進みます。周波数上限のため、ユーザはキャンバスを終了しません。

### 配信規定

トランザクションベースのメッセージのように、すでにフリークエンシーキャップに達していても、常にユーザーに届けたいキャンペーンがあるかもしれません。たとえば、配信アプリでは、ユーザーが受信したキャンペーンの数に関係なく、アイテムが配信されたときにメールまたはプッシュを送信したい場合があります。

特定のキャンペーンでフリークエンシーキャップルールを無効にしたい場合は、**フリークエンシーキャップ**を**オフ**に切り替えて、そのキャンペーンの配信をスケジュールするときに Braze ダッシュボードで設定できます。 

この後、このキャンペーンを引き続きフリークエンシーキャップにカウントするかどうかを尋ねられます。フリークエンシーキャップの対象となるメッセージは、インテリジェントチャネルフィルターの計算に含まれます。 

トランザクションが多い[APIキャンペーンを]({{site.baseurl}}/developer_guide/rest_api/messaging/#messaging)送信する場合、APIリクエストで`override_frequency_capping` を`true` に設定することで、キャンペーンがフリークエンシーキャップルールを無視するように指定できる。

デフォルトでは、フリークエンシーキャップに従わない新しいキャンペーンやキャンバスもカウントされません。これはキャンペーンとキャンバスごとに設定できます。

{% alert note %}
この動作により、キャンペーンまたはキャンバスのフリークエンシーキャップをオフにしたときのデフォルトの動作が変更されます。変更は下位互換性があり、現在公開されているメッセージには影響しません。
{% endalert %}

![フリークエンシーキャップがオンになっているデリバリーコントロールのセクション。]({% image_buster /assets/img_archive/frequencycappingupdate.png %}){: style="max-width:90%;"} 

マルチチャネルキャンペーン内の異なるチャネルは、個々にフリークエンシーキャップにカウントされる。たとえば、プッシュ通知とメールの両方でマルチチャネルキャンペーンを作成し、両方のチャネルにフリークエンシーキャップを設定した場合、プッシュ通知は 1 つのプッシュ通知キャンペーンにカウントされ、メールメッセージは 1 つのメールメッセージキャンペーンにカウントされます。また、このキャンペーンは「あらゆるタイプのキャンペーン」の 1 つとしてカウントされます。ユーザーが 1 日に 1 つのプッシュ通知キャンペーンと 1 つのメールキャンペーンに制限されている中、このマルチチャネルキャンペーンを受け取った場合、その日の残りの時間はプッシュ通知キャンペーンやメールキャンペーンの対象ではなくなります (キャンペーンがフリークエンシーキャップルールを無視しない限り)。

アプリ内メッセージとコンテンツカードは、いかなる種類のキャンペーンやキャンバスコンポーネントの上限にもカウントされません。

{% alert important %}
グローバルフリークエンシーキャップはユーザーのタイムゾーンに基づいてスケジュールされ、24 時間単位ではなく暦日単位で計算されます。たとえば、1 日に 1 つのキャンペーンしか送信しないというフリークエンシーキャップルールを設定した場合、ユーザーはローカルタイムゾーンの午後 11 時にメッセージを受信し、1 時間後に別のメッセージを受信できるようになります。
{% endalert %}

#### ユースケース

{% tabs %}
{% tab Use case 1 %}

たとえば、すべてのキャンペーンまたはキャンバスコンポーネントからユーザーが受け取るプッシュ通知キャンペーンまたは Canvas コンポーネントは、1 週間あたり 3 回までに制限するフリークエンシーキャップルールを設定したとします。

ユーザーが今週 3 件のプッシュ通知、2 件のアプリ内メッセージ、1 件のコンテンツカードを受け取る予定の場合、それらのメッセージはすべて受信することになります。

{% endtab %}
{% tab Use case 2 %}

このシナリオでは、以下の周波数上限ルールを使用する：

**次のシナリオが発生した場合:**

- あるユーザーが 1 週間に 3 回、同じキャンペーン `Campaign ABC` をトリガーする。
- このユーザーは、月曜日に 1 回、水曜日に 1 回、木曜日に 1 回、 `Campaign ABC` をトリガーする。

![フリークエンシーキャップセクションで、1週間ごとに全キャンペーン/キャンバスステップから2回までしかユーザーにプッシュ通知キャンペーン/キャンバスステップを送信しないというルールを設定。]({% image_buster /assets/img/standard_rules_fnfn.png %})

**次に、予想される動作は次のとおりです。**

- このユーザーは、月曜日と水曜日にトリガーされたキャンペーン送信を受け取る。
- このユーザーは、その週にすでに 2 回のプッシュキャンペーン送信を受信しているため、木曜日に 3 回目のキャンペーン送信は受信しない。

{% endtab %}
{% endtabs %}

### タグによるフリークエンシーキャップ

[フリークエンシーキャップルール](#delivery-rules)は、キャンペーンやキャンバスに適用した特定のタグを使用してワークスペースに適用できるため、基本的にカスタム名のグループに基づいてフリークエンシーキャップを設定できます。

タグによるフリークエンシーキャップでは、メインタグとネストされたタグにルールを設定できるため、Braze はすべてのタグを考慮に入れます。たとえば、メインタグ A をフリークエンシーキャップに使用することを選択した場合、制限を決定する際に、入れ子になっているすべてのタグ (タグ B と C など) にも情報が含まれます。

通常のフリークエンシーキャップとタグによるフリークエンシーキャップを組み合わせることもできます。次のルールを考慮します。

1. すべてのキャンペーンとキャンバスステップからのプッシュ通知キャンペーンまたはキャンバスコンポーネントは、1 週間あたり 3 回までです。<br>**および**
2. `promotional` タグが付いたプッシュ通知キャンペーンまたはキャンバスコンポーネントは、1 週に 2 つまでです。

![1週間ごとにユーザーに送信できるプッシュ通知キャンペーン/キャンバスの数を制限する2つのルールが示されている「フリークエンシーキャップ」セクション。]({% image_buster /assets/img/tag_rule_fnfn.png %} "rules")

その結果、すべてのキャンペーンとキャンバスステップでユーザーが受け取るキャンペーン送信数は 1 週間あたり 3 回まで、`promotional` タグが付いたプッシュ通知キャンペーンまたはキャンバスコンポーネントは 2 回までとなります。

{% alert important %}
キャンバスは、コンポーネントごとにタグ付けするのではなく、キャンバスレベルでタグ付けされます。そのため、各キャンバスコンポーネントはキャンバスレベルのタグをすべて継承します。
{% endalert %}

#### 矛盾するルール

ルールが矛盾する場合、最も制限の厳しい適用可能なフリークエンシーキャップルールがユーザーに適用されます。たとえば、次のようなルールがあるとします。

1. すべてのキャンペーンとキャンバスコンポーネントからのプッシュ通知キャンペーンまたはキャンバスコンポーネントは、週に 1 つだけです。<br>**および**
2. `promotional` タグが付いたプッシュ通知キャンペーンまたはキャンバスコンポーネントは、1 週間に 3 つまでです。

![1 週間ごとにユーザーに送信されるプッシュ通知キャンペーン/キャンバスステップの数を制限するために、競合するルールを持つFrequency Capping セクション。]({% image_buster /assets/img/global_rules.png %} "global rules")

この例では、ユーザーはすべてのキャンペーンとキャンバスコンポーネントから複数のプッシュ通知キャンペーンまたはキャンバスコンポーネントを受け取らないように指定しているため、1 週間に複数のプッシュ通知キャンペーンまたはキャンバスコンポーネントを受け取ることはありません。つまり、最も制限の厳しい適用頻度ルールは、特定のユーザーに適用されるルールです。

#### タグ数

タグルールによるフリークエンシーキャップは、メッセージの送信時に計算されます。つまり、タグによるフリークエンシーキャップでは、ユーザーが過去に受け取ったキャンペーンまたはキャンバスに現在含まれているタグのみがカウントされます。送信時にキャンペーンまたはキャンバスに存在していたが、その後削除されたタグはカウントされません。ユーザーが過去に受信したメッセージに、タグが付いた最新のメッセージが送信される前にタグが追加されたかどうかがカウントされます。

##### ユースケース

次のキャンペーンとタグルールによるフリークエンシーキャップを検討してください。

**キャンペーン**:

- **キャンペーン A** は、`promotional`とタグ付けされたプッシュキャンペーンです。月曜日の午前9時に送信される予定です。
- **キャンペーン B** は、`promotional`とタグ付けされたプッシュキャンペーンです。水曜日の午前9時に送信される予定です。

**タグルールによるフリークエンシーキャップ:**

- この `promotional` タグが付いたプッシュ通知キャンペーンは、1 週に 1 回までしかユーザーに届かないようにします。<br><br>

| アクション (Action) | 結果: |
|---|---|
| ユーザーがメッセージを受信してから**キャンペーン B が送信される**までの間に、**キャンペーン A** から `promotional` タグが削除された。 | ユーザーは**キャンペーン B** を受信します。|
| ユーザーがメッセージを受信した後、誤って**キャンペーンAから** `promotional` タグが削除された。<br> このタグは、**キャンペーン B **が送信される前の火曜日に、**キャンペーン A** に再び追加された。 | ユーザーは**キャンペーン B** を受信しません。 |
{: .reset-td-br-1 .reset-td-br-2 role="presentation" }

#### 大規模送信 {#sending-at-large-scales}

タグルールによるフリークエンシーキャップは、キャンペーンやキャンバスコンポーネントからチャネルあたり 100 通のメッセージなど、大規模な場合は正しく適用されない場合があります。

たとえば、タグによるフリークエンシーキャップのルールが次のようになっているとします。

> 1 人のユーザーに `Promotional` タグを含むメールキャンペーンまたはキャンバスコンポーネントを 1 週に 2 回以上送信しない。

また、1 週間の間にフリークエンシーキャップをオンにしたキャンペーンやキャンバスステップから 100 通を超えるメールをユーザーに送信すると、2 通を超えるメールがユーザーに送信されることがあります。

チャネルあたり 100 通のメッセージは、ほとんどのブランドがユーザーに送信するメッセージよりも多いため、この制限の影響を受けることはほとんどありません。この制限を回避するには、1 週間にユーザーに受信させたいメールの最大数に上限を設定できます。

たとえば、次のようなルールを設定できます。

> キャンペーンとキャンバスのすべてのステップからのメールキャンペーンまたはキャンバスコンポーネントを 1 週間に 3 回以下にする。

このルールでは、フリークエンシーキャップがオンになっているキャンペーンやキャンバスコンポーネントから 1 週間に最大 3 通のメールを受信することになるため、1 週間に 100 件を超えるメールを受信するユーザーはいません。

