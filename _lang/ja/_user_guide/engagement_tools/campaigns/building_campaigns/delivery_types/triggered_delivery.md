---
nav_title: アクションベースの配信
article_title: アクションベースの配信
page_order: 1
page_type: reference
description: "この参考記事では、ユーザーが特定のイベントを完了した後に送信するキャンペーンをトリガーする方法について説明します。"
tool: Campaigns

---

# アクションベースの配信

> アクションベースの配信キャンペーンまたはイベントトリガーキャンペーンは、トランザクションベースまたはアチーブメントベースのメッセージに非常に効果的です。特定の日にキャンペーンを送信する代わりに、ユーザーが特定のイベントを完了した後に送信するようにトリガーできます。 

## トリガーキャンペーンの設定

### ステップ 1: トリガーイベントを選択する

トリガーイベントを選択します。これには以下のいずれかが含まれます。
- 購入する
- セッションを開始する
- カスタムイベントの実行
- キャンペーンの1次コンバージョンイベントの実行
- ユーザープロファイルにメールアドレスを追加する
- カスタム属性の値を変更する
- サブスクリプションステータスの更新
- サブスクリプショングループステータスを更新中
- 他のキャンペーンとの相互作用
    - アプリ内のメッセージを見る
    - アプリ内メッセージをクリックする
    - アプリ内のメッセージボタンをクリックする
    - メールをクリックする
    - メールのエイリアスをクリックする
    - 任意のキャンペーンまたはキャンバスステップでエイリアスをクリックしました
    - メールを開く
    - メールの開封 (マシンの開封数)
    - メールの開封 (その他の開封数)
    - プッシュ通知を直接開く
    - プッシュ通知ボタンをクリックする
    - プッシュ通知ストーリーページをクリックする
    - コンバージョンイベントを実行する
    - メールを受け取る
    - SMS を受信する
    - 短縮 SMS リンクをクリックする
    - プッシュ通知を受け取る
    - Webhook を受け取る
    - コントロールグループに登録されています
    - コンテンツカードを表示
    - コンテンツカードをクリック
    - コンテンツカードを閉じる
- 場所の入力
- 別のキャンペーンのために例外イベントを実行する
- キャンバス ステップとの対話
- ジオフェンスのトリガー
- SMS インバウンドメッセージの送信
- WhatsAppの受信メッセージを送信

さらに、Braze [カスタムイベントプロパティ]({{site.baseurl}}/user_guide/data/custom_data/custom_events/) を使用してトリガイベントをフィルタリングすることもできます。これにより、カスタムイベントおよびアプリ内購入のカスタマイズ可能なイベントプロパティを使用できます。この機能により、カスタムイベントの特定の属性に基づいてメッセージを受信するユーザーをさらに調整できるため、キャンペーンのパーソナライズやデータ収集の高度化が可能になります。 

たとえば、「カート値」プロパティフィルターによってさらにターゲット設定された、放棄カートのカスタムイベントを含むキャンペーンがあるとします。このキャンペーンは、カートに 100 ドルから 200 ドル相当の商品を残したユーザーのみを対象としています。 

![]({% image_buster /assets/img_archive/customEventProperties.png %})

{% alert note %}
キャンペーンのセグメントが新規ユーザーに適用される場合は、トリガーイベントの「セッション開始」がユーザーの最初のアプリ起動になることがあります。(たとえば、セグメントにセッションのないユーザーが含まれている場合など)。
{% endalert %}

なお、トリガーされたキャンペーンは特定のユーザーセグメントに送信できるため、そのセグメントに参加していないユーザーは、トリガーイベントを完了してもキャンペーンを受け取ることはありません。セグメントの対象であるにもかかわらずユーザーがキャンペーンを受け取っていないことに気付いた場合は、[ユーザーがトリガーされたキャンペーンを受け取らなかった理由]({{site.baseurl}}/help/help_articles/campaigns_and_canvas/not_triggering/)のセクションを参照してください。

ユーザーが自分のプロファイルにメールアドレスを追加したときのトリガーイベントに関しては、次のルールが適用されます。

- トリガーイベントは、ユーザープロファイル属性が更新された後に発生します。つまり、キャンペーンのセグメントとフィルターの評価は、属性が更新された後に行われます。これは、「メールアドレスがgmail.comに一致する」などのフィルターを設定して、Gmailユーザーにのみ送信され、メールアドレスを追加するとすぐにトリガーされるキャンペーンを作成できるため、有益です。
- トリガーイベントは、メールアドレスがユーザープロファイルに追加されたときに発生します。同じメールアドレスで作成したユーザープロファイルが複数ある場合、キャンペーンはユーザープロファイルごとに 1 回ずつ、複数回実施される場合があります。

さらに、トリガーされたアプリ内メッセージは引き続きアプリ内メッセージ配信ルールに従い、アプリセッションの開始時に表示されます。

![]({% image_buster /assets/img_archive/schedule_triggered1.png %})

### ステップ 2: 遅延時間の長さを選択する

トリガー条件が満たされてからキャンペーンを送信するまでの待機時間を選択します。選択した遅延時間がメッセージの送信時間より長い場合、どのユーザーもキャンペーンを受信しません。 

さらに、キャンペーンの開始後にトリガーイベントを完了したユーザーは、遅延時間が過ぎると最初にメッセージの受信を開始します。キャンペーン開始前にトリガーイベントを完了したユーザーは、キャンペーンを受け取る資格がありません。

![]({% image_buster /assets/img_archive/schedule_triggered22.png %})

また、特定の曜日 (「次」を選択して日を選択) にキャンペーンを送信するか、将来の特定の日数 (「日後」を選択) にキャンペーンを送信することもできます。または、手動で配信時間を選択する代わりに、[インテリジェントタイミング]({{site.baseurl}}/user_guide/brazeai/intelligence/intelligent_timing/)機能を使用してメッセージを送信することもできます。

![]({% image_buster /assets/img_archive/schedule_triggered7.png %})
![]({% image_buster /assets/img_archive/schedule_triggered8.png %})

### ステップ 3: 例外イベントを選択する

ユーザーがこのキャンペーンを受け取らないようにする例外イベントを選択します。これを実行できるのは、トリガーされたメッセージが一定時間遅れて送信される場合だけです。[例外イベント]({{site.baseurl}}/user_guide/engagement_tools/canvas/create_a_canvas/exit_criteria/#exception-events) は、購入、セッションの開始、キャンペーンの指定された[変換イベント]({{site.baseurl}}/user_guide/engagement_tools/campaigns/testing_and_more/conversion_events/#conversion-events) のいずれかの実行、またはカスタムイベントの実行を行うことができます。ユーザーがトリガーイベントを完了したが、遅延時間によりメッセージが送信される前に例外イベントを完了した場合、そのユーザーはキャンペーンを受け取りません。例外イベントが原因でキャンペーンを受け取れなかったユーザーは、[再有効化]({{site.baseurl}}/user_guide/engagement_tools/messaging_fundamentals/reeligibility/)するよう設定しなくても、次回にトリガーイベントを完了したときに自動的にキャンペーンの受け取りが可能になります。

![]({% image_buster /assets/img_archive/schedule_triggered32.png %})

例外イベントの使用方法の詳細については、[ユースケース]({{site.baseurl}}/user_guide/engagement_tools/campaigns/building_campaigns/delivery_types/triggered_delivery/#use-cases)のセクションをご覧ください。

> 例外イベントと一致するトリガーイベントを含むキャンペーンを送信すると、Braze はキャンペーンをキャンセルし、例外イベントのメッセージ配信時間に基づいて新しいキャンペーンを自動的に再スケジュールします。たとえば、最初のトリガーイベントが 5 分から始まり、例外イベントが 10 分に始まる場合、公式キャンペーンのメッセージ配信時間は例外イベントの 10 分となります。

{% alert note %}
キャンペーンのトリガーイベントと例外イベントの両方を「セッション開始」にすることはできません。ただし、このオプション以外のカスタムイベントはいつでも選択できます。
{% endalert %}

### ステップ 4: 期間を割り当てる

開始時間と必要に応じて終了時間を指定して、キャンペーンの期間を割り当てます。

![]({% image_buster /assets/img_archive/schedule_triggered43.png %})

ユーザーが指定された時間枠内にトリガーイベントを完了したが、スケジュールされた遅延により時間枠外にメッセージを受け取る資格を得た場合、そのユーザーはキャンペーンを受け取りません。そのため、メッセージの時間枠よりも長い時間遅延を設定すると、キャンペーンを受け取るユーザーはなくなります。さらに、ユーザーの[ローカルタイムゾーン]({{site.baseurl}}/user_guide/engagement_tools/campaigns/building_campaigns/delivery_types/scheduled_delivery/#local-time-zone-campaigns)でメッセージを送信するように選択できます。

### ステップ 5: 期間の選択

ユーザーがその日の特定の時間帯にキャンペーンを受け取るかどうかを選択します。メッセージに時間枠を指定し、ユーザーが時間枠外にトリガーイベントを完了するか、メッセージの遅延により時間枠を逃した場合、デフォルトではユーザーはメッセージを受け取りません。

![]({% image_buster /assets/img_archive/schedule_triggered5.png %})

ユーザーが時間枠内にトリガーイベントを完了したが、メッセージの遅延によりユーザーが時間枠から外れる場合は、次のチェックボックスをオンにして、これらのユーザーが引き続きキャンペーンを受信できるようにすることができます。

![]({% image_buster /assets/img_archive/schedule_triggered_next_available.png %})

期間を逃したためにユーザーがメッセージを受信しなかった場合、[再有効化]({{site.baseurl}}/user_guide/engagement_tools/messaging_fundamentals/reeligibility/)するよう設定していなくても、次回にトリガーイベントを完了したときにキャンペーンの受け取りが可能になります。ユーザーを再有効化するよう選択した場合、ユーザーは指定された期間内に条件を満たしていれば、トリガーイベントを完了するたびにキャンペーンを受け取ることができます。

キャンペーンに特定の期間も割り当てている場合、ユーザーがメッセージを受け取るには、その期間とその日の特定の時間帯の両方で条件を満たす必要があります。

### ステップ 6: 再有効化を判断する

ユーザーがキャンペーンに対して[再有効化]({% image_buster /assets/img_archive/ReEligible.png %})されるかどうかを判断します。ユーザーを再有効化する場合、ユーザーがキャンペーンを再度受け取れるようになるまでの時間を指定できます。これにより、トリガーされたキャンペーンが「スパム」になるのを防ぐことができます。

![]({% image_buster /assets/img_archive/schedule_triggered6.png %})

## ユースケース

トリガー型キャンペーンは、トランザクションベースのメッセージやアチーブメントベースのメッセージに非常に効果的です。

トランザクションベースのキャンペーンには、ユーザーが購入を完了するか、カートにアイテムを追加した後に送信されるメッセージが含まれます。後者のケースは、例外イベントが効果を発揮するキャンペーンの好例です。たとえば、キャンペーンで、まだ購入していない商品をカートに入れていることをユーザーに思い出させるとします。この場合の例外は、ユーザーがカート内の商品を購入する場合です。アチーブメントベースのキャンペーンでは、ユーザーがコンバージョンを完了するか、ゲームレベルをクリアしてから 5 分後にメッセージを送信できます。

さらに、ウェルカムキャンペーンを作成するときには、ユーザーがアカウントを登録または設定した後に送信するメッセージをトリガーできます。登録後に、日にちをずらしてメッセージを送信することで、綿密なオンボーディングプロセスを作成できます。

## トリガーされたキャンペーンがユーザーに届かなかったのはなぜですか ?

以下のいずれかにより、トリガーイベントを完了したユーザーがキャンペーンを受け取れなくなります。

- 遅延時間が完全に経過する前に、ユーザーが例外イベントを完了した。
- Liquid の [`abort_message` ロジック]({{site.baseurl}}/user_guide/personalization_and_dynamic_content/liquid/aborting_messages) が使用され、メッセージは `abort_message` ロジックまたはルールに基づいて中止されました。
- 遅延時間により、ユーザーが期間終了後にキャンペーンを受け取る資格を得た。
- 遅延時間により、ユーザーはその日の特定の時間帯以外にキャンペーンを受け取る資格を得た。
- ユーザーは既にキャンペーンを受け取っており、再有効化されない。
- ユーザーは再びキャンペーンを受け取る資格があるが、再トリガーできるのは一定期間が経過した後であり、その期間がまだ経過していない。

イベント時に記録されたユーザーデータに基づいてトリガーされたキャンペーンを[セグメント化]({{site.baseurl}}/user_guide/engagement_tools/segments/)すると、[競合状態]({{site.baseurl}}/help/best_practices/race_conditions/#race-conditions)が発生する可能性があります。これは、キャンペーンがセグメント化されているユーザー属性が変更されたが、キャンペーンの送信時にその変更がユーザーに対して処理されなかった場合に発生します。キャンペーンはエントリー時にセグメントメンバーシップを確認するため、ユーザーがキャンペーンを受け取れなくなる可能性があります。

たとえば、登録したばかりの男性ユーザーにイベントトリガーキャンペーンを送信したいとします。ユーザーが登録すると、カスタムイベント `registration` を記録すると同時にユーザーの `gender` 属性を設定します。Braze がユーザーの性別を処理する前にイベントによってキャンペーンがトリガーされ、ユーザーがキャンペーンを受け取れなくなる可能性があります。

ベストプラクティスとして、キャンペーンがセグメント化されている属性がイベントの前に Braze サーバーにフラッシュされていることを確認してください。これが不可能な場合、配信を保証する最善の方法は、[カスタムイベントプロパティ]({{site.baseurl}}/user_guide/data_and_analytics/custom_data/custom_events/#custom-event-properties)を使用して、関連するユーザプロパティをイベントにアタッチし、セグメンテーションフィルタの代わりに特定のイベントプロパティにプロパティフィルタを適用することです。この例では、カスタムイベントの`registration` に `gender` プロパティを追加すると、キャンペーンがトリガーされたときに必要なデータが Braze に確実に届くようになります。

さらに、キャンペーンがアクションベースであり、遅延が発生する場合は、**送信時にセグメントメンバーシップを再評価する**オプションをチェックして、メッセージが送信されたときにユーザーがターゲットオーディエンスの一部であることを確認できます。

キャンペーンが特定のカスタムイベントによってトリガーされ、オーディエンスとしてSegmentを選択した場合、ユーザーはSegmentに含まれるために同じカスタムイベントを実行する必要があります。これは、アクションベースのキャンペーンをトリガーする前に、ユーザーがオーディエンスの一部である必要があることを意味します。トリガーされたキャンペーンの一般的なワークフローは次のとおりです:

1. **オーディエンスに参加する:**ユーザーがカスタムイベントを実行すると、キャンペーンのターゲットオーディエンスに追加されます。
2. **メールをトリガーする:**ユーザーは、カスタムイベントを再度実行してメールをトリガーする必要があります。これは、メールを送信するにはユーザーがオーディエンスの一部でなければならないためです。

すべてのユーザーを含むようにターゲットオーディエンスを変更するか、イベントを実行すると予想されるユーザーが、メッセージをトリガーするキャンペーンのオーディエンスに含まれることを確認することをお勧めします。

![]({% image_buster /assets/img_archive/reevaluate_segment_membership.png %})

### カスタムイベントのトラブルシューティング

まず、カスタムイベントがBraze に渡されていることを確認します。**Analytics**> **カスタムイベントレポート**に移動し、それぞれのカスタムイベントと日付範囲を選択します。イベントが表示されない場合は、イベントが正しく設定されていること、およびユーザーが正しいアクションを実行したことを確認します。

カスタムイベントが表示された場合は、次の手順を実行して、さらにトラブルシューティングを行います。

- ユーザープロファイルのダウンロードをチェックして、イベントがトリガーされたことと、イベントがいつトリガーされたかを確認します。イベントがトリガーされている場合は、イベントがトリガーされた時点のタイムスタンプを、キャンペーンが有効になった時点と比較します。キャンペーンが有効になる前にイベントがトリガーされた可能性があります。
- ターゲット設定で使用されているキャンペーンおよびセグメントの変更ログを確認して、ユーザがカスタムイベントがトリガされたときにセグメントに含まれていたかどうかを確認します。ユーザーがセグメントに含まれていなかった場合、キャンペーンを受信していません。
- ユーザがセグメンテーションによってコントロールグループに入力され、キャンペーンを受信できないようになっているかどうかを確認します。
- スケジュールされた遅延がある場合は、遅延が発生する前にユーザーのカスタムイベントがトリガーされていたかどうかを確認します。遅延前にイベントがトリガーされた場合、キャンペーンは受信されません。

{% alert note %}
アプリ内メッセージは、REST API ではなく、SDK 経由で送信されたイベントによってのみトリガーできます。
{% endalert %}

