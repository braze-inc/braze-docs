---
nav_title: 遅延 
article_title: 遅延 
alias: "/delay_step/"
page_order: 3
page_type: reference
description: "この記事では、関連するメッセージを追加することなく、キャンバスに遅延を追加する方法について説明します。"
tool: Canvas

---

# 遅延

> 遅延コンポーネントを使用して、キャンバスにスタンドアロンの遅延を追加できます。関連するメッセージを追加しなくても、キャンバスに遅延を追加することができます。 

遅延によって、すっきりと整理されたキャンバスを作成できます。このコンポーネントを使えば、正確な日付まで、特定の日まで、あるいは特定の曜日まで、別のステップを遅らせることもできます。<br> ![キャンバスの最初のステップである遅延ステップ。1 日の遅延が設定されている。]({% image_buster /assets/img/canvas_delay.png %}){: style="float:right;max-width:35%;margin-left:15px;"}

## 遅延の作成

遅延を作成するには、キャンバスにステップを追加します。サイドバーからコンポーネントをドラッグ＆ドロップするか、ステップの一番下にある <i class="fas fa-plus-circle"></i> プラスのボタンを押して、[**延期期間**] を選択します。

キャンバスジャーニーに遅延を作成する場合、考慮すべき点がいくつかあります。

- 遅延制限は 30 日です。
- 遅延コンポーネントは、次の 1 つのステップだけに接続できます。

### パーソナライズされた遅延

{% alert important %}
パーソナライズされた遅延と拡張された遅延は、早期アクセス中です。この初期のアクセスに参加したい場合は、Braze アカウントマネージャーに連絡してください。
{% endalert %}

**パーソナライズされた遅延**トグルを選択して、ユーザーのパーソナライズされた遅延を設定します。これは、[コンテキストステップ]({{site.baseurl}}/user_guide/engagement_tools/canvas/canvas_components/context)で使用して、遅延するコンテキスト変数を選択できます。

今から30日後に歯磨き粉を購入することを、顧客に知らせるとします。コンテキストステップと遅延ステップの組み合わせを使用して、遅延に使用するコンテキスト変数を選択できます。この場合、コンテキストステップには次のフィールドがあります。

- **コンテキスト変数名:** product_reminder_interval
- **データタイプ:**時刻
- **値:** {% raw %}`{{custom_attribute.${Order_filled_time}}}`{% endraw %}

!["product_reminder_interval" およびその値。]({% image_buster /assets/img/context_step1.png %})

次に、30日後に顧客に注意を促すため、遅延オプションとして [**特定の日まで**] を選択し、[**遅延のカスタマイズ**] を選択してコンテキストステップの情報を使用します。つまり、ユーザーは選択したコンテキスト変数まで遅延します。

![遅延ステップでコンテキスト変数を使用して、"product_reminder_interval "に基づいてユーザを遅延させる例。]({% image_buster /assets/img/context_step2.png %})

#### 遅延の延長

これで、遅延ステップを2年まで延長できます。たとえば、アプリの新しいユーザーをオンボーディングしている場合は、セッションを開始していないユーザーを誘導するために、メッセージステップを送信する前に2か月間の遅延の延長を追加できます。

### 時間の遅延オプション

キャンバスの次のメッセージまでの遅延のタイプを選択できます。ユーザーを指定期間が経過するまで遅延させるか、特定の日時まで遅延させるかを設定できます。

{% tabs %}
{% tab 期間より後 %}

[**期間より後**] オプションでは、設定した秒数、分数、時間数、日数、週数、および特定の時刻が経過するまでユーザーを遅延させることができます。例えば、ユーザーを 4 時間遅らせたり、1 日遅らせたりできます。
  
「日」と「暦日」の計算方法の違いに注意してください。
  
- 「日」は 2４ 時間で、ユーザーが延期期間ステップに入った時刻から計算されます。 
- 「暦日」では、指定した時刻からの24時間を1日として定義します。カレンダーの曜日が選択され、時刻が指定されている場合は、会社の時刻またはユーザーのローカル時刻に遅延するように選択できます。時刻が指定されていない場合、ユーザーは会社のタイムゾーンで翌日の午前0時まで遅延されます。

また、**特定の時間**に、ユーザがいつキャンバスに進むかを指定することもできます。このオプションでは、ユーザーが遅延ステップに入った時間を考慮に入れます。この時間が設定で設定された時間を超えている場合は、遅延にさらに時間を追加します。例として、今日が12月11日で、遅延ステップが**1週間後**の UTC 午前8時に設定されているとします。ユーザーが12月4日に遅延ステップに入った場合、最初に遅延ステップに入ったのがUTC午前8時より前であれば、遅延ステップから解放されて今日のジャーニーを続行できます。この時間以降に遅延ステップに入った場合、ユーザーは翌日 (この時間の次の発生) まで遅延されます。 

{% endtab %}
{% tab 特定の日まで %}

[**特定の日付まで**] オプションでは、ユーザーを特定の日時までステップに留めることができます。

#### 考慮事項

##### ユーザーは過去の日付のステップやメッセージを受信しない

延期期間ステップに進んだ時点で、選択した日時がすでに経過している場合、ユーザーはキャンバスを退出します。キャンバスの開始日から「正確な日付まで待つ」ステップで選択した日付までの期間は最大 31 日間です。 

{% alert important %}
[Context step early access]({{site.baseurl}}/user_guide/engagement_tools/canvas/canvas_components/context)に参加している場合は、最大2 年間の遅延を設定できます。
{% endalert %}

例えば次のシナリオでは、ユーザーはステップやメッセージを受信しません。
- メッセージは5月3日午後9時に送信される予定だが、遅延ステップは5月3日午前9時に期限切れになる。 
- キャンバスステップは、ユーザーのローカルタイムゾーンの特定の時刻まで遅延するが、ユーザーのユーザープロファイルにタイムゾーンが設定されていない。遅延のデフォルトは、これらのユーザーの会社のタイムゾーンになります。このタイムゾーンは、すでに指定された時間を過ぎています。 
  
##### 後続の遅延ステップが前の遅延ステップのタイムライン内にある場合はユーザーは離脱する

キャンバスに [次の日付まで待機する:] を使用した2つの遅延ステップがあるが、1番目の遅延ステップが2番目の遅延ステップよりも長い場合、ユーザーはキャンバスを離脱します。 

たとえば、キャンバスに次のステップがあるとします。
- ステップ 1: メッセージステップ
- ステップ2: 12 月13日午後10時までの遅延ステップ
- ステップ 3: メッセージステップ
- ステップ 4: 12 月13日午後7時までの遅延ステップ
- ステップ 5: メッセージステップ
  
ステップ4にエントリしたユーザーは、ステップ4の遅延がステップ2の時間枠の一部であるため、ステップ5を受け取る前にキャンバスを離脱します。

{% endtab %}
{% tab 特定の曜日まで %}

[**特定の曜日まで**] オプションでは、ユーザーを特定の曜日の特定の時刻までステップに留めることができます。例えば、次に会社のタイムゾーンで木曜日の午後 4 時になるまでユーザーを遅らせることができます。 

この設定を成功させるには、ユーザーが選択した曜日 (例えば、木曜日) の、指定された時刻以降にキャンバスに入った場合の動作も選択する必要があります。ユーザーをその日のうちに先に進めるかか、翌週まで留めるかを選択できます。
{% endtab %}
{% endtabs %}

## 遅延ステップの使用

今日は 6 月 10 日です。6 月 11 日に、ユーザーにキャンバスに入り、近日行われるプロモーションについてのメッセージを受け取ってもらいたいとします。その後、現地時間の 6 月 17 日午後 3 時までキャンバスにユーザーを留めておきます。そして現地時間の 6 月 17 日午後 3 時に、プロモーションに関するリマインダーメッセージをユーザーに送ることにします。

キャンバスステップのシーケンスは、次のようになります。

1. まず、6月11日にユーザーがキャンバスに入った直後に送信するメッセージステップを追加します。
2. 6月17日の現地時間の午後1時までユーザーを保持する遅延ステップを作成します。
3. 遅延ステップを、メッセージをすぐに送信する別のメッセージステップにリンクします。

### キャンバス終了時の遅延コンポーネント {#delay-as-last-step}

キャンバスに遅延コンポーネントを追加し、それ以降のステップがない場合、最後のステップに到達したユーザーは、自動的にキャンバスから先へ進みます。これは、延期期間ステップの時間がまだ経過していなくても同じです。したがって、すでに遅延ステップに到達しているユーザーには、このステップの後に追加したメッセージは届きません。しかし、もしユーザーが延期期間ステップに到達しておらず、メッセージが追加された場合、そのユーザーはメッセージを受け取ります。

## 遅延分析

遅延コンポーネントでは、アクティブなキャンバスまたは以前にアクティブだったキャンバスの分析ビューに以下の指標があります。

| 指標 | 説明 |
|---|---|
| _入力済み_ | ステップの入力回数を反映する。キャンバスに再適格性があり、ユーザーが遅延ステップに2回入った場合、2つのエントリが記録されます。 |
| _次のステップに進む_ | キャンバスで次のステップに進んだエントリーの数を反映する。 |
| _終了済みのキャンバス_ | キャンバスを終了し、次のステップに進まなかったエントリの数を示します。 |
| _パーソナライゼーションが失敗しました_ | 次の理由により、ユーザー向けのパーソナライズされたメッセージまたはコンテンツを配信できなかった回数を反映します。<br> {::nomarkdown}<ul><li>遅延の値が過去の値である</li><li>遅延の値が2年以上先である</li><li><b>期間</b>の値が数値でない場合</li><li><b>特定の日</b>値が日付または日付形式の文字列でない場合</li></ul>{:/}<br>詳細については、[「パーソナライゼーションが失敗しました」エラー](#personaliztion-failed-errors)を参照してください。 |
{: .reset-td-br-1 .reset-td-br-2 role="presentation" }

これらの分析の時系列は、展開されたコンポーネントビューに表示されます。

## トラブルシューティング

### カスタマイズに失敗したエラー

ユーザーがパーソナライズされた遅延をトリガーしていない場合、その原因としては、遅延ステップの対象として設定したコンテキストステップが期待どおりに動作していないことが考えられます。[コンテキスト変数が無効な]({{site.baseurl}}/user_guide/engagement_tools/canvas/canvas_components/context/#troubleshooting)場合、コンテキストステップによってコンテキストが設定されることなく、ユーザーはキャンバスを続行します。このため、パーソナライズされた遅延など、キャンバスの後のステップに適さないことがあります。

