---
nav_title: コンテキスト 
article_title: コンテキスト 
alias: /context/
page_order: 1.5
page_type: reference
description: "このリファレンス記事では、キャンバスでコンテキストステップを作成して使用する方法について説明します。"
tool: Canvas

---

# コンテキスト

> コンテキストステップを使用して、ユーザのコンテキスト(またはそのユーザの動作に関する洞察)を表す変数のセットを、キャンバス内を移動するときに作成または更新します。各コンテキスト変数には、名前、データ型、およびLiquid を含めることができる値が含まれます。コンテキストをユーザジャーニーの一部として設定することで、遅延メッセージやコンテキスト変数に基づくユーザのフィルタなどを行うことができます。

{% alert important %}
コンテキストステップは現在初期アクセス中です。この初期のアクセスに参加したい場合は、Braze アカウントマネージャーに連絡してください。
{% endalert %}

## CDI の仕組み

各コンテキストステップは、変数名と関連するデータ型、またはコンテキスト変数(以前はキャンバスエントリプロパティと呼ばれていました)で構成されます。これらの変数は、キャンバスを介してユーザをフォローし、Liquid `context` を使用してアクセスできます。

![キャンバスの最初のステップとしてのコンテキストステップ。][1]{: style="float:right;max-width:40%;margin-left:15px;"}

コンテキスト変数を設定するには、次の2 つの方法があります。

- **キャンバスエントリで:**ユーザのキャンバスへのエントリをトリガするイベントまたはAPI コールの変数は、コンテキスト変数として保存されます。
- **コンテキストステップの使用:**コンテキスト変数は、ステップエディタで作成または更新できます。

コンテキスト変数に含まれる変数は、ユーザープロファイルに自動的には保存されません。

## コンテキストステップの作成

コンテキストステップを作成するには、キャンバスにステップを追加します。次に、サイドバーからコンポーネントをドラッグアンドドロップするか、ステップの下部にある<i class="fas fa-plus-circle"></i> plus ボタンを選択し、**Context** を選択します。

### コンテキスト変数の定義

1. コンテキスト変数に名前を付けます。
2. データタイプを選択します。
3. 液体式を入力するか、**Add Personalization**ボタンを選択します。これにより、Liquid 式で使用する Liquid スニペットが生成されます。
4. コンテキスト変数を表示するには、**プレビュー** を選択します。
5. **Done**を選択してステップを保存します。

コンテキスト変数は、**Add Personalization** ボタンを使用して、Message ステップやUser Update ステップなど、Liquid を使用できる任意の場所で使用できます。

## コンテキスト変数タイプ

ステップで作成または更新されるキャンバスコンテキスト変数には、タイプを割り当てることができます。実行時のLiquid 式が型に一致しない値を返す場合、コンテキスト変数は更新されないことに注意してください。

たとえば、コンテキスト変数のデータ型が**Date**に設定されているが、値が日付ではない場合、変数は更新されません。これは、以下が発生することを意味します。

- ユーザーは、次のステップに進むか、キャンバスの最後のステップであればキャンバスを終了します。
- キャンバスステップアナリティクスでは、これは*更新されていません* としてカウントされます。

次の場合、Braze はステップでユーザーを終了します。

- コンテキスト変数は値を返しません。
- 埋め込み接続コンテンツへの呼び出しが失敗します。
- コンテキスト変数の型が一致しません。

### JSONタイプと接続コンテンツ応答

Braze は、Connected Content レスポンスから文字列へのJSON (またはObject) 型と見なされるコンテキスト変数を評価します。コンテキスト変数が文字列として評価されないようにするには、次の結果をLiquid フィルタに入力します。`as_json_string`。例は次のとおりです。

{%raw%}
```liquid
{% connected_content http://example.com :save product %}
{{ product | as_json_string }}
```
{%endraw%}

## 遅延ステップでのコンテキスト変数の使用

コンテキストステップの情報を使用して、[パーソナライズされた遅延オプション]({{site.baseurl}}/user_guide/engagement_tools/canvas/canvas_components/delay_step/#personalized-delays) を追加できます。つまり、ユーザーを遅延させる変数を選択できます。

[1]: {% image_buster /assets/img/context_step3.png %}
