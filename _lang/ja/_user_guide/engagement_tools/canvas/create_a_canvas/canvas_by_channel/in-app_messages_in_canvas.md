---
nav_title: アプリ内メッセージ
article_title: キャンバスのアプリ内メッセージ
alias: "/canvas_in-app_messages/"
page_order: 2
page_type: reference
description: "このリファレンス記事では、リッチメッセージングを表示するためにキャンバスに追加できるアプリ内メッセージに固有の機能とニュアンスについて説明します。"
tool: Canvas
channel: in-app messages

---

# キャンバスのアプリ内メッセージ

> アプリ内メッセージをキャンバスジャーニーの一部として追加して、顧客がアプリを利用したときにリッチメッセージングを表示できます。

## CDI の仕組み

キャンバスでアプリ内メッセージを使用する前に、[キャンバス]({{site.baseurl}}/user_guide/engagement_tools/canvas/create_a_canvas/create_a_canvas/)に遅延とオーディエンスのオプションを設定してください。

Canvas ビルダーで、[Message]({{site.baseurl}}/user_guide/engagement_tools/canvas/canvas_components/message_step/) ステップを追加し、**In-App Message** を**Messaging Channel** として選択します。[メッセージがいつ期限切れになるか](#in-app-message-expiration)、どのような[昇進動作](#advancement-behavior)を行うかをカスタマイズできます。

## ユーザージャーニーへのアプリ内メッセージの追加

キャンバスにアプリ内メッセージを追加するには、次の手順を実行します。

1. [メッセージ]({{site.baseurl}}/user_guide/engagement_tools/canvas/canvas_components/message_step/)ステップをユーザージャーニーに追加します。
2. **アプリ内メッセージ**を**メッセージングチャネル**に選択します。 
3. [メッセージがいつ期限切れになるか](#in-app-message-expiration)、どのような[昇進動作](#advancement-behavior-options)を行うかを決定できます。

## トリガーされたアプリ内メッセージ

セッションの開始時にトリガーされるアプリ内メッセージ、またはカスタムイベントと購入によってトリガーされるトリガーを選択できます。

遅延が経過し、オーディエンスオプションがチェックされると、ユーザがメッセージステップに到達したときにアプリ内メッセージがライブに設定されます。ユーザがセッションを開始し、アプリ内メッセージのトリガイベントを実行すると、アプリ内メッセージが表示されます。 

アクションによってエントリがトリガーされるキャンバスステップの場合、ユーザーがセッションの途中でキャンバスに入る可能性があります。アプリ内メッセージは、セッションが開始されるまでライブに設定されません。そのため、ユーザがメッセージステップに到達したときにセッションの途中にいる場合、別のセッションを開始して関連するトリガーを実行するまで、アプリ内メッセージは受信されません。

## アプリ内メッセージの有効期限

アプリ内メッセージの有効期限を選択できます。この間、アプリ内メッセージは有効期限が切れるまで表示されるのを待機します。アプリ内メッセージは送信後に一度だけ表示できます。

![アプリ内メッセージのメッセージステップの [メッセージコントロール] セクション。アプリ内メッセージは、ステップが利用可能になってから3 日後に期限切れになります。]({% image_buster /assets/img_archive/canvas_expiration2.png %}){: style="max-width:90%"}

| オプション | 説明 | 例 |
|---|---|---|
| **ステップが使用可能になってからの期間** | ステップがユーザーに使用可能になった時点を基準にして、アプリ内メッセージの有効期限を設定します。 | 有効期限が2日間のアプリ内メッセージは、ステップの延期期間が経過し、オーディエンスの選択肢がチェックされた後に使用可能になります。その後、2 日間(48 時間) 利用可能になり、その2 日間、ユーザー s がアプリを開封するとアプリ内メッセージが表示される場合があります。 |
| **特定の日時に** | アプリ内メッセージが使用できなくなった特定の日時を選択します。 | 2024年11 月30 日に終了するセールがある場合は、このオプションを選択すると、セール終了時に関連するアプリ内メッセージが表示されなくなります。 |
{: .reset-td-br-1 .reset-td-br-2 .reset-td-br-3 role="presentation" }

## ユースケース

キャンバスのプロモーションやオンボーディングでは、この機能の使用を検討することをお勧めします。

{% tabs %}
  {% tab プロモーション %}

プロモーション、クーポン、セールには、多くの場合、ハードな有効期限があります。次のキャンバスは、購入を促すために、ユーザーに利用可能なプロモーションがあることを最も適切なタイミングで通知するよう設定されています。このプロモーションは、2019年2月28日、貴社のタイムゾーンの午前11時15分に期限切れとなります。

<style type="text/css">
.tg td{word-break:normal;}
.tg th{word-break:normal;}
</style>

<table class="tg">
<thead>
  <tr>
    <th>キャンバスステップ</th>
    <th>遅延</th>
    <th>オーディエンス</th>
    <th>チャネル</th>
    <th>有効期限</th>
    <th>ユーザー昇進</th>
    <th>詳細</th>
  </tr>
</thead>
<tbody>
  <tr>
    <td>1 日目: 50% 割引</td>
    <td>なし</td>
    <td>エントリ全員</td>
    <td>プッシュ</td>
    <td>N/A</td>
    <td>延期期間後にオーディエンスを昇進させる</td>
    <td>プロモーションについてユーザーに警告する最初のプッシュ通知。この目的は、プロモーションを利用するようにユーザーをアプリに誘導することです。</td>
  </tr>
  <tr>
    <td>アプリ内: 50% 割引</td>
    <td>なし</td>
    <td>エントリ全員</td>
    <td>アプリ内メッセージ</td>
    <td><b>有効期限:</b>2019 年 2 月 28 日午前 11 時 15 分 (会社時刻)</td>
    <td>アプリ内メッセージの表示</td>
    <td>ユーザーがアプリを開いたので、以前にプッシュメッセージがあったかどうかにかかわらず、このメッセージが表示されます。</td>
  </tr>
  <tr>
    <td>50% 割引リマインダー</td>
    <td>ユーザーが前のステップを受け取ってから 1 日後</td>
    <td>エントリ全員 <br><br><b>フィルター:</b>最終購入日が 1 週間以上前</td>
    <td>アプリ内メッセージ</td>
    <td><b>有効期限:</b>2019 年 2 月 28 日午前 11 時 15 分 (会社時刻)</td>
    <td>なし (キャンバスの最後のメッセージ)</td>
    <td>ユーザーは前のステップでアプリ内メッセージを受信しましたが、アプリを開いたにもかかわらず購入していません。<br><br>このメッセージは、プロモーションを利用して購入するユーザーをさらに引き付けることが目的です。</td>
  </tr>
</tbody>
</table>

アプリ内メッセージは、メッセージングとカスタマーエクスペリエンスの間に不一致がないように、プロモーションが期限切れになると期限切れになります。

  {% endtab %}
  {% tab ユーザーオンボーディング %}

ユーザーの第一印象は、おそらく最も重要なインプレッションです。これによって今後アプリにアクセスするかどうかが決まります。ユーザーとの初期のコミュニケーションは適切なタイミングで行い、アプリに頻繁にアクセスするよう働きかけてアプリの使用を促進する必要があります。

<table class="tg">
<thead>
  <tr>
    <th>キャンバスステップ</th>
    <th>遅延</th>
    <th>オーディエンス</th>
    <th>チャネル</th>
    <th>有効期限</th>
    <th>ユーザー昇進</th>
    <th>詳細</th>
  </tr>
</thead>
<tbody>
  <tr>
    <td>ウェルカムメール</td>
    <td>なし</td>
    <td>エントリ全員</td>
    <td>メール</td>
    <td>N/A</td>
    <td>延期期間後にオーディエンスを昇進させる</td>
    <td>プロジェクト、メンバーシップ、またはその他のオンボーディングプログラムにユーザーを歓迎する最初のメール。<br><br>これは、ユーザーをアプリに誘導してオンボーディングを開始してもらうことが目的です。</td>
  </tr>
  <tr>
    <td>3 ～ 6 日目のアプリ内メッセージ</td>
    <td>ユーザーが前のステップを受け取ってから 3 日後</td>
    <td>エントリ全員</td>
    <td>アプリ内メッセージ</td>
    <td><b>有効期限:</b>ステップが利用可能になってから 3 日後</td>
    <td>アプリ内メッセージが有効</td>
    <td>ユーザーがメールに基づいて行動しアプリにたどり着いた場合、ユーザーは希望するアプリ内メッセージを受け取り、オンボーディングとそれに関連する要件を続行またはリマインドします。</td>
  </tr>
  <tr>
    <td>5 日目のプッシュ通知 </td>
    <td>ユーザーが前のステップを受け取ってから 2 日後</td>
    <td>エントリ全員</td>
    <td>プッシュ</td>
    <td>N/A</td>
    <td>メッセージの送信</td>
    <td>ユーザーはアプリ内メッセージを受信した後、オンボーディングを続けるためのフォローアッププッシュ通知を受け取ります。</td>
  </tr>
</tbody>
</table>

これらのプッシュメッセージは、アプリ内メッセージの周りに配置され、ユーザーがアプリにアクセスしてオンボーディングを開始したことを確認します。これにより、ユーザーがアプリにアクセスできなくなる可能性のあるスパムまたは注文不履行のメッセージングを防ぎ、代わりに、アプリを使用して初期の経験に流れる合理的な注文を作成できます。

  {% endtab %}
{% endtabs %}


## アプリ内メッセージの優先順位

ユーザーがキャンバス内で同時に2つのアプリ内メッセージをトリガーする可能性があります。この場合、表示されるアプリ内メッセージが Braze により以下の優先順位に従って決定されます。 

**正確な優先度を設定**を選択し、異なるキャンバスのステップをドラッグしてキャンバスの優先順位を並べ替える。デフォルトでは、キャンバスバリアントの前のステップから順に表示されます。優先順位付けの優先順位付けが完了したら、**Apply sort**を選択します。

![2 つのステップ「Welcome IAM」と「Followup IAM」が表示されている優先順位の並べ替え。]({% image_buster /assets/img_archive/canvas_priority2.png %}){: style="max-width:85%"}

### アクティブなキャンバスのドラフトの変更

アクティブなCanvas の下書きの**Send Settings** でアプリ内メッセージの優先順位を変更すると、これらの変更は、優先順位ソーターが閉じられたときにアクティブなCanvas に直接適用されます。ただし、メッセージステップでは、キャンバスのステップ設定がステップレベルで適用されるため、ドラフトが起動されると優先順位ソーターが更新されます。 

## 昇進動作

メッセージステップは、ステップにエントリするすべてのユーザーを自動的に進めます。アプリ内メッセージがトリガーまたは表示されるのを待たないことに注意してください。メッセージの昇進動作を指定する必要はなく、全体的なステップの設定がより簡単になります。

ユーザーがアプリ内メッセージステップにエントリすると、有効期間にわたって保持されるのではなく、すぐにそのステップから進み出します。この場合、ユーザーのジャーニーに遅延ステップを設定すると役立ちます。

**Advance when message sent** オプションを使用するには、別の[audience path]({{site.baseurl}}/user_guide/engagement_tools/canvas/canvas_components/audience_paths/) を追加して、前のステップを受信しなかったユーザーをフィルタリングします。

{% details オリジナルのキャンバスエディター %}

元のエディターを使用したキャンバスの作成や複製はできなくなりました。このセクションは、アプリ内メッセージを使ったステップの昇進動作の仕組みを理解するための参考にしてください。

元のエディターで作成されたキャンバスには、昇進動作、つまりキャンバスコンポーネントを段階的に進めるための基準を指定する必要があります。[アプリ内メッセージのみのステップ](#steps-iam-only)は、[複数のメッセージタイプ](#steps-multiple-channels)のステップ(プッシュやメールなど)とは異なる進捗オプションを持ちます。キャンバスフローワークフローのアプリ内メッセージの場合、このオプションは常にオーディエンスをすぐに昇進させるように設定されています。

アクションベースの配信は、アプリ内メッセージのあるキャンバスステップでは使用できません。アプリ内メッセージのあるキャンバスステップは、スケジュールする必要があります。代わりに、キャンバスコンポーネントでスケジュールされたメッセージがユーザーに送信された後、ユーザーが (開始セッションによってトリガーされて) 初めてアプリを開いたときに、キャンバスのアプリ内メッセージが表示されます。

1 つのキャンバス内に複数のアプリ内メッセージがある場合、ユーザーはそれらの個別のメッセージをそれぞれ受信するために複数のセッションを開始する必要があります。

{% alert important %}
[**アプリ内メッセージが有効なときにユーザーを昇進させる**] を選択すると、ユーザーが後続のステップに移動した後も、アプリ内メッセージは有効期限が切れるまで利用可能になります。キャンバスの次のステップが配信されたときにアプリ内メッセージを有効にしたくない場合は、有効期限を後続のステップの遅延よりも短く設定してください。
{% endalert %}

#### 複数のチャネルを含むステップ {#steps-multiple-channels}

アプリ内メッセージと別のチャネルを含むステップには、以下の高度なオプションがあります。

| オプション | 説明 |
|---|---|---|
| メッセージ送信時のアドバンス | ユーザは、メール、Webhook、またはプッシュ通知を送信するか、アプリ内メッセージを表示して、キャンバス内の後続のステップに進む必要があります。 <br> <br>  アプリ内メッセージの有効期限が切れても、ユーザーにメール、Webhook、プッシュ通知が送信されていないか、アプリ内メッセージが表示されていない場合、ユーザーはキャンバスを退出し、次のステップに進みません。 |
| すぐにオーディエンスを次に進める | 延期期間が経過すると、メッセージを表示したかどうかにかかわらず、そのステップのオーディエンス全員が次のステップに進みます。<br> <br> 次回のステップに進むには、ステップのSegment基準とフィルター基準を満たす必要があります。 |
{: .reset-td-br-1 .reset-td-br-2 role="presentation" }

{% alert important %}
**Entire Audience**を選択した場合、ユーザーが次のステップsに移動した場合でも、有効期限が切れるまでアプリ内メッセージが使用可能になります。キャンバスの次のステップが配信されるときにこのアプリ内メッセージを有効にしない場合は、有効期限が後続のステップの延期期間よりも短いことを確認してください。
{% endalert %}

{% enddetails %}

## トリガーアクション

次のトリガーアクションから選択して、ユーザーをターゲットにすることができます。

- **購入:**任意の購入または特定の購入を行うターゲットユーザー
- **セッションを開始:**任意のアプリまたは特定のアプリでセッションを開始するターゲットユーザー
- **カスタムイベントを実行:**選択したカスタムイベントを実行するターゲットユーザー

ユーザは、キャンバスステップを入力し、セッションを開始してから、アプリ内メッセージを受信するためのトリガを実行する必要があります。つまり、セッション中の更新はサポートされません。たとえば、トリガーがセッションの開始である場合、ユーザーが行う必要がある動作は、キャンバスステップにエントリし、アプリ内メッセージを受信するセッションを開始するだけです。トリガーがセッションを開始しない場合、ユーザはキャンバスステップを入力し、セッションを開始してから、アプリ内メッセージを受信するトリガーを実行する必要があります。

![[特定の購入] がトリガーアクションとして選択されている。]({% image_buster /assets/img_archive/canvas_trigger_actions.png %}){: style="max-width:90%"}

以下のキャンバス機能はアプリ内メッセージでは使用できないため、オンになっていてもアプリ内メッセージには適用されません。

- インテリジェントタイミング
- レート制限
- フリークエンシーキャップ
- 終了条件
- サイレント時間

## キャンバスのカスタムイベントプロパティ

Canvas のアプリ内メッセージのカスタムイベントプロパティがサポートされています。ただしこれらのプロパティは、前のアクションパスではなく、メッセージステップにあるアプリ内メッセージをトリガーするカスタムイベントまたは購入メッセージからのものです。

## 考慮事項

キャンバスでアプリ内メッセージを送信する際の考慮事項を次に示します。

- ユーザがアプリを再起動しないか、セッションを開始しない場合、アプリはユーザがアプリ内メッセージに適格であるかどうかを確認できません。つまり、アプリ内メッセージは送信されません。
- 最初のクリックが発生し、キャンバスコンテキスト変数 (キャンバスエントリプロパティ) がある場合、ユーザーがキャンバスに5回再エントリすると、Braze は5回目のエントリを取得し、そのコンテキスト変数をアプリ内メッセージで使用します。
- ユーザーは、一度に10 個のアプリ内メッセージのみを受信できます。たとえば、ユーザが10 個のアプリ内メッセージに対して異なるキャンバスステップを実行する場合、これらのステップのうち10 個までしか使用できません。
