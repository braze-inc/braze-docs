---
nav_title: 値下げ通知
article_title: 値下げ通知
page_order: 3
alias: "/price_drop_notifications/"
description: "この参考記事では、Brazeカタログで値下げ通知を作成する方法について説明する。"
---

# 値下げ通知

> ここでは、値下げ通知の仕組みと設定方法、使用方法について説明します。BrazeカタログとCanvasによる価格低下通知を組み合わせることで、商品の価格が下がったときに顧客に通知することができます。

## 仕組み

ユーザーがアイテムのカスタムイベントをトリガーすると、そのアイテムの価格低下通知を受信できるよう自動的に購読登録されます。商品の価格が在庫ルール (50% 以上の値下げなど) を満たすと、すべての購読者はキャンペーンやキャンバスを通じて通知を受けることができます。ただし、通知を受け取ることができるのは、通知にオプトインしたユーザーのみです。 

## 価格低下通知のカスタムイベントの設定

`product_clicked` イベントなど、購読イベントとして使用するカスタムイベントを設定します。このイベントには、アイテム ID (カタログアイテム ID) のプロパティが含まれている必要があります。カタログ名を含めることをお勧めしますが、必須ではありません。また、価格項目の名前も指定します。これは数値データ型である必要があります。 

次の状況が発生したときに、ユーザーとカタログアイテムの料金ドロップサブスクリプションを作成できます。

- 選択したカスタムイベントはユーザによって実行されます
- カスタムイベントには、`type` プロパティがあり、`price_drop` が含まれています(`type` は配列である必要があります)。

値下げ通知と再入荷通知の両方を設定するには、`type` プロパティを使用します。これは配列である必要があります。アイテムに価格ルールを満たす価格変更がある場合、そのアイテムを購読しているすべてのユーザー (サブスクリプションイベントを行ったユーザー) を検索し、キャンペーンまたはキャンバスのトリガーに使用できる Braze カスタムイベントを送信します。 

イベントプロパティはユーザーと一緒に送信されるため、アイテムの詳細を送信するキャンペーンまたはキャンバスにテンプレートで挿入できます。

## 値下げ通知を設定する

以下の手順に従って、特定のカタログで値下げ通知を設定する。

1. カタログにアクセスし、**「設定」**タブを選択する。
2. **値下げ**トグルを選択する。
3. グローバルカタログ設定が設定されていない場合は、通知のトリガーに使用するカスタムイベントとプロパティを設定するように求められます。<br><br> ![カタログ設定はドロワーです。]({% image_buster /assets/img/catalog_settings_drawer.png %}){: style="max-width:70%;"}

| フィールド | 説明 |
| --- | --- |
| **フォールバックカタログ** | カスタムイベントに`catalog_name` プロパティがない場合、サブスクリプションに使用されるカタログ。 |
| **購読のカスタムイベント** | カタログ通知のユーザーのサブスクライブに使用されるカスタムイベント。このイベントが発生すると、そのイベントを実行したユーザーがサブスクライブされる。 |
| **購読解除のカスタムイベント** | 通知からユーザの登録を解除するために使用されるカスタムイベント。このイベントはオプションです。もしユーザーがこのイベントを行わなかった場合、90日後、もしくは値下げイベントがトリガーされた時、どちらか早く発生した時点で配信停止となります。 |
| **アイテム ID のイベントプロパティ** | サブスクリプションまたはアンサブスクリプションのアイテムを決定するために使用される、上記のカスタムイベントのプロパティ。カスタムイベントのこのプロパティは、カタログに存在するアイテムIDを含むべきである。カスタムイベントは、このアイテムがどのカタログにあるかを指定するために、`catalog_name` プロパティを含んでいる必要があります。 |
{: .reset-td-br-1 .reset-td-br-2 role="presentation" }

カスタムイベントの例を次に示します。

```json
{
    "events": [
        {
            "external_id": "<external_id>",
            "name": "subscription",
            "time": "2024-04-15T19:22:28Z",
            "properties": {
                "id": "shirt-xl",
                "catalog_name": "on_sale_products",
                "type": ["price_drop", "back_in_stock"]
            }
        }
    ]
}
```

{: start="4"}
4\.**Save**を選択し、次のセクションに進んで通知ルールを設定します。

### 通知ルールの設定

1. カタログの**設定**ページに移動します。 
2. **通知ルール**の場合は、次のオプションから選択します。<br>

    - **すべての購読中ユーザーに通知:**商品の価格が下がった時、待っているすべての顧客に通知します。
    - **通知上限の設定:**設定した通知期間ごとに、指定した数の顧客に通知します。Braze は、通知する顧客がいなくなるまで、または商品の価格が再び上がるまで、指定された数の顧客に段階的に通知します。通知速度は 1 分あたり 10,000 ユーザーを超えることはできません。<br>

2. **カタログの価格フィールド**を設定します。これは、商品の価格を決定するために使用されるカタログフィールドである。数値型でなければなりません。
3. **値下げルール**を設定します。これは、通知が送信されるべきかどうかを決定するために使用されるロジックである。価格の低下は、価格の変化率、価格フィールドがどれだけ変化したかによって設定できます。
4. [**設定を保存**] を選択します。

![値下げ機能が有効になっているカタログ設定s。価格低下ルールは、元の価格に3%変更されます。]({% image_buster /assets/img/price_drop_notifications.png %})

{% alert important %}
これらの設定にある通知ルールは、キャンバスの通知設定（静粛時間など）を置き換えるものではない。
{% endalert %}

## キャンバスで値下げ通知を使用する

カタログで値下げ通知を設定した後、これらの通知をキャンバスで使用するには、以下の手順に従います。

1. アクションベースのキャンバスを設定する。
2. トリガーとして [**値下げイベントを実行**] を選択します。
3. 価格下落通知のあるカタログ名を選択する。
4. キャンバスの[セットアップを]({{site.baseurl}}/user_guide/engagement_tools/canvas/create_a_canvas/create_a_canvas/)通常通り続ける。

これで、商品の価格が下がったときに顧客に通知される。

### Liquid の使用

値下がりしたカタログアイテムの詳細をテンプレートで挿入するには、`canvas_entry_properties` リキッドタグを使用して、`item_id` にアクセスします。 

{%raw%}``{{canvas_entry_properties.${catalog_update}.item_id}}``{%endraw%} を使用すると、価格が落ちたアイテムのID が返されます。{%raw%}``{{canvas_entry_properties.${catalog_update}.previous_value}}``{%endraw%} は更新前のアイテムの価格値を返し、{%raw%}``{{canvas_entry_properties.${catalog_update}.new_value}}``{%endraw%} は更新後の新しい価格値を返します。 

この Liquid タグ {%raw%}``{% catalog_items <name_of_your_catalog> {{canvas_entry_properties.${catalog_update}.item_id}} %}}``{%endraw%} をメッセージの冒頭で使い、{%raw%}`{{items[0].<field_name>}}`{%endraw%} をメッセージ全体で使用してそのアイテムに関するデータにアクセスします。

## 考慮事項

- ユーザーの購読期間は 90 日間です。アイテムが90日経っても値下がりしない場合、ユーザーはサブスクリプションから外される。
- **Notify all subscribed users**通知ルールを使用する場合、Brazeは10分間で10万人のユーザーに通知する。
- Brazeは、カタログアイテムを毎分更新するために10件のリクエストを処理します。更新エンドポイントでは、リクエストごとに50個のアイテム更新が可能であり、1分あたり最大500個のアイテム更新をサポートします。これにより、在庫調整通知がトリガされます

