## 基本チェック

### あるユーザーにアプリ内メッセージが表示されない

1. SDKが新しいアプリ内メッセージを要求したとき、ユーザーはセッション開始時にセグメンテーションにいたか？
2. ユーザーはキャンペーンターゲティングルールに従ってアプリ内メッセージを受信する資格があったか、または再資格があったか？
3. ユーザーはフリークエンシーキャップの影響を受けたのか？
4. ユーザーはコントロールグループにいたのか？キャンペーンがABテスト用に設定されているか確認する。
5. 期待されたメッセージの代わりに、より優先順位の高い別のアプリ内メッセージが表示されたか？
6. 私のデバイスはキャンペーンで指定された正しい向きになっていたか？
7. 私のメッセージは、SDK によって適用された、トリガー間のデフォルトの30秒の最小時間間隔によって抑制されたのでしょうか？

### このプラットフォームで、アプリ内メッセージがすべてのユーザーに表示されなかった

1. キャンペーンは、モバイルアプリまたはWebブラウザのいずれかを適切にターゲットとするように設定されているか。例として、キャンペーンがWebブラウザのみをターゲットにしている場合、Androidデバイスには送信されない。
2. カスタムUIを実装し、意図したとおりに機能しているか？他のアプリ側のカスタム処理や抑制が表示を妨げていないか？ 
3. この特定のプラットフォームとアプリのバージョンで、アプリ内メッセージが正常に表示されたことはあるか？
4. トリガーはデバイスのローカルで行われたのか？REST コールを使用して SDK のアプリ内メッセージをトリガーすることはできません。

### アプリ内メッセージがすべてのユーザーに表示されなかった

1. ダッシュボードやアプリとの連携で、トリガーアクションは適切に設定されたか？
2. 期待されたメッセージの代わりに、より優先順位の高い別のアプリ内メッセージが表示されたか？
3. 使用している SDK のバージョンは新しいですか？アプリ内メッセージの種類によってはSDKのバージョン要件がある。
4. セッションは適切に統合されているか？このアプリでセッション分析は機能しているか？

### アプリ内メッセージの表示に時間がかかった

1. CDN から HTM Lベースのアプリ内メッセージに大きな画像またはビデオファイルを提供する場合は、ファイルが可能な限り小さくなるように最適化されていることと、CDN のパフォーマンスが高いことを確認してください。
2. ダッシュボードでアプリ内メッセージに`delay` を設定したか確認する。
{% case include.sdk %}
  {% when "iOS", "Android" %}
3. 状況に応じて、アプリ内メッセージは表示前に関連画像をダウンロードするか、ディスクから読み込む。低速のネットワーク接続や非常にパフォーマンスの低いデバイスを使用している場合、この処理に時間がかかることがある。画像ができるだけ小さくなるように最適化されていることを確認します。
{% endcase %}

これらのシナリオの詳細については、<a id="troubleshooting-in-app-advanced">高度なトラブルシューティングのセクション</a>を参照してください。

## インプレッションとクリック分析の問題点

{% if include.sdk == "iOS" %}
### インプレッションとクリックが記録されない

メッセージ表示またはクリックアクションを手動で処理するようにアプリ内メッセージデリゲートを設定している場合は、アプリ内メッセージの[クリック数](https://braze-inc.github.io/braze-swift-sdk/documentation/brazekit/braze/inappmessage/logclick(buttonid:using:))と[インプレッション数](https://braze-inc.github.io/braze-swift-sdk/documentation/brazekit/braze/inappmessage/logimpression(using:))を手動で記録しなければなりません。
{% elsif include.sdk == "Android" %}
### インプレッションとクリックが記録されない
アプリ内メッセージデリゲートを設定し、メッセージ表示やクリックアクションを手動で処理する場合、アプリ内メッセージのクリック数やインプレッションを手動で記録する必要がある。
{% endif %}

### インプレッションが予想より低い

1. トリガーはセッション開始時にデバイスへの同期に時間がかかるため、ユーザーがセッション開始直後にイベントや購入を記録すると競合状態が発生する可能性があります。考えられる回避策の 1 つは、キャンペーンを変更してセッションの開始をトリガーし、目的のイベントまたは購入をセグメント化することです。なお、イベント発生後の次回セッション開始時にアプリ内メッセージが配信されることに注意してください。

2. キャンペーンがセッションの開始やカスタムイベントによってトリガーされる場合、このイベントやセッションがメッセージをトリガーするのに十分な頻度で発生していることを確認する必要があります。このデータを[概要]({{site.baseurl}}/user_guide/data_and_analytics/analytics/understanding_your_app_usage_data/#understanding-your-app-usage-data)（セッションデータの場合）または[カスタムイベント]({{site.baseurl}}/user_guide/data_and_analytics/configuring_reporting/#configuring-reporting)ページで確認してください。

![カスタムイベント「お気に入りに追加」が1か月間に発生した回数のグラフが表示されているカスタムイベントページ]({% image_buster /assets/img_archive/trouble5.png %})

### インプレッションが以前より低下している

1. ローンチ後、誰も意図せずにセグメンテーションやキャンペーンを変更していないことを確認する。セグメンテーションとキャンペーンの変更履歴は、いつ、誰が、どのような変更を行ったかをインサイトしてくれる。

![キャンペーンの詳細ページで、ユーザーがキャンペーンを最後に閲覧してからの7つの変更点を含む変更履歴を表示するためのリンク]({% image_buster /assets/img_archive/trouble4.png %})

2. 優先順位の高い別のアプリ内メッセージキャンペーンでトリガーイベントを再利用していないか確認する。

## 高度なトラブルシューティング {#troubleshooting-in-app-advanced}

ほとんどのアプリ内メッセージの問題は、配信と表示の 2 つの主要なカテゴリに分けることができます。期待したアプリ内メッセージがデバイスに表示されなかった原因をトラブルシューティングするには、<a id="troubleshooting-in-app-message-delivery">アプリ内メッセージがデバイスに配信された</a>ことを確認し、<a id="troubleshooting-in-app-message-display">メッセージ表示のトラブルシューティングを行う</a>。

### 配信のトラブルシューティング {#troubleshooting-in-app-message-delivery}

SDK はセッション開始時に Braze サーバーからアプリ内メッセージを要求します。アプリ内メッセージがデバイスに配信されているかどうかを確認するには、アプリ内メッセージが SDK によってリクエストされ、Braze サーバーによって返されていることを確認する必要があります。

#### メッセージが要求され、返されたかどうかを確認する

1. ダッシュボードで [テストユーザー]({{ site.baseurl }}/user_guide/administrative/app_settings/developer_console/internal_groups_tab/#adding-test-users) として自分自身を追加します。
2. ユーザーを対象としたアプリ内メッセージキャンペーンを設定します。
3. アプリケーションで新しいセッションが発生することを確認します。
4. [イベントユーザーログ]({{ site.baseurl }}/user_guide/administrative/app_settings/developer_console/event_user_log_tab/#event-user-log-tab) を使用して、セッション開始時にデバイスがアプリ内メッセージを要求していることを確認します。テストユーザーのセッション開始イベントに関連付けられた SDK リクエストを見つけます。
  - トリガーされたアプリ内メッセージをリクエストするためのアプリであれば、[**レスポンスデータ**] の [**リクエスト済みレスポンス**] フィールドに `trigger` が表示されます。
  - アプリが元のアプリ内メッセージをリクエストするためのものだった場合、[**レスポンスデータ］**] の [**リクエスト済みレスポンス**] フィールドに `in_app` が表示されます。
5. [イベントユーザーログ]({{ site.baseurl }}/user_guide/administrative/app_settings/developer_console/event_user_log_tab/#event-user-log-tab) を使用して、応答データで正しいアプリ内メッセージが返されるかどうかを確認します。<br>![]({% image_buster /assets/img_archive/event_user_log_iams.png %})

##### リクエストされていないメッセージのトラブルシューティング

アプリ内メッセージがリクエストされていない場合、アプリ内メッセージはセッション開始時にリフレッシュされるため、アプリがセッションを正しくトラッキングしていない可能性があります。また、アプリのセッションタイムアウトセマンティクスに基づいて、アプリが実際にセッションを開始していることを確認してください:

![成功したセッション開始イベントを表示するイベントユーザーログで見つかったSDKリクエスト。]({% image_buster /assets/img_archive/event_user_log_session_start.png %})

##### メッセージが返されない問題のトラブルシューティング

アプリ内メッセージが返されない場合、キャンペーンターゲティングの問題が発生している可能性があります。

1. セグメントにユーザーが含まれていない。
  - ユーザーの [\*\*エンゲージメント**]({{ site.baseurl }}/user_guide/engagement_tools/segments/using_user_search/#engagement-tab) タブで、[**セグメント**] に正しいセグメントが表示されているかどうかを確認します。
2. ユーザーが以前にアプリ内メッセージを受け取ったことがあり、再度受け取る資格がなかった。
  - **キャンペーン作成ツール**の**配信**ステップの [キャンペーン再適格性設定]({{ site.baseurl }}/user_guide/engagement_tools/campaigns/building_campaigns/delivery_types/reeligibility/) を確認し、再適格性設定がテスト設定と整合していることを確認します。
3. ユーザーがキャンペーンのフリークエンシーキャップに達した。
  - キャンペーン [フリークエンシーキャップ設定]({{ site.baseurl }}/user_guide/engagement_tools/campaigns/building_campaigns/rate-limiting/#frequency-capping) を確認し、テスト設定と整合していることを確認します。
4. キャンペーンにコントロールグループが存在した場合、ユーザーがコントロールグループに分類された可能性があります。
  - キャンペーンバリアントが [**制御**] に設定されている受信キャンペーンバリアントフィルターでセグメントを作成し、ユーザーがそのセグメントに分類されたかどうかを確認することで、これが発生したかどうかを確認できます。
  - 統合テスト目的でキャンペーンを作成する場合は、コントロールグループの追加をオプトアウトしてください。


### 表示のトラブルシューティング{#troubleshooting-in-app-message-display}

アプリ内メッセージのリクエストと受信に成功しているにもかかわらず表示されない場合、デバイス側のロジックが表示を妨げている可能性がある：

1. トリガーイベントは想定どおりに発生していますか。これをテストするには、メッセージを別のアクション（セッション開始など）でトリガーするように設定し、それが表示されるかどうかを確認する。
{% if include.sdk == "iOS" %}
2. トリガーされたアプリ内メッセージは、[トリガー間の最小時間間隔]({{site.baseurl}}/developer_guide/platform_integration_guides/swift/in-app_messaging/in-app_message_delivery/#minimum-time-interval-between-triggers) (デフォルトは30秒) に基づいてレート制限されます。
{% elsif include.sdk == "Android" %}
2. トリガーされたアプリ内メッセージは、[トリガー間の最小時間間隔]({{site.baseurl}}/developer_guide/platform_integration_guides/android/in-app_messaging/in-app_message_delivery/#minimum-time-interval-between-triggers) (デフォルトは30秒) に基づいてレート制限されます。
{% elsif include.sdk == "Web" %}
2. トリガーされたアプリ内メッセージは、[トリガー間の最小時間間隔]({{site.baseurl}}/developer_guide/platform_integration_guides/web/in-app_messaging/in-app_message_delivery/#minimum-time-interval-between-triggers) (デフォルトは30秒) に基づいてレート制限されます。
{% endif %}
3. 画像のダウンロードに失敗すると、画像付きのアプリ内メッセージが表示されなくなります。画像のダウンロードに失敗していないか、デバイスのログを確認してください。画像をメッセージから一時的に削除してみて、それで表示されるかどうか試してみます。
{% case include.sdk %}
  {% when "iOS", "Android" %}
4. アプリ内メッセージ処理をカスタマイズするようにデリゲートを設定している場合は、デリゲートがアプリ内メッセージ表示に影響していないことを確認してください。
  {% when "Web" %}
5. `braze.subscribeToInAppMessage` または `appboy.subscribeToNewInAppMessages` を介してカスタムのアプリ内メッセージを処理する場合は、そのサブスクリプションをチェックして、それがアプリ内メッセージの表示に影響を及ぼしていないことを確認します。
{% endcase %}
{% case include.sdk %}
  {% when "iOS", "Android" %}
6. 端末の向きがアプリ内メッセージで指定された向きと一致しなかった場合、アプリ内メッセージは表示されません。デバイスの向きが正しいことを確認してください。
{% endcase %}
7. アプリ内メッセージがセッション開始によってトリガーされ、拡張セッションタイムアウトが設定されている場合、メッセージが表示される速さに影響します。例えば、セッションのタイムアウトが300秒に設定されている場合、それ以下の時間でアプリを開封してもセッションはリフレッシュされないため、セッション開始をトリガーとしたアプリ内メッセージは表示されない。

