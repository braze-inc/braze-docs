---
nav_title: Webhook および接続コンテンツリクエストのトラブルシューティング
article_title: Webhook および接続されたコンテンツリクエストのトラブルシューティング
page_order: 3
channel:
  - webhooks
description: "この記事では、Webhook およびConnected Content エラーコードのトラブルシューティング方法について説明します。エラーの内容と、エラーを解決する手順についても説明します。"
---

# Webhook および接続コンテンツリクエストのトラブルシューティング

> この記事では、Webhook とConnected Content の一般的なエラーコードをトラブルシューティングする方法について説明し、リクエストでこれらのエラーがどのように発生するかについても詳しく説明します。

## 4XXエラー

`4XX` エラーは、エンドポイントに送信された要求に問題があることを示します。これらのエラーは、通常、誤った形式のパラメーター、認証ヘッダーの欠落、不正な URL など、誤ったリクエストによって発生します。

エラーコードの詳細と解決する手順については、次の表を参照してください。

<style>
table td {
    word-break: break-word;
}
</style>

<table>
  <thead>
    <tr>
      <th>エラーコード</th>
      <th>意味</th>
      <th>解決する手順</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><b>400 不正なリクエスト</b></td>
      <td>リクエストに無効な構文があります。</td>
      <td>
        <ul>
          <li>構文エラーがないか要求ペイロードを確認します。</li>
          <li>すべての必須フィールドが含まれ、正しくフォーマットされていることを確認します。</li>
          <li>JSON ペイロードを送信する場合は、JSON 構造を検証します。</li>
        </ul>
      </td>
    </tr>
    <tr>
      <td><b>401 未許可</b></td>
      <td>リクエストにはユーザー認証が必要です。</td>
      <td>
        <ul>
          <li>正しい認証資格情報 (API キーやトークンなど) がリクエストヘッダーに含まれていることを確認します。</li>
          <li>エンドポイントにアクセスするためのユーザー権限があることを確認します。</li>
        </ul>
      </td>
    </tr>
    <tr>
      <td><b>403禁</b></td>
      <td>エンドポイントはリクエストを理解しますが、承認は拒否します。</td>
      <td>
        <ul>
          <li>API キーまたはトークンに必要な権限があるかどうかを確認します。</li>
          <li>エンドポイントにアクセスするためのユーザー権限があることを確認します。</li>
        </ul>
      </td>
    </tr>
    <tr>
      <td><b>404 見つかりません</b></td>
      <td>エンドポイントは、要求されたリソースを見つけることができません。</td>
      <td>
        <ul>
          <li>エンドポイントのURL にタイプミスや不正なパスがないかどうかを確認します。</li>
          <li>アクセスしようとしているリソースが存在することを確認します。</li>
        </ul>
      </td>
    </tr>
    <tr>
      <td><b>405 メソッドが許可されていません</b></td>
      <td>リクエストメソッドはエンドポイントによって認識されますが、ターゲットリソースによってサポートされていません。</td>
      <td>
        <ul>
          <li>リクエストで使用されているHTTP メソッド(DELETE、GET、POST、PUT) を確認します。</li>
          <li>エンドポイントが使用しているメソッドをサポートしていることを確認します。</li>
        </ul>
      </td>
    </tr>
    <tr>
      <td><b>408 リクエストのタイムアウト</b></td>
      <td>エンドポイントが要求の処理をタイムアウトしました。</td>
      <td>
        <ul>
          <li>リクエストで使用されているHTTP メソッド(DELETE、GET、POST、PUT) を確認します。</li>
          <li>エンドポイントが使用しているメソッドをサポートしていることを確認します。</li>
        </ul>
      </td>
    </tr>
    <tr>
      <td><b>409 競合</b></td>
      <td>リソースの現在の状態と競合するため、要求は不完全です。</td>
      <td>
        <ul>
          <li>リクエストで使用されているHTTP メソッド(DELETE、GET、POST、PUT) を確認します。</li>
          <li>エンドポイントが使用しているメソッドをサポートしていることを確認します。</li>
        </ul>
      </td>
    </tr>
    <tr>
      <td><b>429 リクエストが多すぎます</b></td>
      <td>特定の時間内に送信されたリクエストが多すぎます。</td>
      <td>
        <ul>
          <li>キャンペーンまたはキャンバスステップのレート制限を下げます。</li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

## 5XXエラー

`5XX` エラーは、エンドポイントに問題があることを示します。これらのエラーは通常、サーバー側の問題によって発生します。

| エラーコード                    | 意味                                                                                                                                         |
|-------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------|
| **500 内部サーバーエラー** | エンドポイントで予期しない状態が発生したため、リクエストを完了できませんでした。                                                       |
| **502 不正なゲートウェイ**           | エンドポイントは、アップストリームサーバーから無効な応答を受信しました。                                                                                   |
| **503 サービス利用不可**   | エンドポイントは、現在、一時的な過負荷またはメンテナンスのために要求を処理できません。                                                    |
| **504 ゲートウェイタイムアウト**       | エンドポイントは、アップストリームサーバーからタイムリーな応答を受け取りませんでした。                                                                               |
| **529 ホストのオーバーロード**       | エンドポイントホストが過負荷になり、応答できませんでした。 |
| **598 ホスト異常**        | エンドポイントホストが一時的に異常とマークされるため、Braze は応答をシミュレートしました。詳細については、[Unhealthy host detection](#unhealthy-host-detection)を参照してください。 |
| **599 接続エラー**      | エンドポイントへの接続を確立しようとしたときに、ブレーズでネットワーク接続タイムアウトエラーが発生しました。つまり、エンドポイントが不安定またはダウンしている可能性があります。 |
{: .reset-td-br-1 .reset-td-br-2 role="presentation" }

### 5XX エラーの解決

一般的な`5XX` エラーのトラブルシューティングのヒントを次に示します。

- **Message Activity Log**で利用可能な特定の詳細については、エラーメッセージを確認してください。Webhook の場合は、Braze ホームページの**Performance Over Time** セクションに移動し、Webhook の統計を選択します。ここから、エラーが発生した日時を示すタイムスタンプが見つかります。
- 大量のリクエストを送信してエンドポイントを過負荷にしないようにしてください。一括で送信するか、レート制限を調整してエラーが発生しないかどうかを確認できます。

## 不健全ホストの検出

Braze webhooks とコネクテッドコンテンツは、不健全ホストの検出メカニズムを採用して、タイムアウト、過剰なリクエスト、または Braze がターゲットエンドポイントと正常に通信することを妨げるその他の結果が発生する原因となる、ターゲットホストの著しい速度低下または過負荷の発生を検出します。これは、ターゲットホストに問題を引き起こす可能性のある不必要な負荷を軽減するための保護手段として機能します。また、Brazeインフラストラクチャを安定化し、高速メッセージング速度を維持するのにも役立ちます。

検出しきい値は、Webhook と Connected Content で異なります。
- **Webhook の場合**: **エラー数が、任意の1分間の移動時間枠で3,000を超える場合** (ホスト名とアプリグループの一意の組み合わせあたり。エンドポイントパスごとでは**ありません**)、Braze はターゲットホストへのリクエストを一時的に1分間停止します。
- **Connected Content の場合**: **の失敗数が3000を超え、かつ、任意の1分間の移動時間枠**(ホスト名とアプリグループの一意の組み合わせごとに-**not**エンドポイントパスごとに)でエラー率が90%を超えた場合、Brazeは一時的にターゲットホストへの要求を1分間停止します。

リクエストが停止されると、Braze は `598` エラーコードで応答をシミュレートし、健全性の低下を示します。1分後、ホストが正常であることが判明した場合、Braze はリクエストをフルスピードで再開します。ホストがまだ不健全である場合、Braze はもう1分待ってから再試行します。

次のエラーコードは、不健全なホスト検出器の失敗回数に影響します。`408`、`429`、`502`、`503`、`504`、`529`。

Webhook の場合、Braze は異常なホストディテクタによって停止されたHTTP リクエストを自動的に再試行します。この自動再試行は指数バックオフを使用し、失敗する前に数回だけ再試行します。Webhook エラーの詳細については、[エラー、再試行ロジック、およびタイムアウト]({{site.baseurl}}/user_guide/message_building_by_channel/webhooks/creating_a_webhook#errors-retry-logic-and-timeouts) を参照してください。

コネクテッドコンテンツの場合、ターゲットホストへのリクエストが不健全ホスト検出器によって停止された場合、Braze はメッセージのレンダリングを続行し、エラー応答コードを受け取ったかのように Liquid ロジックに従います。これらのコネクテッドコンテンツリクエストが不健全なホスト検出器によって停止されたときに再試行されるようにするには、`:retry` オプションを使用します。`:retry` オプションの詳細については、[Connected Content retries]({{site.baseurl}}/user_guide/personalization_and_dynamic_content/connected_content/connected_content_retries) を参照してください。

異常なホスト検出が問題を引き起こしている可能性があると思われる場合は、[Braze Support]({{site.baseurl}}/support_contact/)までご連絡ください。

## 自動メールとメッセージアクティビティログのエントリ

### 自動メールの設定

24時間の間にワークスペースで100,000を超える Webhook または Connected Content エンドポイントエラー (再試行を含む) が発生した場合、エラーの解決方法に関する以下の情報を含むメールが送信されます。 

- ワークスペースの名前
- キャンバスまたはキャンペーンへのリンク
- エンドポイント URL
- エラーコード
- エラーが最後に観測された時刻
- メッセージアクティビティログおよび関連ドキュメントへのリンク

{% alert note %}
ワークスペースごとにエラーしきい値を設定できます。このしきい値を調整するには、[Braze Support]({{site.baseurl}}/support_contact/)にお問い合わせください。
{% endalert %}

エンドポイントエラーは次のとおりです。

- **`4XX`:** `400`, `401`, `403`, `404`, `405`, `408`, `409`, `429`
- **`5XX`:** `500`, `502`, `503`, `504`, `598`, `599`

これらのメールは、ワークスペースレベルで1 日に1 回のみ送信されます。これらのメールに登録するユーザーがいない場合、会社の管理者全員に通知されます。

これらのメールを受信するためにサインアップするには、次の手順を実行します。

1. [**設定**] > [**管理者設定**] > [**通知設定**] に移動します。
2. [**キャンバス＆キャンペーン**] セクションで、[**Connected Content エラー**] および [**Webhook エラー**] を選択します。

### メッセージアクティビティログのエントリ

自動メールをトリガーしたエラーに関連する[Message Activity Log]({{site.baseurl}}/user_guide/administrative/app_settings/message_activity_log_tab) には、少なくとも1 つのエントリがあります。

### Braze Currents におけるエラーに関するその他のインサイト

Webhook 関連の問題の透明性を高めるために、Braze は詳細な Webhook エラーイベントを Currents およびSnowflake データ共有にストリーミングします。これらのイベントには、失敗した webhook リクエスト (HTTP `4xx` または `5xx` レスポンスなど) が含まれ、Webhook の問題がメッセージ配信にどのように影響するかについて、より多くの可視性を提供します。失敗イベントには、再試行されるエラーだけでなく、端末エラーも含まれます。

{% alert note %}
接続されたコンテンツリクエストは、これらのWebhook 障害イベントには含まれません。
{% endalert %}

詳細については、[メッセージエンゲージメントイベント用語集]({{site.baseurl}}/user_guide/data/braze_currents/event_glossary/message_engagement_events/)を参照してください。
