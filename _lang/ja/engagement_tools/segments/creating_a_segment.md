---
nav_title: セグメントを作成する
article_title: セグメントの作成
page_order: 0
page_type: tutorial
description: "この記事では、Braze を使用してセグメントを設定・作成する手順について説明します。"
tool: Segments
search_rank: 3
---

# [![Brazeラーニングコース]({% image_buster /assets/img/bl_icon3.png %})](https://learning.braze.com/segmentation-course){: style="float:right;width:120px;border:0;" class="noimgborder"}Segmentの作成

> セグメンテーションにより、人口統計、行動、または技術的な特徴やアクションに基づいてユーザーをターゲットすることができます。セグメンテーションとメッセージングの自動化を創造的かつインテリジェントに使用することで、ユーザーをファーストタッチから長期顧客へとシームレスに移行できます。セグメントは、データの変更に応じてリアルタイムで更新されます。また、ターゲットおよびメッセージングの目的で必要な数のセグメントを作成できます。

## ステップ 1: セグメントセクションに移動する

[**オーディエンス**] > [**セグメント**] に移動します。

## ステップ 2: セグメントに名前を付ける

セグメントの作成を開始するには、[**セグメントを作成**] を選択します。セグメントに名前を付けます。絞り込むユーザーのタイプがわかるような名前にしてください。これは、キャンペーンまたはキャンバスにターゲットを設定するときに、セグメントを特定するのに役立ちます。曖昧なセグメント名は混乱を招く。

オプションとして、以下を行うことができます。
- セグメントに説明を追加して、この視聴者の意図について詳しく説明し、他のチームメンバーが参照できるようにメモを残す。
- セグメントに[チーム]({{site.baseurl}}/user_guide/administrative/app_settings/manage_your_braze_users/teams/)を追加する。
- さらに整理するために、セグメントに[タグを]({{site.baseurl}}/user_guide/administrative/app_settings/tags/)追加する。

![セグメントに「離脱ユーザー」という名前を付け、セグメントの説明に「過去 14 日以内に非アクティブだったユーザーをターゲットとする主な離脱ユーザーセグメント」と書き込んだセグメントの作成モーダル。次の 2 つのボタンがあります: キャンセルしてセグメントを作成する。]({% image_buster /assets/img_archive/segment_app_selection.png %}){: style="max-width:80%;"}

## ステップ 3: アプリまたはプラットフォームを選択する

[**すべてのアプリのユーザー**] (デフォルト) または [**特定のアプリのユーザー**] を選択して、ターゲットにするアプリまたはプラットフォームを選択します。**ユーザー s は、指定されたアプリs に少なくとも1 つのセッションを持つユーザーs を対象とします。

例えば、アプリ内メッセージを iOS デバイスのみに送信したい場合は、iOS アプリを選択します。これにより、iOS デバイスと Android デバイスの両方を使用するユーザーは、iOS デバイスのみでメッセージを受信します。具体的なアプリs の一覧では、**ユーザー s from no アプリ s** を使用すると、ユーザー s をセッションs なしで、かつ(通常はユーザーの読み込みまたはREST API を使用して作成される) で含めることができます。

![[使用したアプリ] セクションで [すべてのアプリのユーザー] オプションが選択されている [セグメント詳細] パネル]({% image_buster /assets/img_archive/Segment2.png %}){: style="max-width:80%;"}

## ステップ 4: セグメントにフィルターを追加する

セグメントに少なくとも1つのフィルターを追加する。好きなだけフィルターを組み合わせて、セグメンテーションをより具体的にすることができる。 

{% alert note %}
Braze は、アプリを初めて使用するまでユーザーのプロファイルを生成しないため、アプリをまだ開いていないユーザーをターゲットにすることはできません。
{% endalert %}

#### フィルターグループ

フィルターはフィルター・グループにまとめられている。すべてのフィルターは、最低1つのフィルターを持つフィルターグループの一部でなければならない。セグメントは複数のフィルターグループを持つことができる。1 つ追加するには、[**フィルターグループを追加**] を選択します。フィルターグループ名の横にカーソルを置くと表示されるアイコンを選択して、フィルターグループ名を編集する。

![名前の横に編集アイコンがあるフィルターグループ]({% image_buster /assets/img_archive/edit_filter_group_name.png %})()

各フィルターの横にあるアイコンを選択して、フィルターエディターを折りたたんだり、個々のフィルターを複製したりします。フィルターを複製した後、各ドロップダウン内でその値を調整することができます。

#### ANDとORを使ったセグメンテーション・ロジック

フィルターグループ内では、フィルターを「AND」または「OR」で結合できます。フィルターグループ間では、グループを「AND」または「OR」で結合できます。フィルターグループを使うと、次のようなセグメンテーション・ロジックを作ることができる：
- (A AND B AND C) OR (C AND E AND F)
- (A OR B OR C) AND (C OR D OR F)

フィルターに "OR "を選択すると、セグメントには、これらのフィルターの1つ、いくつか、またはすべての組み合わせを満たすユーザーが含まれることになる。AND」を選択すると、そのフィルターを通らなかったユーザーはセグメントに含まれない。

{% alert tip %}
否定フィルター (購読グループの「is not」など) を含む複数のフィルターに「OR」を選択した場合、ユーザーをセグメントに含めるには「OR」が適用されるフィルターのいずれかを満たすだけで良いということを覚えておいてください。他のフィルターに関係なく否定フィルターを適用するには、[除外グループ](#exclusion)を使います。
{% endalert %}

{% details When to avoid the OR operator %}

ユーザーをターゲットにする状況では、`OR`演算子の使用を避けるべき場合があります。`OR` 演算子は、ユーザーがステートメント内の1つ以上のフィルターの基準を満たす場合にtrueと評価されるステートメントを作成します。たとえば、"Foodies"に属するが、"Non-foodies"または"Candy-lovers"のいずれにも属さないユーザーのSegmentを作成する場合は、`OR`演算子を使用します。

![Segment & quot;foodies"ではなく、Segment s & quot;non-foodies"または"candy-lovers"でユーザーのグループをフィルタリングします。]({% image_buster /assets/img_archive/or_operator_segment.png %})

ただし、"Foodies"Segmentが"Non-foodies"および"Candy-lovers"Segment sに属するSegment ユーザーを目標とする場合は、`AND`演算子を使用します。このようにして、キャンペーンまたはキャンバスを受け取るユーザーは、意図されたセグメント（「フーディーズ」）に属し、同時に他のセグメント（「非フーディーズ」および「キャンディー愛好家」）には属しません。 

次の否定的なターゲティング基準は、2つ以上のフィルターが同じ属性を参照している場合、`OR`演算子と一緒に使用しないでください:

- `not included`
- `is not`
- `does not equal`
- `does not match regex`

`not included`、`is not`、または`does not equal`が`does not match regex`演算子とともに文中で2回以上使用される場合、関連する属性のすべての値を持つユーザーが対象となります。

{% enddetails %}

#### フィルター演算子

選択したフィルターによって、フィルター値を特定するための演算子は異なります。さまざまなタイプのカスタム属性で利用可能な演算子について詳しく知りたい場合は、[カスタム属性ストレージを]({{site.baseurl}}/user_guide/data_and_analytics/custom_data/custom_attributes/#setting-custom-attributes)参照のこと。is any of」演算子を使う場合、そのフィールドに含めることができる項目の最大数は256であることに注意。

{% alert note %}
Braze は、アプリを初めて使用するまでユーザーのプロファイルを生成しないため、アプリをまだ開いていないユーザーをターゲットにすることはできません。
{% endalert %}

![AND 演算子のあるセグメント化フィルターグループ]({% image_buster /assets/img_archive/segmenter_filter_groups.png %})()

{% alert important %}
すでに**セグメントメンバーシップ**フィルターを使用しているセグメントは、さらに他のセグメントに含めたり、ネストしたりすることはできません。これにより、セグメント A にセグメント B が含まれ、セグメント B が再びセグメント A を含めるというサイクルを防ぐことができます。もしそうなれば、セグメントは自分自身を参照し続けることになり、誰が実際にそのセグメントに属しているのかを計算することができなくなります。

また、このようにセグメンテーションを入れ子にすると、複雑さが増し、動作が遅くなる。代わりに、同じフィルターを使用して、含めようとしているセグメンテーションを再作成します。
{% endalert %}

#### 除外グループ（オプション） {#exclusion}

セグメントを構築する際、1つまたは複数の除外グループを適用できる。除外グループには、セグメントから除外するユーザーを特定する基準が含まれ、常に "AND NOT "演算子でフィルタグループに接続される。

除外グループはセグメント基準を上書きする。ユーザーが除外グループ基準に該当する場合、フィルターグループ内の基準を満たしていても、セグメントには含まれない。

フィルターグループと同じようにフィルターを追加して除外グループを作成する。除外グループの_推定到達可能ユーザー_数統計は、除外基準適用後にセグメントに残る推定ユーザー数を示す。

除外されたユーザーは、セグメントの_合計到達可能ユーザー_統計の一部としてカウントされない。

![2 つのフィルターを持つ除外グループ。]({% image_buster /assets/img_archive/segmenter_exclusion_groups.png %})()

#### ファンネル統計の表示

**ファネル統計の表示**を選択して、そのフィルターグループの統計を表示し、追加されたフィルターがSegment統計にどのように影響するかを確認します。その時点までのすべてのフィルターs によってターゲットされているユーザーs の推定数とパーセンテージe が表示されます。フィルターグループの統計が表示されると、フィルターs を変更するたびに自動的に更新されます。これらの統計は推定され、生成に少し時間がかかる場合があります。

フィルターs の間にAND を使用すると、ファンネル統計が減少し、フィルターs の間にOR を使用するとファンネル統計が増加することに注意してください。

![Segmentファンネル統計を持つ2つのフィルターs。]({% image_buster /assets/img_archive/segment_funnel_statistics.png %})

ユーザーフローを文書化するフィルターを追加することで、ユーザーが脱落するポイントを確認できます。たとえば、ソーシャルネットワーキングアプリで、オンボーディング処理中にユーザーが失われる可能性がある場所を確認する場合は、サインアップ、友達の追加、最初のメッセージの送信のためにカスタムデータフィルターを追加することができます。ユーザーの85%がサインアップして友達を追加しているが、最初のメッセージを送信したのは45%にすぎないことがわかった場合、オンボーディングキャンペーンやマーケティングキャンペーン中に、より多くメッセージを送信するように促すことに焦点を当てる必要があることがわかります。

#### セグメントのテスト

セグメントにアプリとフィルターを追加したら、ユーザーを検索してセグメント条件と一致するかどうかを確認することで、セグメントが期待どおりに設定されているかどうかをテストできます。そのためには、**User Lookup**セクションでユーザーの`external_id` または`braze_id` を検索する。**ユーザルックアップ**のメール住所では検索できませんのでご注意ください。

![検索フィールドを備えたユーザー検索セクション。]({% image_buster /assets/img_archive/user_lookup.png %}){: style="max-width:70%;"}

ユーザールックアップ検索は次の場合に利用できます。
- セグメントを作成する
- キャンペーンまたはキャンバス・オーディエンスを設定する
- オーディエンス・パスのステップを設定する

ユーザーがセグメント、フィルター、アプリの条件にマッチすると、アラートにその旨が表示される。

![「testuser」のユーザー検索により、「testuser matches all of the segments, filters, and apps」というアラートがトリガーされる。]({% image_buster /assets/img_archive/user_lookup_match.png %})()

ユーザーがセグメント、フィルター、またはアプリの条件の一部またはすべてに一致しない場合、トラブルシューティングのために欠落している条件がリストされます。

![「test1 does not match the following targeting criteria:」というアラートと欠落している条件が表示されているユーザー検索。]({% image_buster /assets/img_archive/user_lookup_nomatch.png %})()

#### シングルユーザーセグメント

ユーザー名やユーザーID などのユーザーを識別する一意の属性を使用して、単一のユーザーセグメント (または少数のユーザーのセグメント) を作成できます。

ただし、セグメント統計は、結果が +/-1% 以内という 95% の信頼区間のランダムサンプルに基づいて計算されるため、セグメンテーション統計またはプレビューにはこの個々のユーザーが表示されない場合があります。ユーザーベースが大きいほど、セグメントのサイズは概算である可能性が高くなります。セグメントにターゲットとする単一のユーザーが含まれていることを確認するには、[**正確な統計を計算する**] を選択します。これにより、セグメント内の正確なユーザー数が 99.999% を超える精度で計算されます。

Braze には、ユーザー ID またはメールアドレスで特定のユーザーをターゲットにするテストフィルターがあります。

## ステップ 5: セグメントを保存する

[**保存**] を選択します。これで、ユーザーへのメッセージ送信を開始する準備が整った！

## 測定セグメントサイズ

セグメントのメンバーシップとサイズのモニタリングについては、[セグメントサイズの測定]({{site.baseurl}}/user_guide/engagement_tools/segments/measuring_segment_size/)を参照してください。

## セグメントのアーカイブ

特定のセグメントが不要になったり、引退したくなった場合は、**セグメント**ページに行き、そのセグメントの行にあるメニューから**アーカイブを**選択することで、そのセグメントをアーカイブすることができる。

{% alert warning %}
セグメントをアーカイブすると、そのセグメントを使用しているキャンペーンやキャンバスもアーカイブされます (セグメントが単一のキャンバスコンポーネントでのみ使用されている場合も含む)。これには、両方のセグメントと、それらを使用するキャンペーンやキャンバスをネストしたセグメントもアーカイブに含まれます。
<br><br>
関連するセグメントをアーカイブすると、どのキャンペーンとキャンバスがアーカイブされるかが警告リストに表示されます。
{% endalert %}

セグメントのアーカイブを解除するには、[**セグメント**] ページ内でセグメントに移動し、[**アーカイブ解除**] を選択します。

## ユーザーが複数のデバイスを持っている場合のターゲティング行動

複数のデバイスで同じアカウントにログインしている場合、ユーザーは複数のデバイスを持っています。[[ユーザープロファイル]({{site.baseurl}}/user_guide/engagement_tools/segments/user_profiles/)] の [**最近のデバイス**] セクションで複数のデバイスをチェックできます。

デバイス依存のフィルター（デバイスモデル、デバイスOS、アプリのバージョン）を使ってセグメント化する場合、セグメントにはフィルター基準に一致するすべてのユーザーが含まれる。これらのユーザーには、フィルター基準を満たさないものも含め、すべてのデバイスにメッセージが送信される。例えば、ユーザーAが2台のデバイスを持っているとしよう：デバイス 1 は OS 13.0、デバイス 2 は OS 10.0です。あるセグメントがOS 10.0のユーザーをターゲットにしている場合、このユーザーはそのセグメントの一部となり、両方のデバイスでメッセージを受け取ることになる。

### プッシュ通知

各ユーザーに1回だけプッシュ通知を送るように指定できる。[メッセージを作成する]({{site.baseurl}}/user_guide/message_building_by_channel/push/creating_a_push_message#step-4-compose-your-push-message)際、「**追加設定**」で「**ユーザーの最後に使用したデバイスにのみ送信する**」を選択する。

!["追加の設定S"ユーザーの最後に使用した機器にのみ送信するためのチェックボックス付き。]({% image_buster /assets/img_archive/send_to_last_device.png %}){: style="max-width:60%;"}

### 考慮事項

- **送信メッセージ数は、オーディエンスサイズを超える場合があります。**複数のデバイスを持つユーザーがいる場合、それぞれのデバイスがメッセージを受信することができる。そのため、セグメント内のユーザーよりもメッセージの送信数が多くなります。
- **ユーザーのセグメントメンバーシップは、予想どおりに表示されない場合があります。**
    - ユーザーは、別のデバイスに関連する属性に基づいて、現在のデバイスをターゲットにすることができます。ユーザーがメッセージを受信することを予期していなかった場合、そのユーザーのユーザー・プロフィールに複数のデバイスがないか確認する。
    - あるユーザーは、送信時にはターゲット・セグメントに入っていたかもしれないが、その後、そのユーザーのデバイスに関連する行動によって、ターゲット・セグメントに含まれなくなる可能性がある。その結果、現在フィルター条件にマッチしていないにもかかわらず、ユーザーがキャンペーンやキャンバスを受け取ってしまう可能性がある。<br><br>たとえば、現在 OS 13.0 を使っているユーザーが、最新アプリのバージョンが OS 10.0 のユーザー向けのメッセージを受け取る可能性があります。この場合、ユーザーはメッセージの送信時に OS 10.0 を使用しており、その後 OS 13.0 にアップグレードしたためです。<br><br> 同様に、ユーザーが後に異なるアプリバージョンのデバイスを使用した場合、そのユーザーのプロファイルは新しい最新アプリバージョンで更新されます。すると、メッセージの送信時には適格であったにも関わらず、そのメッセージを受け取る適格性がなかったように見えるかもしれません。


