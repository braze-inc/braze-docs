---
nav_title: セグメントエクステンション
article_title: セグメントエクステンション
page_order: 6
page_type: reference
description: "この操作方法に関する記事では、セグメントエクステンションをセットアップして使用し、セグメンテーション機能を強化する方法について説明します。"
tool: Segments
---

# セグメントエクステンション

> セグメントエクステンションを使えば、ユーザーの履歴を長期間にわたって非常に正確にセグメントすることができる。例えば、セグメントエクステンションを使えば、過去16ヶ月の間に特定の製品を購入したユーザーや、あなたのサービスで一定の金額を利用したユーザーをターゲットにすることができます。イベントプロパティを使ってこのオーディエンスを絞り込み、ターゲティングをさらに細かくする。

Brazeのセグメンテーションにより、カスタムイベントや購買行動に基づいてユーザーをターゲットにすることができる。セグメントエクステンションはこの能力を強化し、ユーザープロファイルに保存された履歴データを活用できるようにする。セグメントエクステンションを使用すると、過去2年間 (730日間) に何度でもカスタムイベントや購入イベントを完了したユーザーを識別し、リーチすることができます。 

## セグメントエクステンションを使う理由

Brazeセグメントは、ダイナミックなユーザーグループを作成する強力なターゲティングツールを提供する。ほとんどのユースケースでは、オーディエンスに効果的にリーチするにはこれで十分です。セグメントエクステンションは、最大2年前の行動を分析したり、複雑なロジックを適用したりする必要がある高度なユースケース向けに設計されており、データのリテンションやシステムパフォーマンスを損なうことはない。[SQL]({{site.baseurl}}/user_guide/engagement_tools/segments/sql_segments)クエリー(SQLセグメント拡張)または独自の[データウェアハウス]({{site.baseurl}}/user_guide/engagement_tools/segments/segment_extension/cdi_segments)のデータを使用して、オーディエンスをさらに絞り込むことができます。

例えば、Brazeのデフォルトセグメンテーションは、最近製品を購入したユーザーを識別するなど、あなたが定義した特定の基準に適合するユーザーを見つける。セグメントエクステンションを使用すると、特定の製品の特定の色を18から24か月前に少なくとも2回購入したユーザーを特定するなど、より詳細に分析できます。セグメントエクステンションは拡張機能であり、必要条件ではない。より高度なフィルターが必要な場合や、より長いルックバック・ウィンドウが必要な場合は、データ使用量を最適化しながら手助けしてくれる素晴らしいツールだ。

{% alert note %}
デフォルトでは、特定の時間に1つのワークスペースにつき25個のアクティブなセグメントエクステンションが割り当てられます。この制限を増やす必要がある場合は、Brazeカスタマーサクセスマネージャーに連絡して、ユースケースについて話し合ってください。
{% endalert %}

## セグメントエクステンションを作成する

セグメントエクステンションを作成するには、カスタムイベントプロパティに基づいてユーザーのセグメントを絞り込むフィルターを作成します。セグメントエクステンションを作成する際、セグメントを静的なものにするか、設定した間隔でダイナミックなリフレッシュを行うかを選択する。

### ステップ 1: セグメントエクステンションに移動する

[**オーディエンス**] > [**セグメントエクステンション**] に移動します。

[セグメントエクステンション] テーブルから、[**エクステンションを新規作成**] をクリックし、セグメントエクステンションの作成方法を選択します。

- **シンプルなエクステンション:**ガイド付きフォームを使用して、単一のイベントに焦点を当てたセグメントエクステンションを作成します。
SQL を使用しない場合に最適です。
- **テンプレートを使用して始める:**Snowflake データを使用して、カスタマイズ可能なテンプレートで SQL セグメントを作成します。
- **増分更新:**過去2日間のデータを自動的に更新するか、必要に応じて手動で更新する Snowflake SQL セグメントを作成します。精度とコスト効率のバランスをとるのに最適です。
- **完全更新:**Snowflakeデータを含むSQL Segment、または手動リフレッシュ時にオーディエンス全体を再計算する任意の[CDI 接続ソース]({{site.baseurl}}/cdi_segment_extensions/) を記述します。オーディエンスに関する完全な最新のビューが必要な場合に最適です。

![さまざまなセグメントエクステンションの作成エクスペリエンスを選択できるテーブル。]({% image_buster /assets/img/segment/segment_extension_modal.png %})({: style="max-width:50%"})

SQL を使用するエクスペリエンスを選択する場合は、[SQL Segment Extensions]({{site.baseurl}}/user_guide/engagement_tools/segments/sql_segments/)を参照してください。**簡易拡張**を選択した場合は、ステップ 2 に進みます。

#### SQL クレジットの利用状況

以下のセグメント拡張タイプは、SQL クレジットを消費します。

- SQL セグメント拡張(増分リフレッシュとフルリフレッシュの両方)
- カタログセグメント
- CDIセグメント 
    - クレジットは自分のデータウェアハウス内で消費されます

### ステップ 2: セグメントエクステンションに名前を付ける

フィルタリングするユーザーのタイプを記述して、セグメントエクステンションに名前を付けます。これにより、このエクステンションをフィルターとしてセグメントに適用するときに、このエクステンションを簡単かつ正確に検出できます。

![セグメントエクステンション「Online Shoppers Extension - 90 Days」。]({% image_buster /assets/img/segment/segment_extension2.png %})()

### ステップ 3: 条件を選択する

ターゲティングの条件として、購入、メッセージエンゲージメント、カスタムイベントのいずれかを選択します。希望のイベントタイプ条件を選択したら、ユーザーリストでターゲットにする購入アイテム、メッセージインタラクション、または特定のカスタムイベントを選択します。次に、ユーザーがイベントを完了する必要がある回数 (より大きい、より小さい、または等しい) と期間を選択します。特にセグメントエクステンションの場合は、過去730日間 (2年間) までさかのぼることができます。

730日を超えるイベントデータに基づくセグメンテーションは、**セグメント**にある他のフィルターを使用して実行できます。期間を選択するときは、相対的な日付範囲 (過去 X 日間)、開始日、終了日、または正確な日付範囲 (日付 A ～ B) を指定できます。

![]({% image_buster /assets/img/segment/segment_extension1.png %})() 2025年3月1日から2025年3月31日までの日付範囲で、カスタムイベントを2回以上実行したユーザーのセグメンテーション基準。

#### イベントプロパティのセグメンテーション

ターゲティングの精度を上げるには、[**プロパティフィルターを追加**] チェックボックスを選択します。これにより、購入またはカスタムイベントの特定のプロパティに基づいて掘り下げることができます。文字列、数値、ブール値、および時間オブジェクトに基づくイベントプロパティのセグメンテーションをサポートしています。

文字列プロパティの場合、複数の値を一度に入力できます。以下の例では、このフィルターは、ゴールド、シルバー、ブロンズのいずれかのステータスのユーザーを検索します。

![文字列プロパティに基づくセグメンテーション]({% image_buster /assets/img/segment/property5.png %})()

![数値プロパティに基づくセグメンテーション。]({% image_buster /assets/img/segment/property2.png %})

![ブール値プロパティに基づくセグメンテーション。]({% image_buster /assets/img/segment/property3.png %})

![日時オブジェクトに基づくセグメント化。]({% image_buster /assets/img/segment/property4.png %})

[階層化イベントプロパティ]({{site.baseurl}}/user_guide/data/custom_data/custom_events/nested_objects/)に基づくセグメンテーションもサポートしています。

![ネストされたイベントプロパティに基づいてセグメント化します。]({% image_buster /assets/img/segment/nested_segment_extensions.png %})

セグメントエクステンションはイベントプロパティの長期保存に依存しており、タイムスタンプ付きのプロパティ保存制限はありません。過去2年間に追跡されたイベントプロパティを振り返ることができます。セグメントエクステンション内でイベントプロパティを使用しても、データポイント使用量には影響しません。

{% alert note %}
セグメントでイベントプロパティや階層化されたカスタム属性を使用するには、セグメントエクステンションは必要ない。Segment拡張は、デフォルト Segmentを作成するために使用されるヒストリックウィンドウを拡張するだけです。過去30 日間のイベントプロパティーを使用する、または階層化カスタム属性 s を使用するリアルタイムデフォルト[Segment]({{site.baseurl}}/user_guide/engagement_tools/segments/) を作成できます。同様に、セグメントエクステンションは必要なく、イベントプロパティに基づいてリアルタイムでトリガーされるように[メッセージをスケジュールする]({{site.baseurl}}/user_guide/engagement_tools/campaigns/building_campaigns/delivery_types/triggered_delivery/)ことができる。
{% endalert %}

### ステップ 4:リフレッシュ設定を指定する（オプション）

{% multi_lang_include segments.md section='Refresh settings' %}

### ステップ 5: セグメントエクステンションを保存する

**Save**を選択すると、Segment Extensionが処理を開始します。セグメント拡張の生成に要する時間は、使用しているユーザーの数、取り込んでいるカスタムイベントまたは購入イベントの数、および履歴を調べている日数によって異なります。

Segment Extension の処理中は、Segment Extension の名前の横に小さなアニメーションが表示され、Segment Extension リストの**Last Processed** 列に"Processing" という単語が表示されます。Segment Extensionの処理中は編集できません。

![2 つのアクティブなエクステンションがある [セグメントエクステンション] ページ。]({% image_buster /assets/img/segment/segment_extension5.png %})()

Segment拡張が処理中の場合、Brazeは、処理がオーディエンス セグメンテーションのために開始される以前からデフォルト Segmentのバージョン履歴を引き続き使用します。処理は、保存または更新が行われるたびに実行され、ユーザープロファイル s-in の照会と更新が含まれます。つまり、デフォルト Segmentのメンバーシップは瞬時に更新されません。つまり、更新処理が始まる前にユーザーのアクションが実行されない場合には、特定の更新が完了した時点でそのユーザーがセグメントエクステンションに含まれることは保証できません。逆に、基準を満たさなくなったリフレッシュ以前にSegmentエクステンションに入っていたユーザーは、リフレッシュ処理が完了し、更新sがアプリ嘘になるまで、デフォルト Segmentに合致し続けます。

### ステップ6: エクステンションをセグメントで使用する

Segmentエクステンションを作成した後は、フィルターとして使用してSegmentを作成したり、キャンペーンまたはキャンバスのオーディエンスを定義したりできます。まず、[**ユーザー属性**] セクションのフィルターリストから [**Braze セグメントエクステンション**] を選択します。

![[フィルター] セクションのフィルタードロップダウンに [Braze セグメントエクステンション] が表示されている。]({% image_buster /assets/img/segment/segment_extension7.png %})()

Braze Segment拡張フィルター一覧から、このSegmentに含めるか除外するSegment拡張を選択します。

![「1 email click in the last 56 days」というセグメントを含む [Braze セグメントエクステンション] フィルター。]({% image_buster /assets/img/segment/segment_extension6.png %})()

Segment Extension 条件を表示するには、**View Extension Details** を選択して、詳細を新しいウィンドウに表示します。

![「1 email click in the last 56 days」というエクステンション。]({% image_buster /assets/img/segment/segment_extension8.png %})({: style="max-width:70%;"})

これで、[セグメントの作成]({{site.baseurl}}/user_guide/engagement_tools/segments/creating_a_segment/)を通常どおり進めることができます。

## よくある質問

### 複数のカスタムイベントを使用するセグメント・エクステンションを作成できるか？

はい。[SQL セグメントエクステンション]({{site.baseurl}}/user_guide/engagement_tools/segments/sql_segments/)を使用する場合、複数のイベントを追加したり、複数の Snowflake テーブルを参照したりできます。 

[**シンプルなエクステンション**] セグメントエクステンションを使用する場合、カスタムイベントを1つ、購入イベントを1つ、またはチャネルインタラクションを1つ選択できます。ただし、デフォルト Segmentの作成時に、複数のSegment拡張機能をANDまたはORで組み合わせることができます。

### アクティブなキャンペーンにセグメントエクステンションが存在する場合、アーカイブすることは可能か？

セグメントエクステンションをアーカイブする前に、そのセグメントエクステンションをすべてのアクティブなメッセージングから削除する必要がある。

### セグメントエクステンションで配列を使用できますか?

はい。配列を使用するには、プロパティ名に括弧 (`[]`) を付ける。プロパティが `location_code` の場合は `location_code[]` と入力します。 

Braze は配列をトラバースし、トラバースされた配列の中にイベントプロパティと一致する項目があるかどうかを調べるときに、`[]` を使用します。たとえば、配列プロパティの少なくとも1 つの値と一致するユーザーのセグメント拡張を作成できます。

### Braze では「過去 _ 日間」という相対的な期間はどのように計算されますか?

セグメントエクステンションが相対的な期間(「過去 X 日間」) を計算する場合、開始時刻は UTC の午前0時に設定されます。例えば、2024-09-16 21:00 UTC に更新され、10 日間を指定するセグメントエクステンションの場合、開始時刻は2024-09-06 21:00 UTC ではなく、2024-09-06 00:00 UTC に設定されます。 

ただし、会社のタイムゾーンでの午前0時を基準として10日前にカスタムイベントを実行したユーザーを識別する場合や、現在時刻を基準として10日前にイベントを実行したユーザーを識別する場合には、SQL セグメントを使用してタイムゾーンを指定できます。

