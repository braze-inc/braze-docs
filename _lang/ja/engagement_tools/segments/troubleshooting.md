---
nav_title: トラブルシューティング
article_title: トラブルシューティング セグメント
page_order: 12
page_type: reference
tool: 
  - Segments
description: "この参考記事では、トラブルシューティングの手順と、セグメントを使用する際の留意点について解説する。"
---

# セグメントのトラブルシューティング

## エラー数

### ターゲットオーディエンスが複雑すぎて起動できない

このまれなエラーは、ターゲットオーディエンスに含まれる正規表現が多すぎるか、正規表現が長すぎるか、フィルターが細かすぎる（「郵便番号が30,000のいずれかである」など）か、フィルターが多すぎる場合に発生する。これは、フィルターが参照されたセグメンテーション内にあるか、**ターゲットオーディエンスの**ステップでフィルターとして追加されたかに関わらず、キャンペーンまたはキャンバスオーディエンス内のすべてのフィルターを含む。

![複雑さの閾値に達するターゲットオーディエンスに対するエラー。]({% image_buster /assets/img/segment/target_audience_too_complex_error.png %})

キャンペーンやキャンバスにセグメンテーションフィルターを追加すると、それらのフィルターはBrazeでクエリーに変換される（これらのクエリーの文字数は、ダッシュボードユーザーが見る文字数と1対1ではない）。Brazeがキャンペーンやキャンバスを送信する際、ターゲットオーディエンスのすべてのフィルターを組み合わせたクエリーを実行する。ターゲットオーディエンスに対して、結果のクエリの文字数を制限する閾値を適用する。特定のキャンペーンまたはキャンバスについて、すべての追加フィルターを含め、参照されるすべてのセグメントにわたって文字数を合計する。あるセグメンテーションについて、すべてのフィルターとフィルター値の文字数を合計する。

キャンペーン、キャンバス、またはセグメントがしきい値を超えて起動できない場合、ダッシュボードにエラーが表示される。このエラーが表示された場合は、ターゲットとするオーディエンスをシンプルにしてから、次のような方法で再スタートさせる：

- オーディエンスが複数のセグメンテーションを参照している場合、同じフィルターが複数のセグメンテーションに表示されるなど、セグメンテーションが重複していないことを確認する。
- セグメンテーションフィルターで古いデータを参照していないか確認する。例えば、キャンバスが何ヶ月も止まっているにもかかわらず、過去1週間に特定のキャンバスステップを受け取っていないユーザーを探すような、時代遅れのフィルターがあるかもしれない。
- ユーザーIDやメールのリストだけのセグメンテーション（正規表現フィルターを使用することが多い）を[CSVインポートに]({{site.baseurl}}/user_guide/data/unification/user_data/import_users/csv/)変換し、1つのCSVフィルターに簡素化することができる。
- CDIがあれば、データウェアハウスから直接グループを引き出すCDIセグメンテーションを作成できるかもしれない。

フィルターの最適化について、[サポートに問い合わせる]({{site.baseurl}}/braze_support/)こともできる。

{% alert note %}
2025年4月から文字数制限を開始した。2025年4月以前に開始されたキャンペーンとキャンバスは、グランドファザリングが適用され、上限を超え続けることができるが、新規に作成されたキャンペーンとキャンバスは上限を超えることができない。グランドフェザーキャンペーンまたはキャンバスを編集または複製した場合、オーディエンスが上限以下に更新されるまで、そのキャンペーンを開始することは**できない**。
{% endalert %}

### X アクティブまたは停止中のキャンペーンまたはキャンバスがオーディエンスの複雑さの閾値を超える。

このバナーは、アクティブまたは停止中のキャンペーンまたはキャンバスにオーディエンスの複雑さのしきい値を超えるオーディエンスがいる場合に、キャンペーンまたはキャンバスリストの上部に表示される。バナーを選択して、リストをしきい値を超えるキャンペーンまたはキャンバスだけにフィルターし、「[ターゲットオーディエンスが複雑すぎて起動できません](#target-audience-is-too-complex-to-launch)」のトラブルシューティングのステップに従う。

![4つのアクティブまたは停止中のキャンバスがオーディエンスの複雑さのしきい値を超えているというエラーバナー。]({% image_buster /assets/img/segment/audience_complexity_threshold_banner.png %})

### フィルターが10,000バイトを超えるか、長すぎて保存できない。

Brazeは、個々のセグメンテーションフィルターを最大10,000バイトに制限している。これは、英語の10,000文字または日本語の3,333文字に相当する。個々のフィルターが10,000バイトを超えると、そのフィルターがセグメンテーション内にあるか、キャンペーンやキャンバスに直接追加されているかにかかわらず、警告が表示される。 

![10,000文字を超える値を持つフィルターのエラーバナー。]({% image_buster /assets/img/segment/filter_error.png %})

![カスタム属性フィルター（`menu_item`, ）の属性値が10,000文字を超える場合のエラー。]({% image_buster /assets/img/segment/segment_filter_error.png %})


このエラーが発生するのは非常にまれだが、発生する場合は、ユーザーIDやメールアドレスのリストを対象とした正規表現フィルターが典型的である。その場合は、以下のステップでフィルターをCSVに変換できる：

1. 影響を受けるセグメンテーションまたは特定の正規表現フィルターからユーザーをエクスポートする。 
2. 必要に応じてCSVをクリーニングする。必要なのはBraze IDかAppboy IDのどちらかだが、必要なければ他の列はすべて削除して構わない。また、ユーザーデータが最新のものであることを確認するために、データを見直すことをお勧めする（例えば、ターゲットとしなくなったユーザーを削除する）。
3. CSVファイルを再度[インポートする]({{site.baseurl}}/user_guide/data/unification/user_data/import_users/csv/)ことで、自動的にユーザーを1つの非常に効率的なCSVベースのフィルターにグループ化する。

## ユーザーの行動

### ユーザーがセグメントから外れた

セグメントの作成中に、あるユーザーが使用できない場合、ユーザー自身のアクティビティや、以前に対話した他のキャンペーンやキャンバスの結果として、そのユーザーのセグメント適格性を決定するユーザーデータが変更された可能性があります。再適格性がオンになっている場合、ユーザープロファイルには受信したキャンペーンの最新データが表示されます。

### フィルターで特定のアプリに絞り込んでいるときに、他のアプリのユーザーの情報が表示される

ユーザーは複数のアプリを持つことができるため、セグメンテーションページの [**使用したアプリ**] セクションで特定のアプリを選択すると、少なくともそのアプリを持っているユーザーの結果が表示されます。このフィルターでは、そのアプリだけを使用しているユーザーの結果は得られない。

## フィルター

### フィルタオプションの変更

フィルターオプションは、カスタム属性にBrazeに渡すフォーマット（データ型）に関連している。Brazeがカスタム属性用に認識しているデータ型を確認するには、「**データ設定**」>「**カスタム属性**」に移動する。

フィルターオプションが変更された場合は、データが以前とは異なるフォーマット（データ型）でBrazeに渡されていることを示している。各種データ型とそのフィルター設定オプションの詳細については、[カスタム属性データ型]({{site.baseurl}}/user_guide/data/activation/custom_data/custom_attributes#custom-attribute-data-types)を参照してください。

ダッシュボードでカスタム属性のデータタイプを変更すると、異なるフォーマットでBrazeに送信されたデータは拒否されることに留意してほしい。

## 分析とレポート

### キャンペーンアナリティクスの*メッセージ送信数*または*ユニーク受信者*数がセグメント数と一致しない 

キャンペーン分析で [*送信済みメッセージ*] または [*ユニーク受信者数*] の数がセグメントフィルター `Has received message from campaign X` のユーザー数と一致しない場合、次の 2 つの理由が考えられます。

1. **キャンペーン開始後に、ユーザーが孤立したか、アーカイブまたは削除が行われた可能性がある。**<br><br>例えば、1,000人のユーザーがキャンペーンを受け、同じ日にCSVエクスポートを行ったとしよう。1,000人のユーザーが報告されていることがわかるだろう。翌月、1,000 人のユーザーのうち 50 人が削除されます (例えば、`users/delete` エンドポイントによる)。ここでもう一度 CSV エクスポートを行うと、950 人のユーザーが報告されますが、[**キャンペーン分析**] の [*ユニーク受信者数*] は 1,000 人のままです。<br><br>言い換えれば、*Unique Recipients（ユニーク受信者）*メトリクスは、インクリメントされたカウントであり、セグメンターとCSVエクスポートは、現在存在するユーザーのカウントを提供する。<br><br>

2. **キャンペーンには再応募資格が設定されているため、ユーザーは何度もキャンペーンに再応募できる。**<br><br>例えば、あるメールキャンペーンで、再応募資格を0分に設定し（ユーザーはオーディエンスセグメントの条件を満たしている限り、キャンペーンに再応募できる）、キャンペーンを1ヶ月以上実施しているとしよう。このフィールドには重複したユーザーに送信されたメッセージが含まれるため、**Campaign Analyticsの** *送信メッセージ*数はセグメントの数と一致しない。<br><br>これは、Braze がユニークユーザーを*日次ユニーク受信者数* (1 日に特定のメッセージを受信したユーザー数) としてカウントしているためです。つまり、「ユニーク」な期間は 1 日しかないため、再適格者はユニーク受信者として複数回カウントされます。その結果、*日次ユニーク受信者数*が CSV エクスポートのユーザープロファイル数より多くなることがあります。CSV ファイル内のユーザープロファイルは、真にユニークなものです。

### 1つのアプリのみでセッションを記録しているにもかかわらず、ユーザーが2つのアプリに割り当てられている

セグメンテーションを作成する際、[特定のアプリを利用した]({{site.baseurl}}/user_guide/engagement_tools/segments/creating_a_segment/#step-3-choose-your-app-or-platform)ユーザーをターゲットにすることができる。ユーザーがそのアプリに割り当てられるには、特定のアプリでセッションを行う必要がある。しかし、アプリでセッションを行わなくても、ユーザーが特定のアプリに割り当てられるシナリオが2つある。 

最初のシナリオは、`/users/track` エンドポイントを使用する際、`app_id` フィールドが入力される場合である。具体的には、この例のように、[イベント]({{site.baseurl}}/api/objects_filters/event_object/)または[購入オブジェクトを]({{site.baseurl}}/api/objects_filters/purchase_object/)使用する場合である：

```json
{
    "events": [
    {
      "external_id": "john_doe123",
      "app_id": "my_web_app_id",
      "name": "Custom Event",
      "time": "2025-08-17T19:20:30+1:00"
    }
  ]
}
```

2つ目のシナリオは、この例のように、`/users/track` エンドポイントを使用してプッシュチケットを移行する際に、`app_id` フィールドが入力される場合である： 

```json
"app_group_id": "{YOUR_APP_GROUP_ID}",
"attributes": [
{
      "push_token_import": false,
      "external_id": "external_id1",
      "country": "US",
      "language": "en",
      "{YOUR_CUSTOM_ATTRIBUTE}": "{YOUR_VALUE}",
      "push_tokens": [
        {"app_id": "{APP_ID_OF_OS}", "token": "{PUSH_TOKEN_STRING}"}
      ]
  }
]
```
