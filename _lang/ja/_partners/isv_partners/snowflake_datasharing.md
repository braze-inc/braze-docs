---
nav_title: Snowflake データ共有
hidden: true
---

# Snowflakeデータ共有の統合

> Snowflake Data Shareを統合方法として使用する場合、Brazeが顧客に代わってSnowflakeインスタンスに共有をプロビジョニングする。この共有には、すべてのメッセージエンゲージメントとユーザー行動イベントが自動的に含まれる。

シェアは、顧客がSnowflakeデータシェアの権利を購入した後、顧客ごとにプロビジョニングされる。顧客がデータ共有を要求すると、Brazeは顧客のワークスペースに共有を追加し、顧客はセルフサービスUIを使って関連するパートナーのSnowflakeアカウントデータを追加できる。

![\]({% image_buster /assets/img/snowflake.png %})

共有がプロビジョニングされると、すべてのデータは受信データ共有としてSnowflakeインスタンス内からすぐにアクセスできるようになる。

![\]({% image_buster /assets/img/snowflake2.png %})

Snowflakeインスタンス内では、リージョンごとに1つのシェアが表示される。各テーブルには、`app_group_id` というカラムがあり、これが事実上Brazeのテナントキーとなっている。同じリージョン内のシェアに新しい顧客が追加されると、既存のテーブル内で異なる`app_group_ids` として表示される。

{% alert important %}
Brazeは現在、Snowflake AWSのUS East-1リージョンとEU-Central（フランクフルト）リージョンですべてのユーザーレベルのデータをホストしている。Brazeは地域を越えて共有することができるが、`US-EAST-1` および/または`EU-CENTRAL-1` と共有することが顧客にとって最も費用対効果が高い。
{% endalert %}

{% alert tip %}
[未加工のテーブルスキーマは]({{site.baseurl}}/assets/download_file/data-sharing-raw-table-schemas.txt?ffbc5f5ca7092bc9ae26268aa0e711df)こちらからダウンロードするか、Snowflakeマーケットプレイスで入手可能な[サンプルイベントデータセットを](https://app.snowflake.com/marketplace/listing/GZT0Z5I4XY0/braze-braze-user-event-demo-dataset)使用して、共有されるイベントに慣れることができる。
{% endalert %}

## 重複イベントを処理する

重複は予想されるが、すべてのイベントはIDカラムという一意の識別子を持っている。重複は`select distinct(id)` で削除できる。

## 壊れる変更と壊れない変更

### 非破壊的な変更

壊れることのない変更はいつでも可能であり、一般的に追加機能を提供する。ブレークしない変更の例：
- 新しいテーブルまたはビューを追加する
- 既存のテーブルやビューにカラムを追加する

{% alert important %}
新しいカラムは非改行カラムとみなされるため、Brazeは、`SELECT *` クエリを使用する代わりに、各クエリで目的のカラムを明示的にリストすることを強く推奨する。あるいは、カラム名を明示的に指定したビューを作成し、テーブルに直接問い合わせるのではなく、それらのビューに問い合わせることもできる。
{% endalert %}

### 破壊的な変更

可能な限り、速報性のある変更にはアナウンスと移行期間を設ける。変更点の例としては、以下のようなものがある：
- テーブルまたはビューを削除する
- 既存のテーブルやビューからカラムを削除する
- 既存のカラムのタイプまたはヌル可能性を変更する

## 一般データ保護規則（GDPR）への対応

Brazeが保存するほぼすべてのイベント記録には、ユーザーのパーソナライズされた情報（PII）を表すフィールドがいくつか含まれている。いくつかのイベントには、メール・アドレス、電話番号、デバイスID、言語、性別、位置情報が含まれることがある。ユーザーからの忘れ去り要求がBrazeに提出された場合、そのユーザーに属するイベントのPIIフィールドは無効化される。こうすることで、その出来事の歴史的記録を削除することはないが、その出来事が特定の個人に結びつくことはなくなる。
