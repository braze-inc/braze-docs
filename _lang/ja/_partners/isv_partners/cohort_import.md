---
nav_title: Cohort Import Integration
alias: /cohort_import/
hidden: true
---

# パートナー・コホート・インポート連携

> パートナーコホートインポート連携機能により、パートナーはBrazeと連携し、パートナーのアプリケーション内で生成されたユーザーのコホートを送信することができる。

## クラスタのURL

Brazeは、米国とEU全域の複数のクラスターでアプリケーションをホスティングしている。インポート・エンドポイントのURLは、クライアントの会社のインスタンスがホストされているクラスタによって異なる：

| インスタンス | RESTエンドポイント |
| ----- | ------------------------------- |
| US-01 | `https://rest.iad-01.braze.com` |
| US-02 | `https://rest.iad-02.braze.com` |
| US-03 | `https://rest.iad-03.braze.com` |
| US-04 | `https://rest.iad-04.braze.com` |
| US-05 | `https://rest.iad-05.braze.com` |
| US-06 | `https://rest.iad-06.braze.com` |
| US-07 | `https://rest.iad-07.braze.com` |
| US-08 | `https://rest.iad-08.braze.com` |
| EU-01 | `https://rest.fra-01.braze.eu`  |
| EU-02 | `https://rest.fra-02.braze.eu`  |
{: .reset-td-br-1 .reset-td-br-2}

## エンドポイントURL

トップレベルのURLがクラスタ固有であることに加え、各エンドポイントもパートナー固有である。例えば、US01クラスタにインポートする場合、URLは`https://rest.iad-01.braze.com/partners/[partner_name]/…` という形式になる。`[partner_name]` は通常、パートナーのビジネス名である。各エンドポイントの詳細については、以下のセクションで説明する。

## 認証

コホートのデータをBrazeにインポートするには、2つの認証キーが必要である。

### パートナーAPIキー

パートナーAPIキーは、統合パートナーを識別し、インポートに有効なリクエストであることを認証する。キーはリクエスト本文の`partner_api_key` フィールドに含めるべきである。

パートナーのアプリケーションで連携を設定する際、クライアントにBrazeクラスターを指定するよう求め、データをインポートする際に使用するクラスターURLとパートナーAPIキーを連携が認識できるようにする。

Brazeは、パートナーが連携開発を開始する前に、パートナーAPIキーをパートナーに提供する。一般的には、すべてのUSクラスタで有効な1つのキーと、EUクラスタで有効なもう1つのキーを提供する。

### クライアント・データ・インポート・キー

クライアントデータインポートキーは、コホートをインポートするクライアントのワークスペースを識別する。キーはリクエスト本文の`client_secret` フィールドに含めるべきである。

このキーは、クライアント（'s dashboard in the integrations settings for the partner. When setting up the integration in the partner'）のアプリケーションで生成される。統合がどのクライアントとワークスペースにデータを送信すべきかを知るために、クライアントはデータインポートキーを指定するよう求められるべきである。

## APIエンドポイント仕様

### コホート名 エンドポイント

コホート名エンドポイントは、IDに基づいてコホートの名前を指定するために使用できる。このエンドポイントは、コホートが最初にBrazeにエクスポートされるとき、またはすでにBrazeに知られているコホートの名前が変更されるときに、必ず呼び出されなければならない。

| フィールド | タイプ | 必須 | メモ |
| ----- | ---- | -------- | ----- |
| `partner_api_key` | String | はい | パートナーからBrazeへのすべてのリクエストで使用される、パートナー固有のAPI Key。このキーはクラスタ固有（[Partner APIキーを](#partner-api-key)参照）なので、パートナーはコホートが書き込まれるクラスタを知っている必要がある。 |
| `client_secret` | String | はい | このコホートが属するクライアントのデータインポートキー。 |
| `cohort_id` | String | はい | コホートの識別子。この識別子は、指定されたクライアントに固有でなければならない。 |
| `name` | String | はい | クライアントが指定したコホート名 |
| `created_at` | String | はい | ISO-8601フォーマットのタイムスタンプ |
{: .reset-td-br-1 .reset-td-br-2 .reset-td-br-3  .reset-td-br-4}

#### リクエスト例：

`POST: https://rest.iad-01.braze.com/partners/[partner_name]/cohorts`
```
{
	"partner_api_key" : "123456-1234-1234-12345678",
	"client_secret" : "234567-2345-2345-23456789",
	"cohort_id" : "[some unique identifier generated by the partner]",
	"name" : "Name of the cohort that will appear in the Braze dashboard",
	"created_at" : "2021-01-21T19:20:30+05:00"
}
```

### ユーザーコホートのエンドポイント

User cohortエンドポイントは、どのユーザーが特定のコホートに追加されたのか、またはコホートから削除されたのかを指定することができる。このエンドポイントは、コホートがリフレッシュされるときに呼び出されるべきである。コホートに新しく入ったユーザー、または前回の更新以降にコホートから抜けたユーザーのみが、Brazeに送信されるべきである。

| フィールド | タイプ | 必須 | メモ |
| ----- | ---- | -------- | ----- |
| `partner_api_key` | String | はい | パートナーからBrazeへのすべてのリクエストで使用される、パートナー固有のAPI Key。このキーはクラスタ固有のものであるため（[パートナーAPIキーを](#partner-api-key)参照）、統合はコホートを書き込むクラスタを知る必要がある。 |
| `client_secret` | String | はい | このコホートが属するクライアントのデータインポートキー。 |
| `cohort_id` | String | はい | コホートの識別子。識別子は、指定されたクライアントに対して一意でなければならない。 |
| `cohort_changes` | オブジェクト配列 | はい | オブジェクトは2つのフィールドを持つことができる。各要素は、コホート内のステータスが変更されたユーザーのIDである。2番目のフィールド、`should_remove` は、このオブジェクトのユーザーを、追加する代わりにコホートから削除するかどうかを示すオプションのブール値である。デフォルトはfalseである。つまり、匿名ユーザーをコホートに追加したり、コホートから削除したりすることはできない。1回のリクエストにおけるユーザーIDの最大結合長は1000である。たとえば、識別子ユーザーのデバイスIDを渡しても、そのユーザーを追加または削除することはない。識別子ユーザーには外部IDを使用しなければならない。 |
{: .reset-td-br-1 .reset-td-br-2 .reset-td-br-3  .reset-td-br-4}

#### リクエスト例：

`POST: https://rest.iad-01.braze.com/partners/[partner_name]/cohorts/users`
```
{
	"partner_api_key" : "123456-1234-1234-12345678",
	"client_secret" : "234567-2345-2345-23456789",
	"cohort_id" : "[some unique identifier generated by the partner]",
	"cohort_changes" : "[
	   {"user_ids": ["test_user_1", "test_user_2"]}
	]"
}
```

## レート制限

ユーザー・コホート・エンドポイントの1リクエストあたりのユーザーIDの最大数が1000であること以外には、これらのエンドポイントは特にレート制限を受けていない。

## コホートフィルター

Brazeは、ダッシュボード・ユーザーがパートナー・コホートにいるユーザーをターゲット・オーディエンスに含めたり除外したりできるフィルターを追加する。フィルターは、そのクライアントについてBrazeが把握しているすべてのコホートの名前のドロップダウンリストを提供する。このフィルターは、パートナーとBrazeがこの連携に合意したクライアントにのみ表示される。

## トラブルシューティング

コホート・インポート・エンドポイント特有のエラーコードとそのトラブルシューティング方法については、以下の表を参照のこと。

| エラーコード | 説明 |
| ----- | ---- |
| `401` | 無効なパートナーAPIキー |
|  | 無効なクライアントシークレット |
|  | クライアントシークレット:**<client secret>を**持つクライアントに対してパートナーがイネーブルメントされていない。 |
| `400` | `cohort_id` 有効な文字列でなければならない |
|  | `cohort_changes` `user_ids` 、または`device_ids` 、文字列の配列にマッピングされたオブジェクトの配列、または`aliases` オブジェクトでなければならない。 |
|  | `user_ids` 、`device_ids` 、`aliases` は、1リクエストにつき1,000個のみ許可される。 |
|  | `name` は空でない文字列でなければならない |
|  | `created_at` は[ISO-8601](https://en.wikipedia.org/wiki/ISO_8601)文字列として有効な時刻でなければならない。 |
{: .reset-td-br-1 .reset-td-br-2}

その他のトラブルシューティングについては、[エラーとレスポンシブを]({{site.baseurl}}/api/errors/)参照。
