---
nav_title: コホートインポート統合
alias: /cohort_import/
hidden: true
---

# パートナーコホートインポートインテグレーション

> パートナーコホートインポートインテグレーション機能を使用すると、パートナーとBrazeを統合して、パートナーのアプリライセンス内で生成されたユーザーをコホートで送信できます。

## クラスタURL

Brazeは、米国と欧州のさまざまなクラスターでアプリライケーションを開催しています。インポートエンドポイントのURL は、クライアントの企業インスタンスがホストされているクラスターによって異なります。

| インスタンス | RESTエンドポイント |
| ----- | ------------------------------- |
| US-01 | `https://rest.iad-01.braze.com` |
| US-02 | `https://rest.iad-02.braze.com` |
| US-03 | `https://rest.iad-03.braze.com` |
| US-04 | `https://rest.iad-04.braze.com` |
| US-05 | `https://rest.iad-05.braze.com` |
| US-06 | `https://rest.iad-06.braze.com` |
| US-07 | `https://rest.iad-07.braze.com` |
| US-08 | `https://rest.iad-08.braze.com` |
| EU-01 | `https://rest.fra-01.braze.eu`  |
| EU-02 | `https://rest.fra-02.braze.eu`  |
{: .reset-td-br-1 .reset-td-br-2}

## エンドポイントURL

最上位のURL はクラスタ固有であるだけでなく、それぞれのエンドポイントもパートナー固有です。たとえば、US01 クラスタにインポートする場合、URL の形式は`https://rest.iad-01.braze.com/partners/[partner_name]/…` となります。ここで、`[partner_name]` は通常、パートナーのビジネスの名前です。それぞれのエンドポイントの詳細については、次の項で説明します。

## 認証

コホートをBrazeに読み込むには、2つの認証鍵が必要です。

### 提携API キー

Partner API Key は、統合パートナーを識別し、インポートに有効なものとしてリクエストを認証します。このキーは、`partner_api_key` フィールドのリクエストの本文に含まれている必要があります。

パートナーのアプリライセンスでインテグレーションを設定する場合は、クライアントにBrazeクラスターを指定してもらう必要があります。これにより、インテグレーションは、データのインポート時に使用するクラスターURL とパートナーAPI キーを認識できるようになります。

Brazeは、パートナーが統合開発を開始する前に、パートナーAPIキーをパートナーに提供します。一般的に、すべてのUSクラスターに有効な単一のキーと、EUクラスターに有効な別のキーを提供します。

### クライアントデータインポートキー

クライアントデータインポートキーは、コホートをインポートするクライアント ワークスペースを識別します。このキーは、`client_secret` フィールドのリクエストの本文に含まれている必要があります。

この鍵は、パートナの統合設定s のクライアントのダッシュボードで生成されます。提携先のアプリライセンスでインテグレーションを設定する場合は、クライアントにデータインポートキーを指定してもらう必要があります。これにより、インテグレーションでデータを送信するクライアントとワークスペースがわかります。

## 原薬エンドポイント規格

### コホートネームエンドポイント

コホートの名前エンドポイントを使用して、そのID に基づいてコホートの名前を指定できます。このエンドポイントは、コホートが最初にBraze にエクスポートされたとき、またはBraze がすでに認識しているコホートの名前が変更されたときに呼び出されます。

| フィールド | タイプ | 必須 | メモ |
| ----- | ---- | -------- | ----- |
| `partner_api_key` | String | はい | パートナー固有のAPI キー。パートナーからBrazeへのすべてのリクエストで使用されます。このキーはクラスタ固有です([パートナーAPI キー](#partner-api-key)を参照)。そのため、パートナは、どのコホートs が書き込まれるクラスターかを知る必要があります。 |
| `client_secret` | String | はい | コホートが属するクライアントのデータインポートキー。 |
| `cohort_id` | String | はい | コホートのID。この識別子は、指定したクライアントに対して一意である必要があります。 |
| `name` | String | はい | コホートのクライアント指定の名前 |
| `created_at` | String | はい | ISO-8601 形式のタイムスタンプ |
{: .reset-td-br-1 .reset-td-br-2 .reset-td-br-3  .reset-td-br-4}

#### リクエスト例:

`POST: https://rest.iad-01.braze.com/partners/[partner_name]/cohorts`
```
{
	"partner_api_key" : "123456-1234-1234-12345678",
	"client_secret" : "234567-2345-2345-23456789",
	"cohort_id" : "[some unique identifier generated by the partner]",
	"name" : "Name of the cohort that will appear in the Braze dashboard",
	"created_at" : "2021-01-21T19:20:30+05:00"
}
```

### ユーザコホート エンドポイント

ユーザー コホート エンドポイントでは、特定のコホートに追加または削除されたユーザーを指定できます。このエンドポイントは、コホートのリフレッシュ時に呼び出す必要があります。コホートに新規に入力したか、最後の更新以降にコホートを離れたユーザーのみがBraze に送信されます。

| フィールド | タイプ | 必須 | メモ |
| ----- | ---- | -------- | ----- |
| `partner_api_key` | String | はい | パートナー固有のAPI キー。パートナーからBrazeへのすべてのリクエストで使用されます。このキーはクラスタ固有であるため([パートナーAPI キー](#partner-api-key)を参照)、インテグレーションでは、どのコホートs が書き込まれるクラスターかを知る必要があります。 |
| `client_secret` | String | はい | コホートが属するクライアントのデータインポートキー。 |
| `cohort_id` | String | はい | コホートのID。識別子は指定されたクライアントに対して一意である必要があります。 |
| `cohort_changes` | オブジェクト配列 | はい | オブジェクトには2 つのフィールドs を指定できます。1 つ、`user_ids` は必須であり、`external_ids`、`device_ids`、および`aliases` の配列にすることができます。各エレメントは、コホート内のステータスが変更されたユーザーのID です。2 番目のフィールド`should_remove` は、オプションのブール値で、このオブジェクトのユーザーs を追加する代わりにコホートから削除する必要があるかどうかを示します。デフォルトが偽です。最初に、ユーザーの外部ユーザー ID と一致しないIDを無視します。つまり、匿名ユーザーはコホートに追加または削除できません。1 つのリクエスト内のユーザー IDs の合計の最大長は1000 です。たとえば、識別されたユーザーのデバイスID を渡した場合、そのユーザーは追加または削除されません。識別されたユーザーには外部ID を使用する必要があります。 |
{: .reset-td-br-1 .reset-td-br-2 .reset-td-br-3  .reset-td-br-4}

#### リクエスト例:

`POST: https://rest.iad-01.braze.com/partners/[partner_name]/cohorts/users`
```
{
	"partner_api_key" : "123456-1234-1234-12345678",
	"client_secret" : "234567-2345-2345-23456789",
	"cohort_id" : "[some unique identifier generated by the partner]",
	"cohort_changes" : "[
	   {"user_ids": ["test_user_1", "test_user_2"]}
	]"
}
```

## レート制限

ユーザー コホート エンドポイント内のリクエストごとに1000 ユーザー ID s の上限を除き、これらのエンドポイントs は特にレート制限 ed ではありません。

## コホートフィルター

Braze は、パートナーコホート内にある場合、ダッシュボード ユーザーがターゲットオーディエンスにユーザーs を含めるか除外することを許可するフィルターを追加します。フィルターには、そのクライアントのBrazeが認識しているすべてのコホートの名前のドロップダウンリストが表示されます。このフィルターは、提携企業とBrazeがこの統合で提携することに同意したクライアントのみが見ることができます。

## トラブルシューティング

コホートインポートエンドポイントに固有のエラーのコードと、それらのトラブルシューティング方法については、次のテーブルを参照してください。

| エラーコード | 説明 |
| ----- | ---- |
| `401` | 不正なパートナーAPI キー |
|  | 不正なクライアントシークレット |
|  | クライアントシークレットでパートナーがクライアントに対して有効になっていません:**<クライアントシークレット>** |
| `400` | `cohort_id` 有効な文字列である必要があります |
|  | `cohort_changes` は、`user_ids` および/または`device_ids` m アプリが文字列の配列、または`aliases` オブジェクトを持つオブジェクトの配列である必要があります |
|  | リクエストごとに許可されるのは、1000 `user_ids`、`device_ids`、および`aliases` のみです |
|  | `name` 空でない文字列でなければなりません |
|  | `created_at` は、[ISO-8601](https://en.wikipedia.org/wiki/ISO_8601)文字列として有効な時刻である必要があります |
{: .reset-td-br-1 .reset-td-br-2}

その他のトラブルシューティングについては、[エラー s& Responses]({{site.baseurl}}/api/errors/)を参照してください。これは、Braze API を使用している間に発生する可能性のあるさまざまなエラーとサーバーのレスポンスを対象としています。
