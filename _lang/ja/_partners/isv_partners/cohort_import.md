---
nav_title: コホートインポート統合
alias: /cohort_import/
hidden: true
---

# パートナーコホートインポート統合

> パートナーコホートインポート統合機能により、パートナーは Braze と統合して、パートナーのアプリケーション内で生成されたユーザーのコホートを送信できます。

## クラスタURL

Brazeは、米国と欧州のさまざまなクラスターでアプリライケーションを開催しています。インポートエンドポイントのURL は、クライアントの企業インスタンスがホストされているクラスターによって異なります。

| インスタンス | REST エンドポイント |
| ----- | ------------------------------- |
| US-01 | `https://rest.iad-01.braze.com` |
| US-02 | `https://rest.iad-02.braze.com` |
| US-03 | `https://rest.iad-03.braze.com` |
| US-04 | `https://rest.iad-04.braze.com` |
| US-05 | `https://rest.iad-05.braze.com` |
| US-06 | `https://rest.iad-06.braze.com` |
| US-07 | `https://rest.iad-07.braze.com` |
| US-08 | `https://rest.iad-08.braze.com` |
| EU-01 | `https://rest.fra-01.braze.eu`  |
| EU-02 | `https://rest.fra-02.braze.eu`  |
{: .reset-td-br-1 .reset-td-br-2 role="presentation" }

## エンドポイントURL

最上位のURL はクラスタ固有であるだけでなく、それぞれのエンドポイントもパートナー固有です。たとえば、US01 クラスタにインポートする場合、URL の形式は`https://rest.iad-01.braze.com/partners/[partner_name]/…` となります。ここで、`[partner_name]` は通常、パートナーのビジネスの名前です。それぞれのエンドポイントの詳細については、以降のセクションで説明します。

## 認証

Braze にコホートデータをインポートするには、2つの認証キーが必要です。

### パートナー API キー

パートナー API キーにより、統合パートナーが識別され、リクエストがインポートに対して有効であると認証されます。このキーは、`partner_api_key` フィールドのリクエストの本文に含まれている必要があります。

パートナーのアプリケーションで統合を設定する場合は、クライアントに対し、クライアントの Braze クラスターを指定するように依頼してください。これにより、データのインポート時に使用するクラスター URL とパートナーAPI キーを統合で認識できるようになります。

パートナーが統合開発を開始する前に、Braze からパートナー API キーがパートナーに提供されます。一般的に、すべての US クラスターで有効な1つのキーと、EU クラスターで有効なもう1つのキーが提供されます。

### クライアントデータインポートキー

クライアントデータインポートキーは、コホートをインポートするクライアント ワークスペースを識別します。このキーは、`client_secret` フィールドのリクエストの本文に含まれている必要があります。

このキーは、クライアントのダッシュボードのパートナーの統合設定で生成されます。パートナーのアプリケーションで統合を設定する場合、クライアントにデータインポートキーを指定するように依頼する必要があります。これにより、データを送信するクライアントとワークスペースを統合で認識できるようになります。

## API エンドポイントの仕様

### コホート名エンドポイント

コホート名エンドポイントを使用して、その ID に基づいてコホートの名前を指定できます。このエンドポイントは、コホートが最初に Braze にエクスポートされたとき、または Braze がすでに認識しているコホートの名前が変更されたときに呼び出されます。

| フィールド | タイプ | 必須 | メモ |
| ----- | ---- | -------- | ----- |
| `partner_api_key` | String | はい | パートナー固有のAPI キー。パートナーからBrazeへのすべてのリクエストで使用されます。このキーはクラスター固有であるため (「[パートナー API キー](#partner-api-key)」を参照)、パートナーはコホートの書き込み先クラスターを把握している必要があります。 |
| `client_secret` | String | はい | コホートが属するクライアントのデータインポートキー。 |
| `cohort_id` | String | はい | コホートの識別子。この識別子は、指定したクライアントに対して一意である必要があります。 |
| `name` | String | はい | コホートのクライアント指定の名前 |
| `created_at` | String | はい | ISO-8601 形式のタイムスタンプ |
{: .reset-td-br-1 .reset-td-br-2 .reset-td-br-3  .reset-td-br-4 role="presentation" }

#### リクエスト例:

`POST: https://rest.iad-01.braze.com/partners/[partner_name]/cohorts`
```
{
	"partner_api_key" : "123456-1234-1234-12345678",
	"client_secret" : "234567-2345-2345-23456789",
	"cohort_id" : "[some unique identifier generated by the partner]",
	"name" : "Name of the cohort that will appear in the Braze dashboard",
	"created_at" : "2021-01-21T19:20:30+05:00"
}
```

### ユーザコホート エンドポイント

ユーザー コホート エンドポイントでは、特定のコホートに追加または削除されたユーザーを指定できます。このエンドポイントは、コホートの更新時に呼び出す必要があります。コホートに新規に入ったユーザー、または最後の更新以降にコホートを離れたユーザーのみが Braze に送信されます。

| フィールド | タイプ | 必須 | メモ |
| ----- | ---- | -------- | ----- |
| `partner_api_key` | String | はい | パートナー固有のAPI キー。パートナーからBrazeへのすべてのリクエストで使用されます。このキーはクラスター固有であるため (「[パートナー API キー](#partner-api-key)」を参照)、統合がコホートの書き込み先クラスターを認識している必要があります。 |
| `client_secret` | String | はい | コホートが属するクライアントのデータインポートキー。 |
| `cohort_id` | String | はい | コホートの識別子。識別子は指定されたクライアントに対して一意である必要があります。 |
| `cohort_changes` | オブジェクト配列 | はい | オブジェクトには2つのフィールドを含めることができます。1番目の `user_ids` は必須であり、`external_ids`、`device_ids`、および`aliases` の配列にすることができます。各エレメントは、コホート内のステータスが変更されたユーザーのID です。2番目のフィールド `should_remove` は、オプションのブール値で、このオブジェクトのユーザーをコホートへの追加ではなく、コホートから削除するかどうかを示します。デフォルトは false です。一つのリクエストに含まれるユーザーIDの最大結合長は1,000である。<br/><br/>識別されたユーザーは、`external_id` または`alias` のどちらかによって照合することができる。匿名ユーザーは、`device_id` 。識別子ユーザーのデバイスIDを渡しても、Brazeはそのユーザーを追加または削除しない。識別されたユーザーには、外部IDまたはエイリアスを使用しなければならない。 |
{: .reset-td-br-1 .reset-td-br-2 .reset-td-br-3  .reset-td-br-4 role="presentation" }

#### リクエスト例:

`POST: https://rest.iad-01.braze.com/partners/[partner_name]/cohorts/users`
```
{
	"partner_api_key" : "123456-1234-1234-12345678",
	"client_secret" : "234567-2345-2345-23456789",
	"cohort_id" : "[some unique identifier generated by the partner]",
	"cohort_changes" : "[
	   {"user_ids": ["test_user_1", "test_user_2"]}
	]"
}
```

## レート制限

ユーザーコホートのエンドポイントでは、1リクエストあたり最大1,000ユーザーIDに加えて、これらのエンドポイントリクエストは、1時間あたり250,000リクエストにレート制限されている。

## コホートフィルター

Braze は、ユーザーがパートナーコホートに含まれている場合に、ダッシュボードユーザーがターゲットオーディエンスにそれらのユーザーを含めるかまたは除外することができるようにするフィルターを追加する予定です。フィルターには、そのクライアントのBrazeが認識しているすべてのコホートの名前のドロップダウンリストが表示されます。このフィルターは、パートナーと Braze がこの統合で連携することに同意しているクライアントにのみ表示されます。

## トラブルシューティング

コホートインポートエンドポイントに固有のエラーのコードと、それらのトラブルシューティング方法については、次のテーブルを参照してください。

| エラーコード | 説明 |
| ----- | ---- |
| `400` | `cohort_id` は有効な文字列でなければなりません |
|  | `cohort_changes` は、キー `user_ids` および/または `device_ids` を持ち、文字列の配列にマッピングされているオブジェクトの配列であるか、または `aliases` オブジェクトである必要があります |
|  | リクエストあたりの許可されている `user_ids`、`device_ids`、および`aliases` の数は1000個です。 |
|  | `name` は、空ではない文字列にする必要があります。 |
|  | `created_at` は、[ISO-8601](https://en.wikipedia.org/wiki/ISO_8601)文字列として有効な時刻である必要があります |
| `401` | 不正なパートナーAPI キー |
|  | 不正なクライアントシークレット |
|  | クライアントシークレット **<client secret>** が設定されているクライアントでパートナーが有効になっていません |
|  | 不正アクセス |
| `423` | リソースがロックされた |
{: .reset-td-br-1 .reset-td-br-2 role="presentation" }

その他のトラブルシューティングについては、[エラー s& Responses]({{site.baseurl}}/api/errors/)を参照してください。これは、Braze API を使用している間に発生する可能性のあるさまざまなエラーとサーバーのレスポンスを対象としています。
