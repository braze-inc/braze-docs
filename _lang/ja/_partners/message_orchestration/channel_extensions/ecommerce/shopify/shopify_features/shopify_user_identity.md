---
nav_title: Shopify ユーザID 管理
article_title: "Shopify ユーザID 管理"
description: "このリファレンス記事では、Shopifyユーザー識別管理機能の概要を説明します。"
page_type: partner
search_tag: Partner
alias: "/shopify_user_identity/"
page_order: 3
---

# Shopifyユーザー識別管理

> Braze は、オンサイトでの動作や、統合の一部として設定したShopify ウェブフックを聴くことで、Shopify の顧客からの信号を受信します。ヘッドレスでないShopifyサイトの場合、Brazeはチェックアウトページからユーザーを調整するのに役立ちます。ヘッドレスShopifyサイトについては、[チェックアウト]({{site.baseurl}}//partners/message_orchestration/channel_extensions/ecommerce/shopify/getting_started_shopify/#headless-checkout)からユーザを調整する方法についての統合ガイダンスを参照してください。

## ユーザープロファイルの情報のキャプチャ 

### Shopifyのユーザー追跡

ストア訪問者がゲスト(つまり匿名) の場合、Braze はその特定の顧客のセッションの`device_id` をキャプチャします。[Web SDK]({{site.baseurl}}//partners/message_orchestration/channel_extensions/ecommerce/shopify/getting_started_shopify/#implement-web-sdk)の実装中にShopifyフォームのユーザー調整を設定すると、顧客がフォームに情報を入力するたびに、匿名ユーザープロファイルに顧客のメールが追加されます。 

店舗訪問者が自分のメールをShopifyニュースレターまたはメールキャプチャフォームに入力すると、Brazeはユーザープロファイルを作成するためのShopifyウェブフックイベントを受信します。Braze は、このユーザープロファイルを Web SDK によって追跡される匿名ユーザープロファイルとマージし、Shopify の顧客ID をユーザープロファイルのユーザーエイリアスとして割り当てます。 

顧客がチェックアウトに進み、電話番号などの他の識別可能な情報を提供するにつれて、Braze はShopify ウェブフックから関連するユーザデータを取得し、匿名ユーザとマージして`device_id` を使用する必要があります。
\- Shopify ScriptTag、非ヘッドレスShopify サイト、またはGoogle Tag Manager を使用してWeb SDK を実装した場合、Braze は自動的にチェックアウトページのユーザーデータと匿名ユーザープロファイルのセッションデータが、割り当てられたShopify 顧客ID を使用してユーザーエイリアスプロファイルにマージされるようにします。
\- ShopifyヘッドレスサイトにWeb SDKを実装している場合は、チェックアウトページ内で送信されたユーザーデータが、Web SDKまたはAPIを介して適切なユーザープロファイルに適切に割り当てられていることを確認する必要があります。詳細については、[ヘッドレスShopifyサイト]({{site.baseurl}}//partners/message_orchestration/channel_extensions/ecommerce/shopify/getting_started_shopify/#headless-site)にWeb SDKを直接実装してください。

顧客がチェックアウトプロセスを続けると、Brazeは入力されたメールアドレス、電話番号、またはShopifyの顧客IDが既存のユーザープロファイルと一致するかどうかをチェックします。一致がある場合、Braze はShopify ユーザーデータをそのプロファイルに同期します。

メールアドレスまたは電話番号が複数の識別されたユーザプロファイルに関連付けられている場合、Braze はShopify データを最新のアクティビティを持つプロファイルに同期します。

Braze がメールアドレスまたは電話番号と一致するものを見つけられない場合、Braze は、サポートされているShopify データを持つ新しいユーザプロファイルを作成します。

### Shopifyの顧客がBrazeと同期するとき

Brazeは、既存のユーザプロファイルを更新するか、またはShopifyストアにキャプチャされたリード、サインアップ、およびアカウント登録用に新しいユーザプロファイルを作成します。Shopify などの次のメソッドからユーザープロファイルデータを収集できます。
\- 顧客がアカウントを作成する
\- 顧客の電子メールアドレスまたは電話番号がShopifyキャプチャフォームで収集される
\- 顧客の電子メールアドレスはニュースレターフォームから収集されます
\- EcomSend など、Shopify に接続されたサードパーティ製ツールを使用して、顧客の電子メールアドレスまたは電話番号を収集する

Braze は、まず、顧客の電子メールアドレスまたは電話番号を使用して、サポートされているShopify データを既存のユーザープロファイルにマッピングしようとします。 

ユーザープロファイルが重複しないようにするには、[ Shopify Web サイトでWeb SDK を実装するために使用した方法のShopify Forms 命令のユーザー調整を確認することが重要です。

## ユーザープロファイルのマージ 

{% alert note %}
デフォルトのShopify統合では、匿名ユーザープロファイルとShopifyエイリアスプロファイルのマージに役立つツールが提供されています。[ ヘッドレスShopify サイト]() への統合を実装している場合は、Web SDK をヘッドレスShopify サイトに直接実装して、ユーザーが適切に調整されていることを確認してください。
{% endalert %}

Braze は、次のいずれかと一致するものが見つかった場合に、匿名ユーザープロファイルのフィールドを識別されたユーザープロファイルにマージします。
\- Shopifyの顧客ID
* メール
電話番号

Braze は、匿名ユーザープロファイルの以下のフィールドを、識別されたユーザープロファイルにマージします。
名
姓
* メール
性別
生年月日
電話番号
タイムゾーン
市区町村
国
言語
\- カスタム属性
    \- カスタムイベントおよび購入イベントデータ(イベントプロパティ、カウント、および最初の日付と最後の日付のタイムスタンプを除く)
    \- Y 日のX 回(X<=50 およびY<=30) セグメンテーションのカスタムイベントおよび購入イベントプロパティ
\- プッシュトークン
メッセージ履歴：
\- 匿名ユーザープロファイルまたは識別されたユーザープロファイルにある次のフィールドのいずれか。たとえば、カスタムイベント、購入イベント数、最初の日付と最後の日付のタイムスタンプなど
    \- これらの差し込み項目は、「Y 日のX イベント」フィルタを更新します。購入イベントの場合、これらのフィルタには「Y 日の購入数」と「最後のY 日に費やされた金額」が含まれます。

{% alert important %}
セッションデータは、マージプロセスの一部としてまだサポートされていません。
{% endalert %}

## Shopifyサブスクライバーの同期

Shopify セットアッププロセス中、Braze は顧客のメールアドレスとSMS オプトイン状態をBraze ユーザープロファイルのサブスクリプショングループとサブスクリプション状態に同期する柔軟なコントロールを提供します。 

### 電子メールまたはSMS サブスクライバの収集

Braze のShopify ストアのセットアップ中に、メールとSMS サブスクライバをShopify からBraze に同期するオプションがあります。 

#### メールサブスクライバーを収集する

電子メールサブスクライバ収集を有効にするには、Shopify 設定で機能をオンにします。Shopify メールサブスクライバなど、少なくとも1 つのBraze [サブスクリプショングループ]({{site.baseurl}}/user_guide/message_building_by_channel/email/managing_user_subscriptions#subscription-groups) を割り当てることをお勧めします。Braze は、指定されたサブスクリプショングループにメールサブスクライバを追加し、メッセージを送信するときにオーディエンスターゲットに含めるようにします。 

![\]({% image_buster /assets/img/Shopify/collect_email.png %})

有効にすると、Braze はShopify メールサブスクライバに更新を同期し、リアルタイムでメールサブスクリプションの状態を更新します。上書きオプションを有効にしない場合、Shopify の顧客は、Shopify ストアに関連付けられているサブスクリプショングループからサブスクリプションされるか、サブスクリプション解除されます。

オーバーライドオプションを有効にすると、Braze はユーザープロファイルのグローバルサブスクリプションの状態を更新します。つまり、顧客がShopifyで未登録としてマークされている場合、Brazeは、グローバルサブスクリプションの状態をユーザプロファイルで未登録としてマークし、利用可能なすべてのメールサブスクリプショングループから顧客のサブスクリプションを解除します。その結果、メールからグローバルに登録解除されたユーザにはメッセージが送信されません。

#### SMS サブスクライバーを収集する

ShopifyからSMSサブスクライバを収集するには、[SMSサブスクリプショングループ]({{site.baseurl}}/user_guide/message_building_by_channel/sms/sms_subscription_group/)を[SMSセットアップ]({{site.baseurl}}/user_guide/message_building_by_channel/sms/sms_setup)の一部として作成する必要があります。 

Shopify SMS サブスクライバを収集する準備ができたら、Shopify セットアップページで SMS サブスクライバ収集をオンにします。SMS メッセージを適切にターゲットし、送信できるように、少なくとも1 つのSMS サブスクリプショングループを選択する必要があります。 

![\]({% image_buster /assets/img/Shopify/collect_sms.png %})

有効にすると、Braze はShopify SMS サブスクライバとそのSMS サブスクリプションステートをリアルタイムで同期します。上書きオプションを有効にしない場合、Shopify の顧客は、Shopify ストアに関連付けられているサブスクリプショングループからサブスクリプションされるか、サブスクリプション解除されます。

SMSサブスクライバにはグローバルサブスクリプションステートがないため、オーバーライドオプションを使用するときに考慮する必要はありません。ユーザは、SMS サブスクリプションググループのサブスクリプション解除またはサブスクリプションのみを行うことができます。

#### レガシーカスタム属性

レガシーShopify の顧客は、`shopify_accepts_marketing` および`shopify_sms_consent` カスタム属性を使用して電子メールおよびSMS サブスクライバを収集する古い方法を持っている可能性があります。上の設定を上書きを有効にして保存すると、Braze はユーザプロファイルのカスタム属性を削除し、それらの値をそれぞれのメールサブスクリプショングループとSMS サブスクリプショングループに同期します。

これらのレガシーカスタム属性を使用する既存のキャンペーンまたはキャンバスがある場合は、それらの属性を削除して、キャンペーンまたはキャンバスが適切なサブスクリプション状態、グループ、またはその両方を使用していることを確認します。
