---
nav_title: Shopify ユーザーアイデンティティ管理
article_title: "Shopify ユーザーアイデンティティ管理"
description: "この参考記事では、ShopifyのユーザーID管理機能の概要を説明しています。"
page_type: partner
search_tag: Partner
alias: "/shopify_user_identity/"
page_order: 3
---

# Shopify ユーザーアイデンティティ管理

> Brazeは、オンサイトでの行動や、統合の一環として設定したShopify ウェブフックを聞くことで、Shopifyのお客様からのシグナルを受け取ります。ヘッドレス以外のShopifyサイトの場合、Brazeはチェックアウトページからユーザーの照合を支援します。ヘッドレスShopifyサイトについては、[チェックアウトからユーザーを調整する方法に関する統合ガイダンスを参照してください]({{site.baseurl}}//partners/message_orchestration/channel_extensions/ecommerce/shopify/getting_started_shopify/#headless-checkout)。

## ユーザープロファイルの情報の取得 

### Shopify ユーザートラッキング

ストア訪問者がゲスト（つまり匿名）`device_id`の場合、Brazeは特定の顧客のセッションをキャプチャします。[Web SDKの実装中にShopifyフォームのユーザー調整を設定すると]({{site.baseurl}}//partners/message_orchestration/channel_extensions/ecommerce/shopify/getting_started_shopify/#implement-web-sdk)、顧客がフォームに情報を入力するたびに、顧客のメールが匿名ユーザープロファイルに追加されます。 

ストア訪問者がShopifyニュースレターまたはメールキャプチャフォームにメールを入力すると、Brazeはユーザープロファイルを作成するためのShopify ウェブフックイベントを受け取ります。次に、Brazeは、このユーザープロファイルをWeb SDKによって追跡された匿名ユーザープロファイルと統合し、Shopifyの顧客IDをユーザープロファイルのユーザーエイリアスとして割り当てます。 

顧客がチェックアウトに進み、電話番号などの他の識別可能な情報を提供すると、BrazeはShopify ウェブフックから関連するユーザーデータを取得し、それを匿名ユーザーと統合する必要があります。`device_id`
-Shopify ScriptTag、ヘッドレス以外のShopifyサイト、またはGoogleタグマネージャーを使用してWeb SDKを実装した場合、Brazeは、チェックアウトページのユーザーデータと匿名ユーザープロファイルのセッションデータが、割り当てられたShopify顧客IDのユーザーエイリアスプロファイルに自動的にマージされるようにします。
-ShopifyヘッドレスサイトにWeb SDKを実装している場合は、チェックアウトページ内で送信されたユーザーデータが、Web SDKまたはAPIを介して正しいユーザープロファイルに適切に割り当てられていることを確認する必要があります。詳細については、「[Web SDKをヘッドレスShopifyサイトに直接実装する]({{site.baseurl}}//partners/message_orchestration/channel_extensions/ecommerce/shopify/getting_started_shopify/#headless-site)」を参照してください。

お客様がチェックアウトプロセスを続けると、Brazeは入力したメールアドレス、電話番号、またはShopifyのお客様IDが既存のユーザープロフィールと一致するかどうかを確認します。一致する場合、BrazeはShopifyのユーザーデータをそのプロファイルに同期します。

メールアドレスまたは電話番号が複数の識別されたユーザープロファイルに関連付けられている場合、BrazeはShopifyデータを最新のアクティビティのプロファイルに同期します。

Brazeがメールアドレスまたは電話番号と一致しない場合、BrazeはサポートされているShopifyデータを使用して新しいユーザープロファイルを作成します。

### Shopifyのお客様がBrazeと同期する場合

Brazeは、Shopifyストアで取得したリード、サインアップ、アカウント登録について、既存のユーザープロファイルを更新するか、新しいユーザープロファイルを作成します。Shopifyでは、次のような方法でユーザープロフィールデータを収集できます。
-お客様がアカウントを作成
-お客様のメールアドレスまたは電話番号がShopifyキャプチャフォームで収集されます
-お客様のEメールアドレスはニュースレターフォームから収集されます
-お客様のメールアドレスまたは電話番号は、EcomSendなどのShopifyに接続されているサードパーティツールを通じて収集されます

Brazeはまず、お客様のメールアドレスまたは電話番号を使用して、サポートされているShopifyデータを既存のユーザープロファイルにマッピングしようとします。 

ユーザープロファイルの重複を防ぐには、Shopify [ウェブサイトにWeb SDKを実装するために使用した方法について]()、Shopify フォームのユーザー調整の手順を確認することが重要です。

## ユーザープロファイルの結合 

{% alert note %}
デフォルトのShopify統合には、匿名ユーザープロファイルとShopifyエイリアスプロファイルの統合を支援するツールが用意されています。[ヘッドレスShopifyサイトへの統合を実装する場合は、「ヘッドレスShopifyサイトへのWeb]() SDKの直接実装」を参照して、ユーザーを適切に調整していることを確認してください。
{% endalert %}

Brazeは、次のいずれかに一致するものが見つかると、匿名ユーザープロファイルのフィールドを特定されたユーザープロファイルに統合します。
-Shopify カスタマー ID
メール
電話番号

Brazeは、匿名ユーザープロファイルの次のフィールドを指定されたユーザープロファイルに統合します。
名
姓
メール
性別
生年月日
電話番号
タイムゾーン
自宅の都市
国
言語
カスタム属性
    -カスタムイベントおよび購入イベントデータ（イベントプロパティ、カウント、初日と最終日のタイムスタンプを除く）
    -「Y日でX回」セグメンテーション用のカスタムイベントおよび購入イベントプロパティ（X<=50、Y<=30）
-プッシュトークン
-メッセージ履歴
-カスタムイベント、購入イベント数、初日と最終日のタイムスタンプなど、匿名ユーザープロファイルまたは特定ユーザープロファイルにある以下のフィールドのいずれか
    -これらの統合フィールドにより、「Y日以内にX件のイベントが発生する」フィルターが更新されます。購入イベントの場合、これらのフィルターには「Y 日間の購入数」と「過去 Y 日間の購入金額」が含まれます。

{% alert important %}
セッションデータは、マージプロセスの一部としてまだサポートされていません。
{% endalert %}

## Shopify購読者の同期

Shopifyの設定プロセス中、Brazeはお客様のメールアドレスとSMSオプトイン状態を、Brazeユーザープロファイルのサブスクリプショングループとサブスクリプション状態に同期するための柔軟なコントロールを提供します。 

### メールまたは SMS 購読者の収集

BrazeでShopifyストアを設定する際に、メールとSMSの購読者をShopifyからBrazeに同期するオプションが表示されます。 

#### メールサブスクライバーを収集する

メール購読者の収集を有効にするには、Shopifyの設定でこの機能を有効にしてください。Shopifyのメール購読者など、[少なくとも1つのBrazeサブスクリプショングループを割り当てることをお勧めします]({{site.baseurl}}/user_guide/message_building_by_channel/email/managing_user_subscriptions#subscription-groups)。Brazeは、メール購読者を指定された購読グループに追加して、メッセージを送信したときにオーディエンスターゲティングに含まれるようにします。 

![\]({% image_buster /assets/img/Shopify/collect_email.png %})

有効にすると、BrazeはShopifyのメール購読者への更新と、メール購読の状態の更新をリアルタイムで同期します。オーバーライドオプションを有効にしない場合、Shopifyのお客様は、Shopifyストアに関連付けられているサブスクリプショングループに登録または購読解除されます。

オーバーライドオプションを有効にすると、Braze はユーザープロファイルのグローバルサブスクリプション状態を更新します。つまり、お客様がShopifyで購読解除とマークされている場合、Brazeはユーザープロフィールでグローバル購読状態を購読解除とマークし、利用可能なすべてのメール購読グループからお客様の登録を解除します。その結果、電子メールの購読をグローバルに解除されたユーザーにはメッセージは送信されません。

#### SMS サブスクライバーを収集する

[ShopifyからSMS購読者を収集するには、[SMS設定の一部としてSMS購読グループを作成する必要があります]({{site.baseurl}}/user_guide/message_building_by_channel/sms/sms_subscription_group/)。]({{site.baseurl}}/user_guide/message_building_by_channel/sms/sms_setup) 

Shopify SMS購読者を収集する準備ができたら、Shopifyの設定ページでSMS購読者の収集を有効にして有効にします。SMS メッセージを適切にターゲティングして送信できるように、SMS 購読グループを少なくとも 1 つ選択する必要があります。 

![\]({% image_buster /assets/img/Shopify/collect_sms.png %})

有効にすると、BrazeはShopify SMS購読者の更新内容とSMS購読状態をリアルタイムで同期します。オーバーライドオプションを有効にしない場合、Shopifyのお客様は、Shopifyストアに関連付けられているサブスクリプショングループに登録または購読解除されます。

SMS ユーザにはグローバルなサブスクリプション状態がないため、オーバーライドオプションを使用するときにそれらを考慮する必要はありません。ユーザーは SMS 購読グループへの登録解除または購読のみ可能です。

#### レガシーカスタム属性

従来のShopifyのお客様は、`shopify_accepts_marketing``shopify_sms_consent`とカスタム属性を介してメールとSMSの購読者を収集する古い方法を使用している場合があります。オーバーライドを有効にして上記の設定を保存すると、Braze はユーザープロファイルのカスタム属性を削除し、それらの値をそれぞれのメール購読グループと SMS 購読グループに同期します。

これらの従来のカスタム属性を使用している既存のキャンペーンまたはキャンバスがある場合は、それらの属性を削除して、キャンペーンまたはキャンバスが適切なサブスクリプション状態、グループ、またはその両方を使用していることを確認します。
